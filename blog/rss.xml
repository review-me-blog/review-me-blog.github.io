<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>리뷰미 팀블로그 Blog</title>
        <link>https://your-docusaurus-site.example.com/blog</link>
        <description>리뷰미 팀블로그 Blog</description>
        <lastBuildDate>Sat, 14 Sep 2024 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>ko</language>
        <item>
            <title><![CDATA[프론트 엔드의 에러 핸들링 전략]]></title>
            <link>https://your-docusaurus-site.example.com/blog/fe-error-handleing</link>
            <guid>https://your-docusaurus-site.example.com/blog/fe-error-handleing</guid>
            <pubDate>Sat, 14 Sep 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[---]]></description>
            <content:encoded><![CDATA[<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="에러-핸들링-전략의-필요성">에러 핸들링 전략의 필요성<a class="hash-link" aria-label="에러 핸들링 전략의 필요성에 대한 직접 링크" title="에러 핸들링 전략의 필요성에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/fe-error-handleing#%EC%97%90%EB%9F%AC-%ED%95%B8%EB%93%A4%EB%A7%81-%EC%A0%84%EB%9E%B5%EC%9D%98-%ED%95%84%EC%9A%94%EC%84%B1">​</a></h2>
<p>오류는 UX에 치명적이며, 개발자는 오류 메세지를 통해 어떤 오류인지 파악할 수 있어 중요합니다. 여러 개발자들이 작업을 하고 있기 때문에 같은 API 응답 코드(status code)여도 다른 오류 메세지를 던지거나, 다른 형태로 오류 관련된 UI(예: 누군가는 모달로 오류 메세지를 띄우고, 누군가는 오류 페이지로 이동하는 방식)를 구현할 수 있습니다.</p>
<p>각기 다른 오류 메시지와 UI는 사용자와 개발자 모두에게 혼란을 줄 수 있습니다. 그래서 UX 측면에서는 사용자에게 어떤 오류인지 통일되고 명확하게 안내하고, 그에 따라 사용자 행동을 유도할 수 있습니다. 또한, DX 측면에서는 개발자가 오류를 쉽게 파악해 디버깅이 용이하도록 하기 위해, 리뷰미 프론트엔드 팀만의 에러 핸들링 전략을 세웠습니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="에러-핸들링-전략">에러 핸들링 전략<a class="hash-link" aria-label="에러 핸들링 전략에 대한 직접 링크" title="에러 핸들링 전략에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/fe-error-handleing#%EC%97%90%EB%9F%AC-%ED%95%B8%EB%93%A4%EB%A7%81-%EC%A0%84%EB%9E%B5">​</a></h3>
<table><thead><tr><th>오류 종류</th><th>오류 발생 상황</th><th>대응 전략</th><th>오류 케이스 예시</th></tr></thead><tbody><tr><td>API 요청 오류</td><td>화면에 영향이 있는 경우</td><td>ErrorSection, ErrorPage</td><td><ul><li>잘못된 리뷰 요청 코드로 데이터를 불러와서 페이지를 렌더링 하는 경우</li><li>네트워크 문제나 서버가 다운되어서 응답을 받지 못하는 경우</li><li>클라이언트 측에서 설장한 타임아웃이 초과</li><li>DNS,CORS에 의한 오류</li></ul></td></tr><tr><td>API 요청 오류</td><td><ul><li>사용자와 상호 작용하고 있어서 현재 컴포넌트를 언마운트 시키며 안되는 경우(=상태 유지 필요)</li><li>데이터 유무가 화면에 영향이 없는 경우 </li></ul></td><td>Error Modal(모달의 형태는 케이스에 맞는 것으로),text</td><td><ul><li>비밀 번호 조회 실패</li><li>작성한 리뷰 제출 실패 시</li></ul></td></tr><tr><td>배포 사이트 오류</td><td><ul><li>배포 사이트가 다운된 경우</li><li>파일 경로를 찾을 수 없는 경우</li></ul></td><td>AWS의 error.html 사용, 403오류 시 index.html 사용</td><td></td></tr><tr><td>클라이언트단 오류</td><td>js 오류</td><td>console.error</td><td><ul><li>element를 찾을 수 없는 경우</li><li>type 불일치로 인한 오류</li></ul></td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="api-요청-오류-시-응답-status별-오류-메세지">API 요청 오류 시, 응답 status별 오류 메세지<a class="hash-link" aria-label="API 요청 오류 시, 응답 status별 오류 메세지에 대한 직접 링크" title="API 요청 오류 시, 응답 status별 오류 메세지에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/fe-error-handleing#api-%EC%9A%94%EC%B2%AD-%EC%98%A4%EB%A5%98-%EC%8B%9C-%EC%9D%91%EB%8B%B5-status%EB%B3%84-%EC%98%A4%EB%A5%98-%EB%A9%94%EC%84%B8%EC%A7%80">​</a></h2>
<p>오류 메세지는 크게 서버단 오류인 500대 에러와 클라이언트 단 오류인 400번대로 나누고, 400번대 오류를 좀 더 세분화해서 다뤘습니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="response-status에-따라-일관된-오류-메세지를-반환하는-유틸-함수">response status에 따라 일관된 오류 메세지를 반환하는 유틸 함수<a class="hash-link" aria-label="response status에 따라 일관된 오류 메세지를 반환하는 유틸 함수에 대한 직접 링크" title="response status에 따라 일관된 오류 메세지를 반환하는 유틸 함수에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/fe-error-handleing#response-status%EC%97%90-%EB%94%B0%EB%9D%BC-%EC%9D%BC%EA%B4%80%EB%90%9C-%EC%98%A4%EB%A5%98-%EB%A9%94%EC%84%B8%EC%A7%80%EB%A5%BC-%EB%B0%98%ED%99%98%ED%95%98%EB%8A%94-%EC%9C%A0%ED%8B%B8-%ED%95%A8%EC%88%98">​</a></h3>
<div class="language-ts codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-ts codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">createApiErrorMessage</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">statusCode</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//500대 서버 api 오류</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> isServerError </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SERVER_ERROR_REGEX</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">statusCode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isServerError</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">API_ERROR_MESSAGE</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">serverError</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 400번대 오류</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">statusCode </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">API_ERROR_MESSAGE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">API_ERROR_MESSAGE</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">statusCode</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="오류-메세지">오류 메세지<a class="hash-link" aria-label="오류 메세지에 대한 직접 링크" title="오류 메세지에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/fe-error-handleing#%EC%98%A4%EB%A5%98-%EB%A9%94%EC%84%B8%EC%A7%80">​</a></h3>
<div class="language-ts codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-ts codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">API_ERROR_MESSAGE</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ApiErrorMessage </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token number" style="color:#36acaa">400</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"잘못된 요청이에요"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token number" style="color:#36acaa">401</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"인증을 실패했어요"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token number" style="color:#36acaa">403</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"요청권한이 없어요"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token number" style="color:#36acaa">404</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"요청하신 내용을 찾을 수 없어요"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token number" style="color:#36acaa">422</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"올바르지 않은 데이터 형식이에요"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  serverError</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"서버 오류가 발생했어요"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="error-컴�포넌트">Error 컴포넌트<a class="hash-link" aria-label="Error 컴포넌트에 대한 직접 링크" title="Error 컴포넌트에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/fe-error-handleing#error-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8">​</a></h2>
<p>오류 발생 시, 사용자가 만나는 UI는 크게 ErrorPage, ErrorSection,ErrorModal, 오류 메세지만 표시하는 text로 나뉩니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="errorpage">ErrorPage<a class="hash-link" aria-label="ErrorPage에 대한 직접 링크" title="ErrorPage에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/fe-error-handleing#errorpage">​</a></h3>
<p>Router오류 처럼 오류가 페이지 전체에 영향이 있을 경우, ErrorPage를 사용하고 있습니다.
ErrorPage에서 ErrorSection을 사용해 코드 중복을 줄이고, 사용자에게 일관된 오류 UI를 제공합니다.</p>
<p><strong>◾ Router 오류 시 ErrorPage</strong></p>
<img style="max-width:600px;margin:0 auto;display:block" src="https://your-docusaurus-site.example.com/assets/images/errorPage-822e622bfcdb1d81b75c24c0de8dd902.png" alt="Router 오류 시 보이는 ErrorPage 이미지">
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="errormodal-errorsection">ErrorModal, ErrorSection<a class="hash-link" aria-label="ErrorModal, ErrorSection에 대한 직접 링크" title="ErrorModal, ErrorSection에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/fe-error-handleing#errormodal-errorsection">​</a></h3>
<p>React Query를 사용한 API 요청 실패 시 QueryErrorResetBoundary가 오류를 감지합니다. 그리고 ErrorBoundary의 fallback으로 지정한 ErrorModal 또는 ErrorSection이 마운트됩니다.</p>
<p>API 요청 실패가 현재 화면에 끼치는 영향에 따라 ErrorModal 또는ErrorSection을 사용할 지 판단하고 있습니다.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="errorsection">ErrorSection<a class="hash-link" aria-label="ErrorSection에 대한 직접 링크" title="ErrorSection에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/fe-error-handleing#errorsection">​</a></h4>
<p>페이지가 렌더링될 때 데이터를 불러와 화면을 그려야하는 경우에는 데이터를 불러오는 동안 화면에 로딩을 보여줘야하기 때문에, Suspense와 함께 ErrorBoundary의 fallback으로 ErrorSection이 적용된 <code>ErrorSuspenseContainer</code>컴포넌트를 구현해 사용하고 있습니다.</p>
<p><strong>◾ 잘못된 API 요청으로 인해 데이터를 받지 못하는 경우 ErrorSection</strong></p>
<img style="max-width:600px;margin:0 auto;display:block" src="https://your-docusaurus-site.example.com/assets/images/errorSection-72fa99909fcc53df86e022c7f8a1adae.png" alt="리뷰 제출 실패 시 나오는 ErrorModal">
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="errormodal">ErrorModal<a class="hash-link" aria-label="ErrorModal에 대한 직접 링크" title="ErrorModal에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/fe-error-handleing#errormodal">​</a></h4>
<p>API 요청 실패가 화면에 영향을 주지 않은 경우, 오류 메세지를 표시할 필요가 없으면 ErrorModal을 사용합니다.</p>
<p><strong>◾리뷰 제출 실패 시 ErrorModal</strong></p>
<img style="max-width:600px;margin:0 auto;display:block" src="https://your-docusaurus-site.example.com/assets/images/errorModal-498c123d814d417192d2875f2e9ddb85.png" alt="리뷰 제출 실패 시 나오는 ErrorModal">
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="text">text<a class="hash-link" aria-label="text에 대한 직접 링크" title="text에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/fe-error-handleing#text">​</a></h3>
<p>API 요청 실패 시, 단순히 오류 메세지를 띄워야 하며 현재 화면에 영향을 주면 안되는 경우에는 string 타입의 오류 메세지를 화면에 표시하고 있습니다.</p>
<p><strong>◾유효하지 않은 비밀 번호 조회 시, 오류 메세지</strong></p>
<img style="max-width:600px;margin:0 auto;display:block" src="https://your-docusaurus-site.example.com/assets/images/passwordError-1ede03e926fd0c2d9fae075d722eb490.png" alt="리뷰 제출 실패 시 나오는 ErrorModal">
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="consoleerror">console.error<a class="hash-link" aria-label="console.error에 대한 직접 링크" title="console.error에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/fe-error-handleing#consoleerror">​</a></h2>
<p>js오류처럼 사용자에게 오류 메세지를 보여줄 필요가 없다면, console.error로 콘솔에만 오류를 표시하기로 했다.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="참고자료">참고자료<a class="hash-link" aria-label="참고자료에 대한 직접 링크" title="참고자료에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/fe-error-handleing#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C">​</a></h4>
<ul>
<li><a href="https://shopping-developers.kakao.com/hc/ko/articles/4578818403343-%EC%9D%91%EB%8B%B5-%EC%BD%94%EB%93%9C-%EB%B0%8F-%EC%97%90%EB%9F%AC-%EC%BD%94%EB%93%9C" target="_blank" rel="noopener noreferrer">카카오의 API 공통 가이드- 응답 코드 및 에러 코드</a></li>
</ul>]]></content:encoded>
            <category>blog</category>
        </item>
        <item>
            <title><![CDATA[Nginx 설정 형상관리하기]]></title>
            <link>https://your-docusaurus-site.example.com/blog/versioning-nginx</link>
            <guid>https://your-docusaurus-site.example.com/blog/versioning-nginx</guid>
            <pubDate>Mon, 09 Sep 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[이전의 리뷰미는 nginx 설정을 바꾸기 위해 직접 인스턴스에 접속해야 했습니다.]]></description>
            <content:encoded><![CDATA[<p>이전의 리뷰미는 nginx 설정을 바꾸기 위해 직접 인스턴스에 접속해야 했습니다.
또, 개발 서버와 운영 서버와의 nginx 설정도 서로 달랐습니다.
현재는 GitHub에 <code>.conf</code>와 <code>docker-compose.yml</code> 파일을 관리하고 있고, 해당 부분의 변경 사항이 인스턴스에 전파됩니다.
이 글에서는 서로 다른 nginx 설정 정보를 어떻게 통합했는지에 대해서 다룹니다.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-서로-다른-환경-설정">🤨 서로 다른 환경 설정<a class="hash-link" aria-label="🤨 서로 다른 환경 설정에 대한 직접 링크" title="🤨 서로 다른 환경 설정에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/versioning-nginx#-%EC%84%9C%EB%A1%9C-%EB%8B%A4%EB%A5%B8-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95">​</a></h2>
<p>운영 서버와 개발 서버로 분리되는 순간 관리해야 하는 부분이 하나 더 생기게 됩니다.
인스턴스가 최소 한 개 추가되기도 하고, 여러 이유들로 인해 인프라에 작업을 해 두었다면 더욱 그렇겠죠.
리뷰미도 https 통신을 위해 nginx를 사용하고 있었고, 개발 서버와 운영 서버에 각각 설치돼 있었습니다.</p>
<p>관리 포인트가 많아진다는 것은 결국 한 번의 수정이 곧 두 번의 수정이라는 의미입니다.
개발 서버에서 충분한 테스트 후 운영 서버로 반영해야 할 때에는, 어떤 부분이 수정되었는지 다시 비교해보아야 해요.
이 과정에서 실수할 수 있는 것은 분명하거니와 실수하더라도 빠르게 바로잡을 수 없었습니다.</p>
<p>가만 봅시다. <strong>이거 어디에서 많이 본 상황 아닌가요?</strong></p>
<p>처음 프로젝트를 시작하고 얼마 안 돼 같은 일을 겪었습니다.
빌드하고, <code>.jar</code> 파일을 만들고, 이를 인스턴스로 옮겨 <code>java -jar</code> 명령어를 통해 서버를 실행하기까지.
불편함은 오류를 회복하는 시간을 더디게 만들었고 효율적인 업무에 방해가 될 뿐이었습니다.
이를 해결하기 위해 CD 자동화를 진행했어요. 실행 파일을 빌드하는 것부터 실제 서버에 업로드 및 실행하는 것을 빠르게 확인할 수 있었습니다.</p>
<p>일련의 과정들을 인프라에도 적용할 수 있지 않을까요?</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="️-nginx를-git으로-관리하라고요">🕸️ nginx를 Git으로 관리하라고요?<a class="hash-link" aria-label="🕸️ nginx를 Git으로 관리하라고요?에 대한 직접 링크" title="🕸️ nginx를 Git으로 관리하라고요?에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/versioning-nginx#%EF%B8%8F-nginx%EB%A5%BC-git%EC%9C%BC%EB%A1%9C-%EA%B4%80%EB%A6%AC%ED%95%98%EB%9D%BC%EA%B3%A0%EC%9A%94">​</a></h2>
<p>네, 이제는 nginx의 설정 파일을 Git으로 관리하려고 합니다.
실제로 nginx에서 우리의 설정은 <code>nginx.conf</code>와 <code>/conf.d</code> 하위의 파일들만 관리되고 있었어요.
추가적으로 Https를 위한 인증서 키가 <code>/cert</code> 디렉토리에 존재합니다만, 인증서는 이 글에서는 다루지 않습니다.</p>
<p>그렇다면 우리가 관리해야 하는 것은 <code>nginx.conf</code>, <code>/conf.d</code> 하위 파일들, 그리고 <code>docker-compose.yml</code>이 되겠습니다. 도커를 활용한 것은 운영-개발 서버의 환경 차이를 최대한 줄이기 위함이었지만, 개발 서버에서 이것저것 실험해 보면서 운영 서버와는 다른 환경이 되어버렸어요. 이 차이를 줄이기 위해서라도 <code>docker-compose.yml</code> 또한 버전 관리를 해야할 필요성을 느꼈습니다.</p>
<p><code>docker-compose.yml</code>에서는 포트 바인딩, 모니터링을 위한 exporter, 네트워크 정보가 포함돼 있습니다. 내부 설정에 필요한 부분과 로깅은 모두 호스트와 볼륨 매핑돼 있으므로, <code>down</code>, <code>up</code>을 진행하더라도 중요한 데이터는 손실되지 않습니다. 이 파일은 그대로 Git에 업로드되어도 괜찮겠네요!</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>경고</div><div class="admonitionContent_BuS1"><p>기본적으로 <strong>Private repository</strong>에 업로드되는 것을 원칙으로 합니다.<br>
Public에 업로드하는 경우 <strong>Actions secret</strong>으로 대부분의 정보를 공개하지 않을 것을 권장합니다.</p></div></div>
<div class="language-yaml codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_P25_">docker-compose.yml</div><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yaml codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">stable</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">alpine3.20</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./nginx.conf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/nginx/nginx.conf</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./logs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/log/nginx</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./conf.d</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/nginx/conf.d</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./cert</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/nginx/cert</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nginx_exporter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx_exporter</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> nginx</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx/nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">exporter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">1.3.0</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>nginx 설정 파일에는 운영 서버와 개발 서버가 서로 다르게 적혀야하는 부분이 있습니다. IP/Port와 같은 <code>upstream</code> 정보와 <code>server_name</code>이예요. <code>app-dev.conf</code>, <code>app-prod.conf</code>와 같이 두 개의 파일로 관리해야 할까요? 저희는 관리 포인트가 늘어나는 것이 싫어서 여러 방법을 찾아 보았어요.</p>
<div class="language-nginx codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_P25_">conf.d/app.conf</div><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-nginx codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token directive keyword" style="color:#00009f">upstream</span><span class="token directive"> app</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token directive keyword" style="color:#00009f">server</span><span class="token directive"> 10.1.2.3:8080</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 개발 서버와 운영 서버와의 IP와 포트가 다릅니다</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token directive keyword" style="color:#00009f">server</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token directive keyword" style="color:#00009f">listen</span><span class="token directive"> </span><span class="token directive number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token directive keyword" style="color:#00009f">server_name</span><span class="token directive"> your-domain.here.com</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># https 리다이렉션..</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token directive keyword" style="color:#00009f">server</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token directive keyword" style="color:#00009f">listen</span><span class="token directive"> </span><span class="token directive number" style="color:#36acaa">443</span><span class="token directive"> ssl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token directive keyword" style="color:#00009f">server_name</span><span class="token directive"> your-domain.here.com</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 인증서, 리버스 프록싱 설정..</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>리눅스에서는 <code>envsubst</code>라는 프로그램을 제공합니다. <code>environment variable substitution</code>, 환경 변수 치환이예요. 문자열을 제공한 뒤, 리눅스 내 환경 변수가 존재한다면 해당 내용으로 치환합니다. 이때, <code>${VAR_NAME}</code>와 같은 형태로 제공해야 해요.</p>
<p>그렇다면 환경 변수에 서버와 도메인 정보를 미리 넣어둔 뒤, 설정 파일에 치환할 변수를 추가한다면 어떨까요? 아래와 같은 모습이 되겠습니다. 환경 변수를 어떻게 설정할지는 GitHub Actions에서 다시 설명드리도록 할게요!</p>
<div class="language-nginx codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_P25_">conf.d/app.conf</div><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-nginx codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token directive keyword" style="color:#00009f">upstream</span><span class="token directive"> app</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token directive keyword" style="color:#00009f">server</span><span class="token directive"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">UPSTREAM_URL</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token directive keyword" style="color:#00009f">server</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token directive keyword" style="color:#00009f">listen</span><span class="token directive"> </span><span class="token directive number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token directive keyword" style="color:#00009f">server_name</span><span class="token directive"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">SERVER_URL</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token directive keyword" style="color:#00009f">server</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token directive keyword" style="color:#00009f">listen</span><span class="token directive"> </span><span class="token directive number" style="color:#36acaa">443</span><span class="token directive"> ssl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token directive keyword" style="color:#00009f">server_name</span><span class="token directive"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">SERVER_URL</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-자동화-스크립트-작성">🔥 자동화 스크립트 작성<a class="hash-link" aria-label="🔥 자동화 스크립트 �작성에 대한 직접 링크" title="🔥 자동화 스크립트 작성에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/versioning-nginx#-%EC%9E%90%EB%8F%99%ED%99%94-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EC%9E%91%EC%84%B1">​</a></h2>
<p>이제는 모든 것이 Git으로 관리되고 있고, 변경 사항을 인스턴스에 적용하면 됩니다. CI/CD를 적용했을 때처럼, GitHub Actions를 활용해 인스턴스에 반영해 봅시다. 디렉토리 구조는 아래와 같습니다.</p>
<div class="codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-text codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">🗂️ nginx</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"> ∟ 🗂️ conf.d</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">     ∟ ⬢ app.conf</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    🐳 docker-compose.yml</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    ⬢ nginx.conf</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="변경-사항에-따라-다르게-적용하기">변경 사항에 따라 다르게 적용하기<a class="hash-link" aria-label="변경 사항에 따라 다르게 적용하기에 대한 직접 링크" title="변경 사항에 따라 다르게 적용하기에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/versioning-nginx#%EB%B3%80%EA%B2%BD-%EC%82%AC%ED%95%AD%EC%97%90-%EB%94%B0%EB%9D%BC-%EB%8B%A4%EB%A5%B4%EA%B2%8C-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0">​</a></h3>
<p>몇 가지 따져봐야 할 것이 있습니다. 다음과 같이 두 가지 경우로 나뉘는데요,</p>
<ul>
<li><code>docker-compose</code>가 변경되는 경우</li>
<li><code>.conf</code> 파일만 변경되는 경우</li>
</ul>
<p>전자의 경우 컨테이너를 다시 띄워야 하겠지만, 후자의 경우에는 nginx에게 새로고침 명령만 내리면 됩니다. 즉 <code>.conf</code>만 변경되었을 때 컨테이너가 다시 띄워질 필요가 없다는 의미입니다. 이를 어떻게 판단할 수 있을까요?</p>
<p>우선 workflow가 돌아가기 위해 <code>/nginx</code> 아래 파일이 바뀌어야 한다는 전제가 있습니다. 해당 스크립트가 돌아간다는 의미는 <code>/nginx</code> 내부에 변경이 일어났다는 것과 같아요.
그렇다면 커밋 이력에서 <code>docker-compose.yml</code>이 변경되었는지만 확인하면 되지 않을까요?</p>
<p><code>actions/checkout@v4</code>에서는 workflow를 실행하게 한 브랜치를 가져옵니다. 이를 활용해 이전 커밋과 현재 커밋을 비교해 봅시다. 브랜칭 전략을 조금 활용한다면 문제를 해결할 수 있어요.</p>
<img src="https://your-docusaurus-site.example.com/assets/images/git-dcff4c8e0f33132e17b5ac154c2b15bd.png" alt="git">
<p>PR을 통해 Squash and merge를 진행하게 되면 변경 이력이 하나의 커밋으로 바뀌게 됩니다(그림 왼쪽). 직전 커밋과 Squash된 현재 커밋을 비교해 <code>docker-compose.yml</code>이 존재하는지 찾아보는 것도 하나의 방법입니다. Merge commit을 사용하게 된다면 위 그림과 같은 상황에서 <code>docker-compose.yml</code>의 변경 사항을 눈치챌 수 없습니다.</p>
<p><code>git diff HEAD^ HEAD</code>를 통해 <code>HEAD</code>의 부모 커밋과 <code>HEAD</code> 커밋을 비교할 수 있습니다. <code>--name-only</code> 옵션을 사용하면 변경된 파일만을 확인할 수 있죠. 이를 <code>grep</code>을 통해 받아내 봅시다. 해당 값이 존재한다면 <code>docker-compose</code> 설정이 변경된 것이고, 그렇지 않다면 <code>.conf</code>만이 변경되었겠죠? 그림을 아래와 같은 글로 풀어봅시다.</p>
<div class="language-plaintext codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-plaintext codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"># Merge commit이 진행되는 경우, HEAD^에 비해 HEAD에 변경된 것은 conf/app.conf 뿐이다.</span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">HEAD  | commit ab92d1: modified conf/app.conf</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">HEAD^ | commit 3f4a2d: modified nginx.conf</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      | commit bbacf6: modified docker-compose.yml</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">---</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"># Squash and merge가 진행되는 경우 세 개의 커밋이 하나의 커밋으로 합쳐짐</span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">HEAD  | commit f0139c: modified nginx.conf, conf.d/app.conf, docker-compose.yml</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">HEAD^ | commit facc24: modified readme.md</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>해당 규칙을 사용하지 않고 다양한 방법을 활용해 변경사항을 찾아낼 수도 있겠지만, 저희가 찾은 효율적인 방법 중 하나라 사용하게 되었어요.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>정보</div><div class="admonitionContent_BuS1"><p>GitHub Actions의 <code>actions/checkout@v4</code>를 활용한다면, <code>fetch-depth</code>가 기본으로 1이라 가장 최근 커밋만을 불러오게 됩니다. <code>HEAD</code>와 그 부모 커밋을 비교하기 위해서는 최소 <strong>2 이상의 값</strong>으로 설정해야 합니다.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="브랜치에-따라-다른-인스턴스에-적용하기">브랜치에 따라 다른 인스턴스에 적용하기<a class="hash-link" aria-label="브랜치에 따라 다른 인스턴스에 적용하기에 대한 직접 링크" title="브랜치에 따라 다른 인스턴스에 적용하기에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/versioning-nginx#%EB%B8%8C%EB%9E%9C%EC%B9%98%EC%97%90-%EB%94%B0%EB%9D%BC-%EB%8B%A4%EB%A5%B8-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4%EC%97%90-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0">​</a></h3>
<p>한 가지 더 신경써야할 점이 있습니다. 바로 개발 서버와 운영 서버가 분리되어있다는 점이예요. Actions가 개발 서버에만 붙어있다면 위쪽에서 <code>envsubst</code>를 할 이유도 없습니다. 다양한 서버에 적절하게 값을 주입하고 설정을 적용해야 했기에, 보다 유연하게 작성해야 해요.</p>
<p>개발 서버와 운영 서버에 변동이 일어났음을 어떻게 알 수 있을까요? 저희는 브랜치 이름에 따라 이를 분기했습니다. <code>runs-on</code>을 알아내기 위해 우선 브랜치 이름을 가져오고, 이를 기반으로 <code>job</code>이 돌아갈 러너를 선택하도록 했어요. <code>outputs</code>를 통해 각 <code>step</code>에서 <code>$GITHUB_OUTPUT</code>으로 쓰인 값들을 서로 공유할 수 있습니다. 자세한 내용은 <a href="https://docs.github.com/en/actions/writing-workflows/choosing-what-your-workflow-does/passing-information-between-jobs" target="_blank" rel="noopener noreferrer"><strong>이곳</strong></a>을 확인해주세요!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-결과-스크립트와-앞으로의-숙제">🔍 결과 스크립트와 앞으로의 숙제<a class="hash-link" aria-label="🔍 결과 스크립트와 앞으로의 숙제에 대한 직접 링크" title="🔍 결과 스크립트와 앞으로의 숙제에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/versioning-nginx#-%EA%B2%B0%EA%B3%BC-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EC%99%80-%EC%95%9E%EC%9C%BC%EB%A1%9C%EC%9D%98-%EC%88%99%EC%A0%9C">​</a></h2>
<p>최종적으로 아래와 같은 스크립트가 만들어집니다. 이제 nginx 설정을 위해 인스턴스에 터미널로 접속하던 시절은 안녕. 보다 안전하고 깔끔하게, 한 곳의 변화로 모든 곳에 적용할 수 있는 제반이 마련되었습니다. 저희 목표는 언젠가 모든 인프라를 터미널을 들어가지 않고 관리하는 것이예요. 꾸준하게 불편한 것을 밖에서 쉽게 적용하도록 하면 언젠가 할 수 있지 않을까요? 😋</p>
<div class="language-yaml codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_P25_">.github/workflows/nginx.yml</div><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yaml codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187 codeBlockLinesWithNumbering_OFgW"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Configure nginx'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> develop</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> release</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'nginx/**'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">workflow_dispatch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">WORKING_DIRECTORY</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/home/ubuntu/nginx'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">DEV_SERVER_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'develop-domain.com'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">DEV_UPSTREAM_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'1.2.3.4:8080'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">PROD_SERVER_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'production-domain.com'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">PROD_UPSTREAM_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'5.6.7.8:8082'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">select-environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">outputs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> steps.set</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">env.outputs.instance </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Select instance</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> set</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">env</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          if [[ '${{ github.ref }}' = 'refs/heads/release' ]]; then</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo "instance=prod" &gt;&gt; "$GITHUB_OUTPUT"</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          else</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo "instance=dev" &gt;&gt; "$GITHUB_OUTPUT"</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          fi</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">configure-nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">needs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> select</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">environment</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> needs.select</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">environment.outputs.instance </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Checkout repository</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v4</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">fetch-depth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Set environment variables</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          if [[ '${{ github.ref }}' = 'refs/heads/release' ]]; then</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo 'Setting prod environment variables'</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo 'SERVER_URL=${{ env.PROD_SERVER_URL }}' &gt;&gt; $GITHUB_ENV</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo 'UPSTREAM_URL=${{ env.PROD_UPSTREAM_URL }}' &gt;&gt; $GITHUB_ENV</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          else</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo 'Setting dev environment variables'</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo 'SERVER_URL=${{ env.DEV_SERVER_URL }}' &gt;&gt; $GITHUB_ENV</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo 'UPSTREAM_URL=${{ env.DEV_UPSTREAM_URL }}' &gt;&gt; $GITHUB_ENV</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          fi</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Replace variables using envsubst</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          cat ./nginx/conf.d/app.conf | envsubst '${SERVER_URL},${UPSTREAM_URL}' &gt; ./nginx/conf.d/app.conf.tmp</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          mv ./nginx/conf.d/app.conf.tmp ./nginx/conf.d/app.conf</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Copy nginx configuration files</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cp </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">r ./nginx/* $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> env.WORKING_DIRECTORY </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Restart docker if docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">compose has changed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> else reload nginx</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          if [[ -n $(git diff --name-only HEAD^ HEAD | grep 'docker-compose.yml') ]]; then</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            cd ${{ env.WORKING_DIRECTORY }}</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            sudo docker-compose down || true</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            sudo docker-compose up -d</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo 'Docker restarted'</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          else</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            sudo docker exec nginx nginx -s reload</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo 'Nginx reloaded'</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          fi</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>여전히 해결해야 할 과제는 남아 있습니다. 각각의 <code>.conf</code> 파일과 <code>docker-compose.yml</code> 파일이 올바른 문법을 갖추고 있는지 확인할 방법이 필요합니다. <code>nginx -t</code>를 통해 설정 파일 문법을 확인해야 하는데, 이 부분을 조금 더 공부해보아야겠습니다.</p>]]></content:encoded>
            <category>blog</category>
            <category>infra</category>
        </item>
        <item>
            <title><![CDATA[우리 팀에 맞는 도메인 설계는 무엇일까?]]></title>
            <link>https://your-docusaurus-site.example.com/blog/domain-design-2</link>
            <guid>https://your-docusaurus-site.example.com/blog/domain-design-2</guid>
            <pubDate>Tue, 27 Aug 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[프로젝트 구현을 위한 설계 과정에서 발생한 문제와 이를 해결하기 위한 과정을 기록했습니다.]]></description>
            <content:encoded><![CDATA[<br>
<blockquote>
<p>프로젝트 구현을 위한 설계 과정에서 발생한 문제와 이를 해결하기 위한 과정을 기록했습니다.
이 글의 예시 코드는 당시 상황을 이해하기 쉽게 간결하게 구성되었습니다.✍️</p>
</blockquote>
<br>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-도메인-설계를-위한-erd-작성">1. 도메인 설계를 위한 ERD 작성<a class="hash-link" aria-label="1. 도메인 설계를 위한 ERD 작성에 대한 직접 링크" title="1. 도메인 설계를 위한 ERD 작성에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design-2#1-%EB%8F%84%EB%A9%94%EC%9D%B8-%EC%84%A4%EA%B3%84%EB%A5%BC-%EC%9C%84%ED%95%9C-erd-%EC%9E%91%EC%84%B1">​</a></h2>
<p>프로젝트 기획 후, 구현을 위해서 제일 처음 한 것은 ERD 작성이었습니다.
JPA를 사용하기 위해서 도메인 설계를 하기 전에 ERD를 먼저 작성했습니다.</p>
<p style="text-align:center"><img src="https://your-docusaurus-site.example.com/assets/images/first_erd-b4bc7a0feec4ac3b8fe2215727d92648.png"></p>
<p>JPA를 위한 ERD가 먼저 작성된 후 도메인을 설계하니, 도메인 관점과 맞지 않는 부분이 생겼습니다.</p>
<p>특정 멤버가 자신이 참여한 프로젝트에 대한 리뷰를 받기 위해 프로젝트명(<code>group_name</code>)을 설정하고, 리뷰 그룹을 생성합니다.
이후 다른 사람들이 해당 리뷰 그룹에 리뷰를 작성하면, 멤버는 자신의 리뷰 그룹을 통해 받은 리뷰를 확인할 수 있어야 합니다.</p>
<p>논리적으로는 도메인 관점에서 객체의 연관 관계 방향이 <code>ReviewGroup</code> → <code>Review</code>가 되어야 합니다.
하지만, DB 관점에서는 <code>Review</code>가 <code>ReviewGroup</code>을 <code>@ManyToOne</code>으로 참조하고 있기 때문에 실제 구현에서는 <code>Review</code>가 <code>ReviewGroup</code>을 참조하는 방향으로 설계됩니다.</p>
<ul>
<li>여기서 리뷰와 리뷰 그룹의 관계뿐만 아니라, 리뷰에 포함되는 리뷰 질문과 답변에 대한 경우도 만찬가지이나, 이 글에서는 리뷰와 리뷰 그룹 간의 관계에 대해서만 설명하겠습니다</li>
</ul>
<br>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-도메인-설계-관점과-db-설계-관점의-비교">2. 도메인 설계 관점과 DB 설계 관점의 비교<a class="hash-link" aria-label="2. 도메인 설계 관점과 DB 설계 관점의 비교에 대한 직접 링크" title="2. 도메인 설계 관점과 DB 설계 관점의 비교에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design-2#2-%EB%8F%84%EB%A9%94%EC%9D%B8-%EC%84%A4%EA%B3%84-%EA%B4%80%EC%A0%90%EA%B3%BC-db-%EC%84%A4%EA%B3%84-%EA%B4%80%EC%A0%90%EC%9D%98-%EB%B9%84%EA%B5%90">​</a></h2>
<p>도메인 설계 관점에서 <code>Review</code> 와 <code>ReviewGroup</code> 은 스스로 자신의 상태를 책임집니다. <code>Review</code>는 생성될 때 스스로 리뷰 내용을 검증한 후 생성됩니다.
이후 <code>ReviewGroup</code>에 포함될 때에는 그 자체로 검증된 객체로 제공되며, <code>ReviewGroup</code> 은 리뷰 작성자가 리뷰 그룹의 소유자와 일치하는지 등 규칙이나 정책에 따라 <code>Review</code>가 자신에게 속할 수 있는지 만을 확인합니다.</p>
<div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 리뷰 생성자</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Review</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Member</span><span class="token plain"> reviewer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token function" style="color:#d73a49">validateContent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reviewer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reviewer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">content </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ReviewGroup</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">		</span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Review</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> reviews</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">addReview</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Review</span><span class="token plain"> review</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">canAddReview</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">review</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// 리뷰 그룹 포함 검증 실패 예외</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        reviews</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">review</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">canAddReview</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Review</span><span class="token plain"> review</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Review를 그룹에 추가할 수 있는지 검증하는 로직</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<br>
<p>하지만 DB 설계를 따라 <code>Review</code>가 <code>ReviewGroup</code>을 참조하는 방향으로 설계되면, 리뷰가 생성되는 순간에 리뷰 그룹이 정해집니다.
따라서 <code>Review</code> 가 생성되는 순간에 스스로 리뷰 내용을 검증할 뿐만 아니라, <code>ReviewGroup</code> 과의 협력을 통해 자신이 해당 그룹에 속할 수 있는지도 함께 검증해야 합니다.</p>
<div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Review</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">		</span><span class="token comment" style="color:#999988;font-style:italic">// 다른 필드</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">ReviewGroup</span><span class="token plain"> reviewGroup</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Review</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Member</span><span class="token plain"> reviewer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">ReviewGroup</span><span class="token plain"> reviewGroup</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token function" style="color:#d73a49">validateContent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token function" style="color:#d73a49">validateInclusionInReviewGroup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reviewGroup</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reviewer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reviewer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reviewGroup </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reviewGroup</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">content </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">validateInclusionInReviewGroup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ReviewGroup</span><span class="token plain"> reviewGroup</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">reviewGroup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">canAddReview</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// 리뷰 그룹 포함 검증 실패 예외</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>이렇게 도메인 설계와 DB 설계 간의 <strong>연관 관계 방향의 불일치</strong>가 있을 때 발생할 수 있는 문제가 있습니다.</p>
<br>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-도메인과-db-연관-관계-방향의-불일치로-인한-문제">3. 도메인과 DB 연관 관계 방향의 불일치로 인한 문제<a class="hash-link" aria-label="3. 도메인과 DB 연관 관계 방향의 불일치로 인한 문제에 대한 직접 링크" title="3. 도메인과 DB 연관 관계 방향의 불일치로 인한 문제에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design-2#3-%EB%8F%84%EB%A9%94%EC%9D%B8%EA%B3%BC-db-%EC%97%B0%EA%B4%80-%EA%B4%80%EA%B3%84-%EB%B0%A9%ED%96%A5%EC%9D%98-%EB%B6%88%EC%9D%BC%EC%B9%98%EB%A1%9C-%EC%9D%B8%ED%95%9C-%EB%AC%B8%EC%A0%9C">​</a></h2>
<p><code>ReviewGroup</code> 은 <code>Review</code>를 그룹으로 관리하기 위해 만들어진 도메인으로, 재사용보단 관리의 목적이 큽니다.
그러나 <code>Review</code>는 <code>ReviewGroup</code> 없는 상황에서도 독립적으로 재사용이 가능해야 합니다.</p>
<p>하지만 DB 설계를 따라 <code>Review</code>가 <code>ReviewGroup</code>을 참조하는 방향으로 설계되면, <code>Review</code>에는 리뷰 그룹 포함과 관련된 검증이 포함되게 됩니다.</p>
<div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">validateInclusionInReviewGroup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ReviewGroup</span><span class="token plain"> reviewGroup</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">reviewGroup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">canAddReview</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// 리뷰 그룹 포함 검증 실패 예외</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<br>
<p>이는 <code>Review</code> 가 <code>Review</code>  자체에 대한 책임뿐만 아니라, <code>ReviewGroup</code>의 책임도 지니게 하면서 <strong>단일 책임 원칙을 위반</strong>하게 됩니다.</p>
<ul>
<li><code>Review</code>는 <code>ReviewGroup</code> 이 없는 상황에서 독립적으로 재사용할 수 없게 됩니다.</li>
<li><code>Review</code>가 <code>ReviewGroup</code>의 기능을 직접 사용하게 되면서 <code>ReviewGroup</code>이 관리해야 할 책임이 <code>Review</code>로 넘어가게 됩니다.</li>
<li><code>Review</code>는 <code>ReviewGroup</code>의 변경에 영향을 받게 됩니다.</li>
</ul>
<p><em>단일 책임 원칙</em>에 따르면, 모듈은 한 가지 이유로만 변경되어야 하지만, <code>Review</code>는 자체 변경뿐만 아니라 <code>ReviewGroup</code>의 변경에도 영향을 받습니다.
이는 <code>Review</code>와 <code>ReviewGroup</code> 간의 결합도를 높여 변경에 유연하지 못하는 상태를 초래하며, 유지 보수를 어렵게 만듭니다.</p>
<br>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-양방향-관계가-해결책이-될-수-있을까">4. 양방향 관계가 해결책이 될 수 있을까?<a class="hash-link" aria-label="4. 양방향 관계가 해결책이 될 수 있을까?에 대한 직접 링크" title="4. 양방향 관계가 해결책이 될 수 있을까?에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design-2#4-%EC%96%91%EB%B0%A9%ED%96%A5-%EA%B4%80%EA%B3%84%EA%B0%80-%ED%95%B4%EA%B2%B0%EC%B1%85%EC%9D%B4-%EB%90%A0-%EC%88%98-%EC%9E%88%EC%9D%84%EA%B9%8C">​</a></h2>
<p>처음에는 도메인 관점과 DB 관점의 연관 관계 방향 모두 충시키기 위해 양방향 관계를 사용했습니다.</p>
<div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Review</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Member</span><span class="token plain"> reviewer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">ReviewGroup</span><span class="token plain"> reviewGroup</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token function" style="color:#d73a49">validateContent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reviewer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reviewer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reviewGroup </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reviewGroup</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">content </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        reviewGroup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addReview</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>하지만 책임 분리가 명확하지 않고, 초기화되지 않은 상태에서의 참조로 인해 의도치 않은 문제가 발생했습니다.
양방향 관계에서 발생하는 문제를 해결하기 위해 추가적인 장치들을 도입했지만, 이는 오히려 로직을 복잡하게 만들었습니다.</p>
<p>결과적으로 개발자가 관리해야 할 부분을 증가시키기 때문에 문제를 해결하기보단, 새로운 문제를 야기하게 되어 해결책이 되지 못했습니다.</p>
<br>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-어떤-설계가-좋은-설계일까">5. 어떤 설계가 좋은 설계일까?<a class="hash-link" aria-label="5. 어떤 설계가 좋은 설계일까?에 대한 직접 링크" title="5. 어떤 설계가 좋은 설계일까?에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design-2#5-%EC%96%B4%EB%96%A4-%EC%84%A4%EA%B3%84%EA%B0%80-%EC%A2%8B%EC%9D%80-%EC%84%A4%EA%B3%84%EC%9D%BC%EA%B9%8C">​</a></h2>
<p>우리는 어떤 설계가 좋은 설계인지 계속해서 고민했습니다.</p>
<ul>
<li>로직을 작성하기 쉬운 설계</li>
<li>성능을 고려한 설계</li>
<li>변경에 유연하고 유지 보수에 용이한 설계</li>
</ul>
<p>다양한 쟁점들이 있었지만, 현재 우리 팀의 상황에 맞는 설계가 무엇인지 고민할 필요가 있었습니다.🤔</p>
<br>
<u>💡구현에 앞서 기획 단계에서 우리가 내렸던 결론을 다시 생각해 보았습니다.</u>
<p><strong>‘리뷰미’</strong> 는 팀 프로젝트를 같이 한 팀원들과 상호 리뷰를 통해서 긍정적인 경험을 제공하고자 했습니다.
이 목표를 달성하기 위해, 다양한 기능들을 제공하기보다는 <strong>‘리뷰’ 자체에 중점</strong>을 두어 리뷰이와 리뷰어 모두가 만족할 수 있는 <strong>품질 좋은 리뷰를 작성하게 하는 것</strong>을 목표로 했습니다.</p>
<p>따라서 리뷰 작성 폼을 지속적으로 발전시킬 필요가 있었고, 이는 리뷰 작성 폼이 언제든지 변경 가능하며, 리뷰의 질문 형태도 서술형이나 선택형 등 <strong>지속적으로 다양한 형태로 발전할 가능성을 염두에 두고</strong> 설계되어야 했습니다.</p>
<p>이러한 이유로 우리는 <strong>변경에 유연하게 대처할 수 있는 설계</strong>가 현재 팀의 상황에 맞는 가장 좋은 설계라고 결론을 내렸고, 이를 중심으로 다시 설계에 대한 고민을 이어갔습니다.</p>
<br>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-연관-관계를-다시-생각해보자">6. 연관 관계를 다시 생각해보자<a class="hash-link" aria-label="6. 연관 관계를 다시 생각해보자에 대한 직접 링크" title="6. 연관 관계를 다시 생각해보자에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design-2#6-%EC%97%B0%EA%B4%80-%EA%B4%80%EA%B3%84%EB%A5%BC-%EB%8B%A4%EC%8B%9C-%EC%83%9D%EA%B0%81%ED%95%B4%EB%B3%B4%EC%9E%90">​</a></h2>
<p>객체지향 설계에서 객체들은 서로 연관 관계를 맺음으로써 메시지를 주고받으며 협력합니다.
그러나 불필요한 연관 관계가 생기면 불필요한 책임이 생기고, 이는 변경에 유연하지 못하게 됩니다.</p>
<p>따라서 우리는 불필요한 연관 관계를 제거하고, 정말 필요한 곳만 연관 관계를 가지도록 했습니다.
이 과정에서 조영호 님의 <a href="https://www.youtube.com/watch?v=dJ5C4qRqAgA" target="_blank" rel="noopener noreferrer">우아한객체지향</a>을 통해 공부하고 참고했습니다.</p>
<br>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="객체를-묶는-기준">객체를 묶는 기준<a class="hash-link" aria-label="객체를 묶는 기준에 대한 직접 링크" title="객체를 묶는 기준에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design-2#%EA%B0%9D%EC%B2%B4%EB%A5%BC-%EB%AC%B6%EB%8A%94-%EA%B8%B0%EC%A4%80">​</a></h3>
<p>우리는 의존 받는 객체의 변경이 의존하는 객체에 영향을 미치는 것을 경험했습니다.
모든 의존 관계를 완전히 제거하는 것이 아니라, <strong>같이 변경되어야 하는 객체들</strong>만 묶는다면 다른 객체들은 변경에 영향을 미치지 않을 것이라고 생각했습니다.</p>
<p>같이 변경되어야 하는 객체들은 본질적으로 결합도가 높아 같이 변경되어도 무방하여, 도메인적인 관점에서 같이 처리되어야 할 객체들입니다.
우리는 이 기준을 <strong>생명 주기를 함께하는 객체</strong>로 설정했습니다.</p>
<p>현재 구현의 예시로는 리뷰(<code>Review</code>)와 리뷰에 작성된 답변(<code>TextAnswer</code>)이 있습니다.</p>
<ul>
<li>리뷰의 답변은 리뷰 없이 생성될 수 없고, 리뷰가 작성되는 시점에 항상 같이 생성됩니다.</li>
<li>리뷰 없이 답변만 있는 것이 불가능하기에, 리뷰가 삭제되면 답변도 항상 같이 생성됩니다.</li>
</ul>
<p>이러한 특성 때문에 <code>Review</code>와 <code>TextAnswer</code>는 생명 주기가 일치하며, 두 객체는 강한 결합 관계를 가집니다.
따라서 두 객체를 하나의 단위로 묶어 관리하는 것이 적절하다고 생각했습니다.</p>
<div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Review</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">		</span><span class="token comment" style="color:#999988;font-style:italic">// 다른 필드</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@OneToMany</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fetch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">FetchType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">EAGER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cascade </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">CascadeType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">PERSIST</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@JoinColumn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"review_id"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nullable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> updatable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">TextAnswer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> textAnswers</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<br>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="논리적인-연관-관계의-장점">논리적인 연관 관계의 장점<a class="hash-link" aria-label="논리적인 연관 관계의 장점에 대한 직접 링크" title="논리적인 연관 관계의 장점에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design-2#%EB%85%BC%EB%A6%AC%EC%A0%81%EC%9D%B8-%EC%97%B0%EA%B4%80-%EA%B4%80%EA%B3%84%EC%9D%98-%EC%9E%A5%EC%A0%90">​</a></h3>
<p>논리적으로 연관 관계를 재설정하면서 느꼈던 장점은</p>
<ol>
<li>객체 관계를 명확하게 정의함으로써, 설계 의도를 더 명확하게 드러낼 수 있었습니다.</li>
<li>변경이 발생할 때, 그 영향에 대한 범위가 명확함으로 예상 가능하며 다른 부분에 미치는 영향을 최소화할 수 있습니다. 이를 통해 코드 재사용을 높이고, 일관성을 유지할 수 있었습니다.</li>
<li>데이터베이스의 연관 관계에 따라 <code>CascadeType</code>과 <code>FetchType</code> 설정을 고민해야 했지만, 논리적인 기준을 세우고 객체를 묶음으로써 연관 관계 설정의 기준을 명확히 할 수 있었습니다.<!-- -->
<ul>
<li>두 객체는 함께 생성되고 관리되므로 <code>CascadeType.PERSIST</code> 설정을 주었습니다.</li>
<li>리뷰를 조회할 때, 답변도 함께 조회할 수 있도록 <code>FetchType.EAGER</code>를 사용했습니다.</li>
</ul>
</li>
</ol>
<br>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="간접-참조의-활용">간접 참조의 활용<a class="hash-link" aria-label="간접 참조의 활용에 대한 직접 링크" title="간접 참조의 활용에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design-2#%EA%B0%84%EC%A0%91-%EC%B0%B8%EC%A1%B0%EC%9D%98-%ED%99%9C%EC%9A%A9">​</a></h3>
<p>위에서 세운 기준을 통해 강한 결합 관계를 가지는 객체들을 묶어 관리하고 불필요한 연관 관계를 끊었습니다.
여기서 강한 결합 관계를 가지는 객체들이 아닌 객체들의 연관 관계를 모두 완전히 끊을 수는 없기에, 직접적인 객체 참조 대신 <code>id</code>를 사용하여 객체 간의 결합을 느슨하게 유지할 수 있게 했습니다.</p>
<div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Review</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Column</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"review_group_id"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nullable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> reviewGroupId</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<br>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-다중성을-가지는-연관-관계의-설정">7. 다중성을 가지는 연관 관계의 설정<a class="hash-link" aria-label="7. 다중성을 가지는 연관 관계의 설정에 대한 직접 링크" title="7. 다중성을 가지는 연관 관계의 설정에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design-2#7-%EB%8B%A4%EC%A4%91%EC%84%B1%EC%9D%84-%EA%B0%80%EC%A7%80%EB%8A%94-%EC%97%B0%EA%B4%80-%EA%B4%80%EA%B3%84%EC%9D%98-%EC%84%A4%EC%A0%95">​</a></h2>
<p>보통 다중성을 가지는 연관 관계에서 다중성이 적은 방향을 선택하는 것이 좋은 방법이라고 합니다.
(<code>@OneToMany</code> 대신 <code>@ManyToOne</code> 사용) 하지만 <code>Review</code>와 <code>TextAnswer</code> 관계에서 다중성이 적은 방향을 선택한다면, 이 역시 DB 설계 관점의 방향으로 도메인 설계 방향과 불일치가 발생하게 됩니다.</p>
<u>이 경우 우리는 <code>@OneToMany</code> 단방향을 사용했습니다.</u>
<p><code>@OneToMany</code> 단방향은 엔티티에서 연관 방향과 반대로 테이블에서는 Many 쪽에 FK가 관리되므로 작업한 엔티티가 아닌 다른 엔티티에서 쿼리가 발생하기 때문에 헷갈릴 수 있으며 추가 쿼리가 발생한다는 단점이 있습니다.</p>
<blockquote>
<p>예를 들어, <code>Review</code>를 저장한 후, <code>TextAnswer</code>가 추가되거나 삭제될 때, <code>TextAnswer</code> 테이블의 FK에 대한 <code>update</code> 쿼리가 추가로 발생하게 됩니다.</p>
</blockquote>
<br>
<p>리뷰미 정책 상 리뷰는 한 번 작성되면 변경될 수 없고, 함께 생성되고 삭제되기에 <code>Review</code>를 저장한 후, <code>TextAnswer</code>가 추가되거나 중간에 삭제되는 일이 없습니다.</p>
<p>따라서 <code>CascadeType.PERSIST</code>를 통해 함께 영속화 시키고, <code>@JoinColumn(nullable = false, updatable = false)</code>를 통해 <code>TextAnswer</code>의 FK 가 null 일 수 없으며 이후 변경되지 않도록 하여 <code>@OneToMany</code> 단뱡향의 단점을 상쇄시킬 수 있었습니다.</p>
<br>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-결론">8. 결론<a class="hash-link" aria-label="8. 결론에 대한 직접 링크" title="8. 결론에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design-2#8-%EA%B2%B0%EB%A1%A0">​</a></h2>
<p>이번 설계를 통해 객체들 간의 관계를 정의하는 기준을 재정립하고, 연관 관계가 불필요한 객체들은 <code>id</code>를 통해 간접적으로 관리하는 방식으로 접근했습니다.
이러한 방식은 여러 이점도 있었지만 단점도 존재했습니다.</p>
<ul>
<li>필요할 때만 DB에서 연관된 객체를 조회하기 때문에 불필요한 데이터를 가져오지 않도록 할 수 있지만, 이는 다르게 보면 연관된 객체를 필요로 할 때마다 별도의 쿼리를 통해 조회해야 하기 때문에 성능 저하가 발생할 수 있습니다.</li>
<li>간접 참조를 사용함으로써 책임이 명확하게 분리되고 독립적으로 관리되지만, 객체 간의 관계를 수동으로 처리해야 하는 부담이 생깁니다. 또 데이터 정합성을 유지하기 위한 추가적인 로직이 필요할 수 있습니다.</li>
</ul>
<p>이 외에도 더 많은 구현을 해보면 직접적으로 느끼는 것이 많을 거라 생각됩니다.</p>
<br>
<p>하지만 우리가 설계에서 고려했던 핵심 중 하나는 <strong>서비스 요구사항이 계속해서 변화할 가능성이 크다</strong>는 점이었습니다.
초기 기획이 계속해서 변경되었고, 향후에도 서비스 요구사항은 계속해서 변경할 가능성이 있습니다.
이러한 변화에 대비하기 위해, 우리는 확장성을 예측해서 구현하기보다는 <strong>확장성을 열어두는 방향</strong>으로 설계를 하는 것이 중요하다 생각했습니다.</p>
<p>우리는 이번 설계 과정을 통해 여러 가지 새로운 시도를 해보았고, 특정 상황에서 이론적으로 좋은 설계라고 여겨지던 부분들이 실제 구현에서는 예상치 못한 문제를 야기할 수 있음을 깨달았습니다.
이와 같은 경험들은 앞으로의 설계와 구현에서 더 나은 결정을 내릴 수 있는 기반이 될 것이라고 생각합니다.</p>]]></content:encoded>
            <category>blog</category>
        </item>
        <item>
            <title><![CDATA[리뷰미 프로젝트 기획 및 리뷰미 version 1.0.0 소개]]></title>
            <link>https://your-docusaurus-site.example.com/blog/release-version-1.0.0</link>
            <guid>https://your-docusaurus-site.example.com/blog/release-version-1.0.0</guid>
            <pubDate>Mon, 26 Aug 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[---]]></description>
            <content:encoded><![CDATA[<hr>
<h1>🚢 리뷰미 프로젝트 기획: 서비스 주제 선정부터 서비스 비전과 핵심 기능 검증까지</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="프로젝트-주제-선정">프로젝트 주제 선정<a class="hash-link" aria-label="프로젝트 주제 선정에 대한 직접 링크" title="프로젝트 주제 선정에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/release-version-1.0.0#%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%A3%BC%EC%A0%9C-%EC%84%A0%EC%A0%95">​</a></h2>
<p>2024-07-02 레벨3 시작과 함께 레벨3 프로젝트의 기획을 시작했습니다.
먼저 프로젝트의 주제 선정 회의를 거쳐 주제를 선정한 후, 프로젝트의 기능을 추렸습니다.
이후 추가적인 기획 회의를 통해 서비스의 타깃과 비전을 선정했습니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="리뷰미-서비스-타깃-및-비전-설명">리뷰미 서비스 타깃 및 비전 설명<a class="hash-link" aria-label="리뷰미 서비스 타깃 및 비전 설명에 대한 직접 링크" title="리뷰미 서비스 타깃 및 비전 설명에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/release-version-1.0.0#%EB%A6%AC%EB%B7%B0%EB%AF%B8-%EC%84%9C%EB%B9%84%EC%8A%A4-%ED%83%80%EA%B9%83-%EB%B0%8F-%EB%B9%84%EC%A0%84-%EC%84%A4%EB%AA%85">​</a></h3>
<p>리뷰미는 자신이 어떤 개발자인지 모르거나 이를 파악하기 어려운 개발자의 메타인지 및 자기표현 니즈를 해결하기 위해 탄생한 서비스입니다.</p>
<p>리뷰미는 사용자들이 협업을 함께한 동료의 피드백을 통해 자신이 어떤 개발자인지 파악하고 이를 표현할 수 있게 도와주는 것을 목표로 하고 있습니다.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="핵심-기능을-위한-실험들과-사용자-테스트">핵심 기능을 위한 실험들과 사용자 테스트<a class="hash-link" aria-label="핵심 기능을 위한 실험들과 사용자 테스트에 대한 직접 링크" title="핵심 기능을 위한 실험들과 사용자 테스트에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/release-version-1.0.0#%ED%95%B5%EC%8B%AC-%EA%B8%B0%EB%8A%A5%EC%9D%84-%EC%9C%84%ED%95%9C-%EC%8B%A4%ED%97%98%EB%93%A4%EA%B3%BC-%EC%82%AC%EC%9A%A9%EC%9E%90-%ED%85%8C%EC%8A%A4%ED%8A%B8">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="실험-목적과-방법">실험 목적과 방법<a class="hash-link" aria-label="실험 목적과 방법에 대한 직접 링크" title="실험 목적과 방법에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/release-version-1.0.0#%EC%8B%A4%ED%97%98-%EB%AA%A9%EC%A0%81%EA%B3%BC-%EB%B0%A9%EB%B2%95">​</a></h3>
<p>리뷰미 서비스의 목표를 위해서 선행되어야 하는 것은 '양질의 리뷰'입니다. 그래서 리뷰미 팀은 **'양질의 리뷰를 작성하는 것'**을 핵심 기능으로 선정했습니다.
리뷰미의 첫 번째 핵심 기능인 '양질의 리뷰 작성'을 위해 팀 내에서 사용자 테스트를 동반한 여러 실험들을 진행했습니다.</p>
<img style="max-width:500px;margin:0 auto;display:block" src="https://your-docusaurus-site.example.com/assets/images/experiment-22f56fddcf8aa9e775a737b75ac46343.jpg" alt="리뷰미팀이 실행한 실험 방법:질문 기획-팀 내 사용- 유저 테스트- 피드백 회의-질문 기획 순환">
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="실험-결과">실험 결과<a class="hash-link" aria-label="실험 결과에 대한 직접 링크" title="실험 결과에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/release-version-1.0.0#%EC%8B%A4%ED%97%98-%EA%B2%B0%EA%B3%BC">​</a></h3>
<p>리뷰미팀은 실험들을 통해 사용자의 니즈를 파악했습니다. 이를 바탕으로 '감정 강화'를 리뷰 방향으로 결정했고, 이에 맞추어 질문지를 개선해나갔습니다.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>🔖 결과 1. 실험을 통해서 도출해낸 것들</summary><div><div class="collapsibleContent_i85q"><div markdown="1"><ol><li><p>서비스의 1차 사용자 타깃인 우테코 크루들은 날카로운 리뷰보다는 긍정적이며
부드러운 리뷰 작성을 선호한다.</p></li><li><p>사용자들은 날카로운 피드백이더라도, 자신에 대한 리뷰어(=리뷰를 작성하는
사람)의 관심이 느껴지면 이를 긍정적으로 받아들인다.</p></li><li><p>사용자들은 리뷰가 정성스럽게 느껴질 때, 메타인지뿐만 아니라 팀워크가
단단해지는 경험을 한다.</p></li><li><p>리뷰어는 리뷰 작성 시, 리뷰이(= 리뷰를 받는 사람) 과의 기억을 떠올리는 것에
어려움을 느낀다.</p></li><li><p>리뷰어의 기억 회고 측면에서 서술형은 단점을 가지며, 이를 보안하기 위해 꼬리
질문과 객관식 질문이 필요하다.</p></li><li><p>선택된 강점 문항이 리뷰이의 강점으로 특정 지어지기 위해서 또는 강점으로써의 신뢰도를 얻기 위해서 선택할 수 있는 강점의 개수를 제한해야 한다.</p></li><li><p>더 많은 리뷰를 작성하고자 하는 니즈를 위해, 추가 리뷰 작성란이 있어야 한다.</p></li><li><p>리뷰어의 리뷰 작성 부담을 줄여주기 위해, 질문 개수는 5개 이하여야 한다.</p></li><li><p>질문 목록을 한 번에 보여주는 것은 리뷰어의 부담감을 높이며 집중력을
떨어뜨린다.</p></li></ol></div></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>🔖 결과2.실험을 통해 개선한 질문지 형식</summary><div><div class="collapsibleContent_i85q"><div markdown="2"><ol><li>강점 강화라는 리뷰 방향에 맞추어서 질문지는 '~해요'체를 사용한다.</li><li><p>리뷰미 서비스는 리뷰어와 리뷰이를 이어주는 제3자 역할(=대신 리뷰를
전해주는 역할)을 한다.</p></li><li><p>첫 질문은 리뷰어의 기억 회고를 도울 수 있는 질문으로 시작하며, 그다음
질문은 이에 대한 심층적인 리뷰를 할 수 있는 꼬리 질문으로 나아간다.</p></li><li><p>리뷰어의 기억 회고 및 리뷰이의 강점을 선택하는 데 도움을 주기 위해
객관식을 활용한다.</p></li><li><p>리뷰어가 선택한 리뷰이의 강점에 뒷받침이 되어줄 서술형 문답을 추가한다.</p></li><li><p>단점에 대한 피드백은 단점에서 끝내지 않고, 리뷰어가 리뷰이의 단점을 개선
방법을 제시해 리뷰이의 '성장'을 함께 고민할 수 있도록 한다.</p></li><li><p>추가적인 리뷰나 응원 등의 전하고 싶은 말이 있는 리뷰어를 위한, 서술형
문답을 추가한다. 단, 해당 문답은 선택형으로 리뷰어에게 선택권을 준다.</p></li><li><p>리뷰어의 리뷰 작성에 대한 부담감을 줄이고자 한 화면에 하나의 질문만
나오는 캐러셀을 이용한 카드 형식을 사용한다.</p></li><li><p>리뷰 제출 전, 리뷰어가 자신이 작성한 리뷰를 확인할 수 있는 기능(ex
모달)을 제공한다.</p></li></ol></div></div></div></details>
<hr>
<h1>리뷰미 version 1.0.0 소개</h1>
<p><a href="https://review-me.page/" target="_blank" rel="noopener noreferrer">🌟 리뷰미 배포 사이트 바로가기</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="시연-영상">시연 영상<a class="hash-link" aria-label="시연 영상에 대한 직접 링크" title="시연 영상에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/release-version-1.0.0#%EC%8B%9C%EC%97%B0-%EC%98%81%EC%83%81">​</a></h2>
<video width="600px" controls=""><source src="/assets/medias/version1-209e612b283213a68d2b695c88b1080d.mp4" type="video/mp4" alt="리뷰미 version 1.0.0 시연 영상"></video>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="기능-소개">기능 소개<a class="hash-link" aria-label="기능 소개에 대한 직접 링크" title="기능 소개에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/release-version-1.0.0#%EA%B8%B0%EB%8A%A5-%EC%86%8C%EA%B0%9C">​</a></h2>
<p>리뷰미 version 1.0.0은 리뷰를 받기 위한 url 생성, 리뷰 작성 및 받은 리뷰를 확인하는 기능을 제공하고 있습니다. 페이지별로 어떤 기능이 있는지 살펴보겠습니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="홈페이지---리뷰-url-생성">홈페이지 - 리뷰 url 생성<a class="hash-link" aria-label="홈페이지 - 리뷰 url 생성에 대한 직접 링크" title="홈페이지 - 리뷰 url 생성에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/release-version-1.0.0#%ED%99%88%ED%8E%98%EC%9D%B4%EC%A7%80---%EB%A6%AC%EB%B7%B0-url-%EC%83%9D%EC%84%B1">​</a></h3>
<img src="https://your-docusaurus-site.example.com/assets/images/home_page-1c0923571d461d4ed1333cf606240f4e.jpg" style="max-width:600px;margin:0 auto;display:block" alt="리뷰미 홈페이지">
<br>
<p>홈페이지는 리뷰미를 사용하는 방법에 대한 소개과 리뷰 url(= 리뷰 연결 페이지
url)을 생성하는 폼(이하 리뷰 url 생성폼)을 제공합니다. 리뷰 url은 해당 리뷰에
대한 고유한 url로, 리뷰를 받고자하는 사람에게 리뷰 url을 공유하면 됩니다.</p>
<p>리뷰 url 생성폼에서 리뷰를 받는 사람 이름, 리뷰 받고자하는 프로젝트와 리뷰 확인 시 필요한 비밀번호를 입력합니다. 모든 입력이 유효한 경우 리뷰 url 생성 버튼이 활성화됩니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="리뷰-연결-페이지---리뷰-쓰기-및-리뷰-확인">리뷰 연결 페이지 - 리뷰 쓰기 및 리뷰 확인<a class="hash-link" aria-label="리뷰 연결 페이지 - 리뷰 쓰기 및 리뷰 확인에 대한 직접 링크" title="리뷰 연결 페이지 - 리뷰 쓰기 및 리뷰 확인에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/release-version-1.0.0#%EB%A6%AC%EB%B7%B0-%EC%97%B0%EA%B2%B0-%ED%8E%98%EC%9D%B4%EC%A7%80---%EB%A6%AC%EB%B7%B0-%EC%93%B0%EA%B8%B0-%EB%B0%8F-%EB%A6%AC%EB%B7%B0-%ED%99%95%EC%9D%B8">​</a></h3>
<img src="https://your-docusaurus-site.example.com/assets/images/zone-dbd4f74c9e5b94dd89b0e52426f3ccd5.jpg" style="max-width:600px;margin:0 auto;display:block" alt="리뷰미 연결 페이지">
<br>
<p>비회원제인 리뷰미 서비스는 하나의 url을 통해 리뷰 쓰기와 확인하기를 할 수 있게하기위해, 리뷰 연결 페이지를 제공하고 있습니다.</p>
<p>홈페이지에서 생성한 리뷰 url은 바로 리뷰 연결 페이지 주소입니다.
리뷰 연결 페이지에는 리뷰 쓰기 버튼과 리뷰 확인하기 버튼이 있습니다. 리뷰쓰기 버튼을 클릭하면 리뷰 작성 페이지로 이동하고, 리뷰 확인하기 버튼을 클릭해 모달 창에서 올바른 비밀번호를 조회하면 리뷰 목록 페이지로 이동합니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="리뷰-작성-페이지---리뷰-쓰기">리뷰 작성 페이지 - 리뷰 쓰기<a class="hash-link" aria-label="리뷰 작성 페이지 - 리뷰 쓰기에 대한 직접 링크" title="리뷰 작성 페이지 - 리뷰 쓰기에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/release-version-1.0.0#%EB%A6%AC%EB%B7%B0-%EC%9E%91%EC%84%B1-%ED%8E%98%EC%9D%B4%EC%A7%80---%EB%A6%AC%EB%B7%B0-%EC%93%B0%EA%B8%B0">​</a></h3>
<img src="https://your-docusaurus-site.example.com/assets/images/writing-3e5ed3a1d6787a47a14a4ab7373dff76.jpg" style="max-width:600px;margin:0 auto;display:block" alt="리뷰미 작성 페이지">
<br>
<p>리뷰 작성 페이지는 리뷰어가 리뷰를 남길 수 있는 페이지입니다. 리뷰어의 부담감을 줄이고 한 화면에 하나의 질문에 집중할 수 있도록 캐러셀을 활용한 카드 형식을 도입했습니다.</p>
<p>리뷰어가 남은 질문과 현재까지 작성한 질문 현황을 확인할 수 있는 프로그래스바도 같이 제공하고 있습니다. 리뷰어는 프로그래스바를 통해 작성한 질문지로 이동할 수 있습니다.</p>
<p>질문의 문답이 유효해 제출이 가능한 경우, 제출 전 확인과 제출 버튼이 활성화됩니다. 리뷰어는 제출 전 확인 버튼을 클릭해 본인이 작성한 내용을 확인할 수 있습니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="리뷰-목록-상세-페이지">리뷰 목록, 상세 페이지<a class="hash-link" aria-label="리뷰 목록, 상세 페이지에 대한 직접 링크" title="리뷰 목록, 상세 페이지에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/release-version-1.0.0#%EB%A6%AC%EB%B7%B0-%EB%AA%A9%EB%A1%9D-%EC%83%81%EC%84%B8-%ED%8E%98%EC%9D%B4%EC%A7%80">​</a></h3>
<img src="https://your-docusaurus-site.example.com/assets/images/review_view-b5a3549a1074bc1accb9ef3656e93a1c.jpg" style="max-width:600px;margin:0 auto;display:block" alt="리뷰미 목록, 상세페이지">
<br>
<p>리뷰 목록 페이지는 리뷰이가 받은 리뷰 목록을 제공합니다. 리뷰 목록 중 자세하게 보고 싶은 리뷰를 선택하면 해당 리뷰에 대한 상세 페이지로 이동합니다.</p>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="용어-정리">용어 정리<a class="hash-link" aria-label="용어 정리에 대한 직접 링크" title="용어 정리에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/release-version-1.0.0#%EC%9A%A9%EC%96%B4-%EC%A0%95%EB%A6%AC">​</a></h4>
<ul>
<li>리뷰어 : 리뷰를 작성하는 사람</li>
<li>리뷰이 : 리뷰를 받는 사람</li>
<li>리뷰 url : 리뷰 연결 페이지 url로, 해당 url로 들어오면 리뷰 작성과 확인이 가능.</li>
<li>리뷰 url 생성폼: 리뷰 url을 생성하는 폼</li>
</ul>]]></content:encoded>
            <category>blog</category>
        </item>
        <item>
            <title><![CDATA[무엇이 좋은 도메인 설계인가?]]></title>
            <link>https://your-docusaurus-site.example.com/blog/domain-design</link>
            <guid>https://your-docusaurus-site.example.com/blog/domain-design</guid>
            <pubDate>Sun, 25 Aug 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[작성 배경]]></description>
            <content:encoded><![CDATA[<h3 class="anchor anchorWithStickyNavbar_LWe7" id="작성-배경">작성 배경<a class="hash-link" aria-label="작성 배경에 대한 직접 링크" title="작성 배경에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#%EC%9E%91%EC%84%B1-%EB%B0%B0%EA%B2%BD">​</a></h3>
<p>프로젝트를 시작하고 3주 동안, 리뷰미는 3번의 도메인 구조 변경을 겪었습니다. 모든 구조는 우리 팀이 치열하게 고민한 끝에 나온 것들이었습니다. 그래서 바꾸는 것이 아쉽기도 했습니다. (자식같은 내 코드..) 하지만 분명한 필요성을 느껴 구조 변경을 했고, 그 과정에서 ‘좋은 설계란 무엇인가’에 대해 고민하게 되었습니다. 이 글에서는 리뷰미 서비스의 도메인 변천사와, ‘좋은 설계란 무엇인가?’에 대한 개인적 견해를 적어보려 합니다.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="첫-번째-설계">첫 번째 설계<a class="hash-link" aria-label="첫 번째 설계에 대한 직접 링크" title="첫 번째 설계에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#%EC%B2%AB-%EB%B2%88%EC%A7%B8-%EC%84%A4%EA%B3%84">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="목표--핵심-기능을-빠르게-구현-">목표 : 핵심 기능을 빠르게 구현 ⏩<a class="hash-link" aria-label="목표 : 핵심 기능을 빠르게 구현 ⏩에 대한 직접 링크" title="목표 : 핵심 ��기능을 빠르게 구현 ⏩에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#%EB%AA%A9%ED%91%9C--%ED%95%B5%EC%8B%AC-%EA%B8%B0%EB%8A%A5%EC%9D%84-%EB%B9%A0%EB%A5%B4%EA%B2%8C-%EA%B5%AC%ED%98%84-">​</a></h3>
<p>우리 팀의 첫 목표는 핵심 기능을 빠르게 구현하는 것이었습니다.
따라서 ‘리뷰를 작성하는 기능’과 ‘리뷰를 보는 기능’을 빨리 구현하기 위한 설계를 했습니다.
기능을 빠르게 구현하기 위해 우리 팀은 아래 기준으로 설계를 했습니다.</p>
<ol>
<li>팀원들이 모두 사용해본 방법</li>
<li>인지 부담이 적은(생각할게 적은) 방법</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="구현-순서--erd-작성--도메인-설계">구현 순서 : ERD 작성 → 도메인 설계<a class="hash-link" aria-label="구현 순서 : ERD 작성 → 도메인 설계에 대한 직접 링크" title="구현 순서 : ERD 작성 → 도메인 설계에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#%EA%B5%AC%ED%98%84-%EC%88%9C%EC%84%9C--erd-%EC%9E%91%EC%84%B1--%EB%8F%84%EB%A9%94%EC%9D%B8-%EC%84%A4%EA%B3%84">​</a></h3>
<p>우리 팀은 ERD 작성 → 도메인 설계의 순서로 구현했습니다.
ERD를 먼저 설계하자는 의견은 저의 의견이었습니다.
우리 서비스에 어떤 데이터들이 저장될 것이며, 이들이 어떻게 연결되어있는지를 정해야 도메인 설계를 할 수 있을 것이라 생각했습니다.</p>
<p style="text-align:center"><img src="https://your-docusaurus-site.example.com/assets/images/first_erd-b4bc7a0feec4ac3b8fe2215727d92648.png"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="도메인-연관관계">도메인 연관관계<a class="hash-link" aria-label="도메인 연관관계에 대한 직접 링크" title="도메인 연관관계에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#%EB%8F%84%EB%A9%94%EC%9D%B8-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84">​</a></h3>
<p>빠른 구현을 위해, ERD를 보며 아래 규칙을 따라 구현했습니다.
앞서 언급한 것처럼 단순하고, 생각할 거리가 많지 않은 규칙입니다. 💁🏻‍♀️</p>
<ul>
<li>단방향 @ManyToOne 만 존재</li>
<li>list 형식을 저장해야 할 때면 별도의 테이블 생성</li>
<li>N<!-- -->:N<!-- --> 관계에 대해서는 중간 테이블 생성</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="로직-위치">로직 위치<a class="hash-link" aria-label="로직 위치에 대한 직접 링크" title="로직 위치에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#%EB%A1%9C%EC%A7%81-%EC%9C%84%EC%B9%98">​</a></h3>
<p>우리 팀은 각 도메인을 <strong>객체로서</strong> 활용하려 했습니다.
그래서 객체들이 협력할 수 있게, 도메인 관련 로직을 도메인 내부에 두었습니다.
그러다 도메인 내부에 너무 많은 로직이 있다면 포장객체로 분리해주었습니다.
예를 들어, <a href="https://github.com/woowacourse-teams/2024-review-me/blob/dad1912ebeacc6b54f25c78b23799e258a40c09c/backend/src/main/java/reviewme/keyword/Keyword.java" target="_blank" rel="noopener noreferrer">Keyword</a> 라는 도메인이 있고,
<code>List&lt;Keyword&gt;</code> 에 대해 갯수 검증과 중복 검증을 해줘야 한다면 그 역할을 하는 일급 컬렉션 <a href="https://github.com/woowacourse-teams/2024-review-me/blob/48e7b68d4dc67873a5f34d118ccdee118f2c0d00/backend/src/main/java/reviewme/keyword/domain/SelectedKeywords.java" target="_blank" rel="noopener noreferrer">SelectedKeywords</a> 를 만들어주었습니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="첫-번째-설계-후">첫 번째 설계 후..<a class="hash-link" aria-label="첫 번째 설계 후..에 대한 직접 링크" title="첫 번째 설계 후..에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#%EC%B2%AB-%EB%B2%88%EC%A7%B8-%EC%84%A4%EA%B3%84-%ED%9B%84">​</a></h3>
<p>첫 번째 설계 후 우리 팀원들은 모두 같은 생각을 하게 되었습니다.</p>
<p><em>‘이건 객체지향이 아니야!!’ 😣</em></p>
<p>라는 생각이었습니다. 데이터베이스를 먼저 생각하고, 그로부터 엔티티 객체를 도출했기 때문이었을까요?
분명히 ‘도메인 코드는 인프라에 의존적이지 않아야 한다’고 배웠었는데, 도메인이 JPA를 위해 존재하는 듯 했습니다.
그동안 배운 POJO를 사용하는 순수 어플리케이션과는 너무 다르기에 괴리감이 느껴졌습니다.
우리 팀원들은 모두 이 문제에 공감했고, ‘도메인으로부터 시작해보자’ 라는 생각으로 다시 설계를 하게 되었습니다.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="두-번째-설계">두 번째 설계<a class="hash-link" aria-label="두 번째 설계에 대한 직접 링크" title="두 번째 설계에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#%EB%91%90-%EB%B2%88%EC%A7%B8-%EC%84%A4%EA%B3%84">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="목표--가장-중요한-것은-도메인-간의-협력-">목표 : 가장 중요한 것은 도메인 간의 협력 🤝<a class="hash-link" aria-label="목표 : 가장 중요한 것은 도메인 간의 협력 🤝에 대한 직접 링크" title="목표 : 가장 중요한 것은 도메인 간의 협력 🤝에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#%EB%AA%A9%ED%91%9C--%EA%B0%80%EC%9E%A5-%EC%A4%91%EC%9A%94%ED%95%9C-%EA%B2%83%EC%9D%80-%EB%8F%84%EB%A9%94%EC%9D%B8-%EA%B0%84%EC%9D%98-%ED%98%91%EB%A0%A5-">​</a></h3>
<p>두 번째 설계에서는 ‘도메인 객체’ 그 자체에 집중하기로 했습니다.
‘어떤 성질’을 갖는 도메인이 ‘어떻게 협력’하는지 먼저 정하고, JPA는 나중에 붙이자 생각하며 구현했습니다.
사실 이 방법이 맞다는 확신은 없었습니다😅
영속 로직을 JPA를 사용하여 처리하고 있는데, JPA를 배제해도 되나? 하는 의문도 들었고요.
하지만 결과적으로 이 선택이 올바르지 않더라도, 왜 객체지향적으로만 생각하면 안 되는지를 경험해보고 싶었습니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="구현-순서--요구-사항-분석--협력-관계-파악--도메인-설계--jpa-적용">구현 순서 : 요구 사항 분석 → 협력 관계 파악 → 도메인 설계 → JPA 적용<a class="hash-link" aria-label="구현 순서 : 요구 사항 분석 → 협력 관계 파악 → 도메인 설계 → JPA 적용에 대한 직접 링크" title="구현 순서 : 요구 사항 분석 → 협력 관계 파악 → 도메인 설계 → JPA 적용에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#%EA%B5%AC%ED%98%84-%EC%88%9C%EC%84%9C--%EC%9A%94%EA%B5%AC-%EC%82%AC%ED%95%AD-%EB%B6%84%EC%84%9D--%ED%98%91%EB%A0%A5-%EA%B4%80%EA%B3%84-%ED%8C%8C%EC%95%85--%EB%8F%84%EB%A9%94%EC%9D%B8-%EC%84%A4%EA%B3%84--jpa-%EC%A0%81%EC%9A%A9">​</a></h3>
<p>두번째 설계에서는 가장 먼저 요구 사항에 대해 분석하고 도메인의 협력 관계를 파악했습니다.
그리고 각 도메인이 어떤 역할을 해야 하는지 적어보고, 협력해야 하는 방향을 화살표로 표현했습니다.
이를 바탕으로 도메인 객체를 도출하고 참조 관계를 설정했습니다.</p>
<p style="text-align:center"><img src="https://your-docusaurus-site.example.com/assets/images/oop-7e9945514543b9c3130ea4fb09ac6998.png"></p>
<p>팀원들은 “이게 자바지!” 하며 만족해했습니다.
브랜치 이름을 <code>pure-java-is-god</code> 라고 할 정도였습니다.
하지만 JPA를 붙이자 재앙이 시작되었습니다..</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pojo들의-협력--jpa---양방향-연관관계-뒤범벅">POJO들의 협력 + JPA  ⇒ 양방향 연관관계 뒤범벅<a class="hash-link" aria-label="POJO들의 협력 + JPA  ⇒ 양방향 연관관계 뒤범벅에 대한 직접 링크" title="POJO들의 협력 + JPA  ⇒ 양방향 연관관계 뒤범벅에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#pojo%EB%93%A4%EC%9D%98-%ED%98%91%EB%A0%A5--jpa---%EC%96%91%EB%B0%A9%ED%96%A5-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%92%A4%EB%B2%94%EB%B2%85">​</a></h3>
<p>객체에서 시작한 설계에 JPA를 붙이려 하니 부자연스러운 부분들이 생겼습니다.
가장 어려움을 겪었던 것은 ‘연관관계’에 대한 부분이었습니다.
도메인의 협력을 생각하면 A → B 의존인데, JPA의 연관관계를 생각하면 B → A 의존이 필요했습니다.
하지만 우리 팀은 순수 자바를 놓치지 말자는 목표가 있었기 때문에, 두 의존 방향 모두 가져가기로 했습니다.
그리고 그 결과, 무수한 양방향 연관관계들이 생겨났습니다😵‍💫</p>
<p>양방향 연관관계로 이어진 객체들은 그 경계가 모호했기 때문에 여러 가지 이슈로 이어졌습니다.
조회를 할 때는 Lazy Initialization 문제가 발생했습니다.
이를 해결하기 위해 fetchType을 설정했어야 했는데, 어디까지를 EAGER, 어디까지를 LAZY로 둘지 애매했습니다.
저장을 할 때는 DB와 메모리의 동기화를 위해 연관관계 편의 메세드를 작성해야 했습니다.
또한 테스트를 할 때는 연관된 모든 데이터를 세팅하기 위해 given 구문 길게 작성해서,
정작 무엇을 테스트하는 것인지 알아보기 힘들어졌습니다.
이렇듯 복잡한 부분들이 많았지만, 이런 문제들은 ‘좋은 설계를 위해 개발자가 수고해야 하는 부분’이라 생각했습니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="길을-잃은-우리-">길을 잃은 우리 🍂<a class="hash-link" aria-label="길을 잃은 우리 🍂에 대한 직접 링크" title="길을 잃은 우리 🍂에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#%EA%B8%B8%EC%9D%84-%EC%9E%83%EC%9D%80-%EC%9A%B0%EB%A6%AC-">​</a></h3>
<p>두번째 설계를 바꾸게 된 결정적 계기가 된 것은 바로 기획의 변경이었습니다.
바뀐 기획에 따라 특정 도메인을 삭제할 필요가 있었는데, 그 도메인은 여러 도메인에서 의존하는 것이라 변경이 매우 어려웠습니다.
<strong>하나의 도메인 객체를 변경하니 여러 곳에서 컴파일 에러</strong>가 발생했습니다.</p>
<p>또한 기획이 달라짐에 따라 도메인과 관련된 정책들도 변경이 되었는데요.
로직을 도메인에서 처리하게 했기 때문에 정책이 변경될 때마다 도메인 내부를 바꿔야 했습니다.
설상가상으로 도메인들이 촘촘한 연관관계로 엮여있었기 때문에, <strong>한 도메인의 변경이 다른 도메인에게 전파</strong>되었습니다.
조금의 변경에도 와장창 무너지는 코드를 보며, 설계가 잘못되었다는 것을 깨달을 수 있었습니다.
이 설계도 아니라니!
<code>java-is-god</code>이었던 브랜치는 어느새 <code>we-are-lost</code>으로 변경되었습니다😔</p>
<p style="text-align:center"><img src="https://your-docusaurus-site.example.com/assets/images/we_are_lost-1ff1ed03bc528ffd61f32f005fdb65ee.png"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="객체지향-jpa">객체지향? JPA?<a class="hash-link" aria-label="객체지향? JPA?에 대한 직접 링크" title="객체지향? JPA?에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#%EA%B0%9D%EC%B2%B4%EC%A7%80%ED%96%A5-jpa">​</a></h3>
<p>잘 협력한다고 생각했던 설계가 오히려 변경에 취약한 설계였다니..
되게 많은 생각이 들었습니다.
이때 ‘어떤 것을 중요하게 생각해야 할까?’에 대해 많은 생각을 했습니다.
객체지향을 배운 사람으로서, 객체지향의 가치들이 좋은 것이라 여겼으나, 이를 어떻게 DB 에 적용을 할 수 있는 것인지 갈피를 잡기 힘들었습니다.
아니, 사실은 정말로 객체지향이 좋은 가치였을까? 라는 생각도 들었습니다.</p>
<p>예를 들어, SOLID 중 S에 해당하는 단일 책임 원칙을 지키기 위해 도메인과 관련된 로직을 도메인 안에 넣었습니다.
그랬더니 비지니스 정책이 바뀔 때마다 도메인이 달라져야 했습니다.
그뿐 아니라, JPA 에서는 FK 를 저장해야 한다는 이유로 객체를 직접 참조합니다.
이런 참조는 강한 결합을 하게 만들어 객체지향에서는 피해야 하는 것입니다.
그렇다면 어떤 것을 우선시 해야 좋은 설계라고 할 수 있을까? 고민이 되었습니다. 이때 코치님께 들었던 조언이 방향이 되어주었습니다.</p>
<blockquote>
<p>많은 개발자들이 ‘공들여 설계를 해야 변화가 없을’ 것이라고 생각한다.
하지만 사실은 그렇지 않다. 절대 변하지 않은 것이라 생각했던 것도 나중에 변경이 될 수 있다.
중요한 것은, <strong>요구사항이 변경되었을 때 어떻게 유연하게 대처할 수 있는가?</strong> 이다.</p>
</blockquote>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="무엇이-좋은-설계인가">무엇이 좋은 설계인가?<a class="hash-link" aria-label="무엇이 좋은 설계인가?에 대한 직접 링크" title="무엇이 좋은 설계인가?에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#%EB%AC%B4%EC%97%87%EC%9D%B4-%EC%A2%8B%EC%9D%80-%EC%84%A4%EA%B3%84%EC%9D%B8%EA%B0%80">​</a></h2>
<p>앞선 경험들과 코치님의 조언을 토대로, 좋은 설계에 대한 기준을 세울 수 있었습니다.
좋은 설계에 앞서, 좋은 어플리케이션에 대해 생각해봅시다.
어떤 어플리케이션이 좋은 어플리케이션일까요?
요구사항을 잘 지키는 어플리케이션입니다.
그런데 요구사항이 변하는 것은 막을 수도, 예측할 수도 없습니다.
그러니 <strong>변경되는 요구사항을 빨리 반영하고, 잘 지키는 어플리케이션</strong>이 좋은 어플리케이션일 것입니다.</p>
<p>그렇다면 좋은 도메인 설계는 무엇일까요?
<strong>변경에 유연한 설계</strong>가 좋은 설계라고 생각합니다.
애초에 우리가 객체지향 프로래밍을 하는 이유를 생각해봅시다.
그것은 '아름다운 코드'를 위해서가 아닌 '유지보수'를 위해서입니다.
즉, 우리 코드가 객체지향적인지, 절차지향적인지, JPA 중심 설계인지보다
<strong>'변경에 유연한지'가 더 중요한 기준</strong>이라는 결론을 내리게 되었습니다.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="세번째-설계">세번째 설계<a class="hash-link" aria-label="세번째 설계에 대한 직접 링크" title="세번째 설계에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#%EC%84%B8%EB%B2%88%EC%A7%B8-%EC%84%A4%EA%B3%84">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="목표--변경에-유연한-구조-">목표 : 변경에 유연한 구조 🌊<a class="hash-link" aria-label="목표 : 변경에 유연한 구조 🌊에 대한 직접 링크" title="목표 : 변경에 유연한 구조 🌊에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#%EB%AA%A9%ED%91%9C--%EB%B3%80%EA%B2%BD%EC%97%90-%EC%9C%A0%EC%97%B0%ED%95%9C-%EA%B5%AC%EC%A1%B0-">​</a></h3>
<p>우리 팀은 ‘변경에 유연한 구조’를 최상위 기준으로 두며 세번째 설계를 했습니다.
그리고 이를 위해 세가지 큰 변화를 주었습니다.
(이 과정에서 <a href="https://www.youtube.com/watch?v=dJ5C4qRqAgA" target="_blank" rel="noopener noreferrer">우아한 객체지향</a>이라는 동영상을 많이 참고했습니다🙇🏻‍♀️)</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-불필요한-객체-참조-끊기-️">1. 불필요한 객체 참조 끊기 ✂️<a class="hash-link" aria-label="1. 불필요한 객체 참조 끊기 ✂️에 대한 직접 링크" title="1. 불필요한 객체 참조 끊기 ✂️에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#1-%EB%B6%88%ED%95%84%EC%9A%94%ED%95%9C-%EA%B0%9D%EC%B2%B4-%EC%B0%B8%EC%A1%B0-%EB%81%8A%EA%B8%B0-%EF%B8%8F">​</a></h3>
<p>두번째 설계에서 우리 팀이 경험한 객체 참조의 불편함을 정리하자면, 아래와 같습니다.</p>
<ol>
<li>객체 변경이 전파된다.</li>
<li>조회 시, Lazy initialization 를 야기할 수 있다. 이를 방지하기 위해 fetch 를 eager 로 설정해야 하는데, 이렇게 되면 lazy loading 의 장점을 활용하지 못한다. 또한 어떤것까지 eager 로 할지, lazy 로 할지에 대한 경계가 모호하다.</li>
<li>간단한 조회에도 복잡한 join 문으로 성능이 저하된다.</li>
<li>객체 그래프가 깊다면, 트랜잭션도 길어진다. 트랜잭션이 길어지면 하나의 커넥션을 오래 사용하게 된다.</li>
<li>연관된 객체의 생명주기가 다르다면, lock 을 걸어줘야 한다. 예를들어 A가 B에 의존하는데, B는 A와 생명주기가 달라서 A와 관계없이 수정, 삭제될 수 있다고 하자. 그렇다면 A 에 대한 연산을 할 때 B 가 수정, 삭제되지 않도록 B 에 대해 lock 을 걸어줘야 한다. 이는 성능 저하로 이어질 수 있다.</li>
</ol>
<p>따라서 <strong>JPA 연관관계를 끊어주고, 다른 엔티티의 id 를 long 타입으로 참조</strong>하게 했습니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-생명주기가-같은-것끼리-묶어주기-">2. 생명주기가 같은 것끼리 묶어주기 🪢<a class="hash-link" aria-label="2. 생명주기가 같은 것끼리 묶어주기 🪢에 대한 직접 링크" title="2. 생명주기가 같은 것끼리 묶어주기 🪢에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#2-%EC%83%9D%EB%AA%85%EC%A3%BC%EA%B8%B0%EA%B0%80-%EA%B0%99%EC%9D%80-%EA%B2%83%EB%81%BC%EB%A6%AC-%EB%AC%B6%EC%96%B4%EC%A3%BC%EA%B8%B0-">​</a></h3>
<p>하지만 모든 객체 참조를 없애진 않았고, 생명 주기를 같이 하는 객체는 참조하게 했습니다.
예를 들어, 리뷰를 작성할 때 Review 객체 뿐 아니라 TextAnswer 이라는 객체도 같이 생성됩니다.
조회를 할 때도 이들은 하나로 묶여 조회되며, 수정이나 삭제를 할 때도 함께합니다.
이러한 객체들은 <code>FetchType.EAGER</code>, <code>CascadeType.PERSIST</code> 와 같은 속성을 통해 <strong>하나의 단위처럼 관리되게</strong> 해주었습니다.
이렇듯 반드시 필요한 연관관계는 하나처럼 만들어주고, 불필요한 관계를 끊으며 객체 사이에 명확한 경계를 만들어주었습니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-하나의-기능을-하나의-객체로-모으기-">3. 하나의 기능을 하나의 객체로 모으기 🪣<a class="hash-link" aria-label="3. 하나의 기능을 하나의 객체로 모으기 🪣에 대한 직접 링크" title="3. 하나의 기능을 하나의 객체로 모으기 🪣에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#3-%ED%95%98%EB%82%98%EC%9D%98-%EA%B8%B0%EB%8A%A5%EC%9D%84-%ED%95%98%EB%82%98%EC%9D%98-%EA%B0%9D%EC%B2%B4%EB%A1%9C-%EB%AA%A8%EC%9C%BC%EA%B8%B0-">​</a></h3>
<p>두번째 설계에서는 로직을 모두 도메인에 넣고 이를 외부에서 호출해주었습니다.
이는 객체지향의 관점에서 보면 아름다운 협력처럼 보입니다.
하지만 변경이 생길 때 어느 부분을 수정해야 하는지 잘 보이지 않았습니다.
즉, 변경을 같이 해야 할 것이 여러 곳에 분산이 되는 문제가 있었습니다.
이를 해결하기 위해 세번째 설계에서는 하나의 기능에 연관된 것들을 하나의 객체로 모아주었습니다.</p>
<p>이는 다소 절차지향적인 설계라고도 할 수 있습니다.
하지만, 우리의 코드가 객체지향인지 절차지향인지보다 더 중요한 것은 변경에 유연히 대응하는 것입니다.
따라서 <strong>변경 시 확인할 곳을 명확하게</strong> 해주는 코드를 작성해주었습니다.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="이-과정을-통해-배운-것">이 과정을 통해 배운 것<a class="hash-link" aria-label="이 과정을 통해 배운 것에 대한 직접 링크" title="이 과정을 통해 배운 것에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/domain-design#%EC%9D%B4-%EA%B3%BC%EC%A0%95%EC%9D%84-%ED%86%B5%ED%95%B4-%EB%B0%B0%EC%9A%B4-%EA%B2%83">​</a></h3>
<ol>
<li>
<p><strong>객체지향이 반드시 옳지 않을 수 있다</strong>는 것을 배웠습니다.
모든 곳에 객체지향을 엄격히 적용하기에는 괴리가 있는 부분들이 있습니다.
어플리케이션에는 여러가지 개념적인 것들이 사용됩니다.
Layered architeture, URI resource, ORM, DB 등..
객체지향 또한 개념적인 것이기 때문에 이들과 어울리지 않을 수 있습니다.
그럼에도 객체지향을 고수하려 하다가는 오히려 혼란스러울 것입니다. (우리의 두번째 설계처럼 말이죠)</p>
</li>
<li>
<p>달라지는 요구사항에 따라서 <strong>우리 코드 또한 언제든 달라질 수 있다</strong>는 것을 배웠습니다.
우리 팀은 초반에 꼼꼼히 코드리뷰 하고, 열심히 토론했었습니다.
저 역시 저를 소개하는 문구가 ‘한 줄의 코드를 작성하더라도 의미를 담자’라고 할 정도로, 정성을 들여 코드를 짰었습니다.
하지만 요구사항의 변경으로 그 코드 전체가 날라가는 경험을 하니.. 사소한 것에 집착하지 않게 되었습니다.
물론 코드를 대충 작성하겠다는 것은 절대 아닙니다.
다만 너무 세부적인 것에 집중하느라 시간을 쓰지 말아야겠다는 생각입니다.</p>
</li>
<li>
<p><strong>서비스는 동적으로 변화한다</strong>는 것을 배웠습니다.
기존 기능에 살이 붙기도 하고, 있던 기능이 사라지기도 합니다.
앞으로 붙을 살, 없어질 기능에 대해서는 미리 알 수 없는 노릇입니다.
따라서 우리가 할 수 있는 최선은 핵심 기능에 집중하며, 변경에 유연하게 설계하는 것입니다.</p>
</li>
<li>
<p>앞으로의 <strong>확장에 대해 예측하는 것은 좋지 않을 수 있습니다.</strong>
저도 알고싶지는 않았는데요😅, 첫번째 설계에서 ‘이건 나중에 무조건 생긴다’고 생각했던 기능을 갈아엎으며 깨닫게 되었습니다.</p>
</li>
</ol>
<p>우리 팀은 왜 계속 기획이 바뀌는지, 왜 설계가 바뀌는지 원망스러웠던 적도 있었습니다.
하지만 변경이 많았기 때문에 좋은 설계에 대한 기준을 세울 수 있었던 것 같아 지금은 감사한 마음이 듭니다.
앞으로 또 어떤 변경이 있을지는 모르겠지만, 그 변화에 유연히 대처할 수 있는 코드를 작성해보겠습니다🤗</p>]]></content:encoded>
            <category>blog</category>
        </item>
        <item>
            <title><![CDATA[리뷰미에서 랜덤을 활용하는 방법]]></title>
            <link>https://your-docusaurus-site.example.com/blog/random</link>
            <guid>https://your-docusaurus-site.example.com/blog/random</guid>
            <pubDate>Mon, 19 Aug 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[리뷰미 서비스에서는 리뷰 URL을 생성할 때 랜덤하게 생성합니다. 이때 Random 라이브러리를 활용했어요.]]></description>
            <content:encoded><![CDATA[<p>리뷰미 서비스에서는 리뷰 URL을 생성할 때 랜덤하게 생성합니다. 이때 <code>Random</code> 라이브러리를 활용했어요.
찾아보니 <code>ThreadLocalRandom</code>, <code>SecureRandom</code>과 같은 다양한 랜덤 구현체가 존재했습니다.
오늘은 이들의 특징을 알아보고, 팀에서는 어떤 방식의 랜덤 라이브러리를 활용했는지 소개해보고자 합니다.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-어떻게-랜덤을-구현했을까">🎲 어떻게 랜덤을 구현했을까?<a class="hash-link" aria-label="🎲 어떻게 랜덤을 구현했을까?에 대한 직접 링크" title="🎲 어떻게 랜덤을 구현했을까?에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/random#-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%9E%9C%EB%8D%A4%EC%9D%84-%EA%B5%AC%ED%98%84%ED%96%88%EC%9D%84%EA%B9%8C">​</a></h2>
<p>컴퓨터는 어떻게 랜덤하게 값을 만들 수 있을까요?
우리가 원하는 대로만 움직이는 컴퓨터에게 무슨 수로 <strong>무작위</strong>한 값을 달라고 할까요?
정말 컴퓨터가 만들어내는 값은 무작위한 난수일까요?</p>
<p>사실 난수를 달라고 하더라도, 내부의 알고리즘을 따라 정해진 값을 건네게 되어 있습니다.
이러한 방법으로 생성된 난수를 유사난수, <code>Random</code>와 같은 라이브러리를 유사난수 생성기(Pseudo-random number generator: PRNG)라고 해요.
우리가 보기에는 앞뒤 상관없이 무작위의 수를 건네는 것처럼 보이지만, 한날 한시에 난수를 꺼내오는 경우, <strong>완전히 같은 값</strong>을 가져올 수 있습니다.</p>
<p>Java에서 난수를 생성하는 방법은 간단합니다. <code>Random.next()</code>라는 메서드에서 이를 엿볼 수 있어요.</p>
<div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187 codeBlockLinesWithNumbering_OFgW"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> bits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> oldseed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nextseed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token class-name">AtomicLong</span><span class="token plain"> seed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        oldseed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> seed</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        nextseed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">oldseed </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> multiplier </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> addend</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> mask</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">seed</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">compareAndSet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">oldseed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nextseed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nextseed </span><span class="token operator" style="color:#393A34">&gt;&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">48</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> bits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-암호학적으로-안전하게-난수-생성하기">🔐 암호학적으로 안전하게 난수 생성하기<a class="hash-link" aria-label="🔐 암호학적으로 안전하게 난수 생성하기에 대한 직접 링크" title="🔐 암호학적으로 안전하게 난수 생성하기에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/random#-%EC%95%94%ED%98%B8%ED%95%99%EC%A0%81%EC%9C%BC%EB%A1%9C-%EC%95%88%EC%A0%84%ED%95%98%EA%B2%8C-%EB%82%9C%EC%88%98-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0">​</a></h2>
<p>Java를 제외하고도 대부분의 난수 생성기는 <code>seed</code>라고 하는 값을 가집니다.
<code>seed</code>로부터 난수를 생성하기 때문에, <code>seed</code>가 같은 경우에는 항상 같은 난수를 생성해요. 그리고 이 <code>seed</code>는 <code>Random</code> 객체가 만들어질 때 결정됩니다.
Java에서는 시각에 따라 <code>seed</code>가 결정돼요. 서로 다른 하드웨어에서 정말 같은 시각에 객체가 생성된다면 항상 같은 난수를 생성하겠죠?</p>
<div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187 codeBlockLinesWithNumbering_OFgW"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">seedUniquifier</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">^</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">nanoTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>이를 해결하기 위해서는 <code>SecureRandom</code>을 활용할 수 있습니다.
앞서 난수 생성기를 <strong>PRNG</strong>라고 불렀다면, 암호학적으로 안전한(Cryptographically safe) 난수 생성기는 <strong>CSPRNG</strong>라고 부릅니다.
<a href="https://datatracker.ietf.org/doc/html/rfc4086" target="_blank" rel="noopener noreferrer">RFC 4086</a>을 만족하도록 기계를 설계해야 하며, 다양한 방법으로 <code>seed</code>를 초기화하는 방법을 소개하기도 합니다.</p>
<p style="text-align:center"><img src="https://your-docusaurus-site.example.com/assets/images/rfc-21ff9a2322d49e8401e966da3ae851e3.webp"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-동시성-문제를-해결하며-난수-생성하기">🫂 동시성 문제를 해결하며 난수 생성하기<a class="hash-link" aria-label="🫂 동시성 문제를 해결하며 난수 생성하기에 대한 직접 링크" title="🫂 동시성 문제를 해결하며 난수 생성하기에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/random#-%EB%8F%99%EC%8B%9C%EC%84%B1-%EB%AC%B8%EC%A0%9C%EB%A5%BC-%ED%95%B4%EA%B2%B0%ED%95%98%EB%A9%B0-%EB%82%9C%EC%88%98-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0">​</a></h2>
<p>대부분의 경우 <code>Random</code> 객체를 한 번 만들어서 여러 곳에서 사용합니다. 동시에 여러 스레드에서 난수를 생성하려고 한다면 어떻게 될까요?
<code>nextInt()</code>는 <code>next(32)</code>를 부르고, 위의 메서드에서 보았듯이 <code>AtomicLong</code>을 사용해 <code>seed</code>를 변형해가며 난수를 생성합니다.
동시에 여러 곳에서 요청하더라도 각각 다른 난수를 생성하기 위해서죠. <code>seed</code>가 올바르게 업데이트되지 않는다면, <code>while</code>을 계속해서 반복하게 됩니다.
요청이 많아질 때 성능이 얼마나 저하되는지 직접 확인해볼까요?</p>
<div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187 codeBlockLinesWithNumbering_OFgW"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">Random</span><span class="token plain"> random </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token annotation punctuation" style="color:#393A34">@Test</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">testRandom</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NUM_OPERATIONS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100_000_000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> threadCounts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> threadCount </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> threadCounts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token class-name">ExecutorService</span><span class="token plain"> executor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Executors</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">newFixedThreadPool</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">threadCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> startTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">currentTimeMillis</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> threadCount</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">            executor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">submit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NUM_OPERATIONS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> threadCount</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> j</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">                    random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">nextInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        executor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">shutdown</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        executor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">awaitTermination</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">TimeUnit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">MINUTES</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> endTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">currentTimeMillis</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Threads: "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> threadCount </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">", Time: "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">endTime </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> startTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">" ms"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>1억 번의 랜덤 연산을 여러 스레드에서 진행하게끔 했을 때의 결과입니다.
예상했듯이 스레드가 많아질수록 <code>AtomicLong</code>을 연산하는 과정에서 많은 CPU 사이클 낭비가 발생합니다.</p>
<p style="text-align:center"><img src="data:image/webp;base64,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"></p>
<p><code>Random</code> 문서에서도 동시성과 관련된 상황에서는 <code>ThreadLocal</code>을 사용하라고 권고하고 있어요. <code>random.nextInt()</code>를 <code>ThreadLocalRandom.current().nextInt()</code>로 수정하면 아래와 같은 성능 향상을 확인할 수 있습니다.</p>
<p style="text-align:center"><img src="data:image/webp;base64,UklGRhoTAABXRUJQVlA4WAoAAAAgAAAA+QAAkgAASUNDUMgBAAAAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADZWUDggLBEAANBPAJ0BKvoAkwA+kT6bSSWjIqEnMVzwsBIJaW7hcTD/c7Hxv/jP5X2+f2P+vfsT5p+E/y97QerJ+m+J7y39f/2PoJ/Ffsr+X/tf959NO9335f1X81/DD5Avyn+Yf5/+l+Mb/AfaJ4hWY/3b/B+oF6rfGv87/Zf3d/x/tZ+of4v8svcP8i/pP+C9wD+Sfyj/cemX9m8Rf6X/qvYB/kf9h/2396/IX6Uv4z/p/43/M/tV7RPzP/C/83/Mf5/5Bf5d/U/+T/ef8L76/sD/az//+5r+yX//ARHGa2biERtAxwsuU3UpZrU1Tjimt/tYK5F6fUpZCKPH96gVspL4lO6JdTrLnET6NyNH0MiNUPaqMBckzeGGnUw/lbELeQAmdPr0Q0S0M90g/DQz3BHvK/dlv71LjifWX+dysCvdMrdrz5N1Yqvp30u0pKRffwyQ6mBeEV4W/wKf8LuFK+SDVyyJjePl4MV5JefG8+50gPuh/ELaWxmlQzYagHmfYI6iGo8w9Dz9hp0JnCSiMM7fBd+Va0EoK/kokm7X3YBzGf7rXRasZOkTwdu+anUZb9moATpfJO9ccLR3YLtAY9KDpz6Y6Gp5tzkOcQGho8IsBaI1XOWufvZm3nF/fihXupd3f0IhHnq01YEQ8cpHCPbOAA64myapjsUHOG5eOzd+Y3a+4op30z+HOBp35ArAMkfrjJ7iFLIfKcOXPJdQ9f+Pg2vcC0Vh/6oo2Tf2Ujwf9qtBwSRsy5kJed6ufLgtLbKe+LeK0rFzDE5yHOIDQ1e4GnfWMVsV80C5HPRzqxffUyAbOgHvd7yos7N0Cd/tjvAY7RK21j92x9NjXnmvt5jKz0spcZ+pn6JrNVNgAP7bod1Qv6Vk/q7AnJuA1TSWNvWULcmCXLCU2oRgqAVdft2XuRRg0SPVFds8PpfEhqY3CaK1K3rR5Caww7vEM2/8CmABT8EOrrGRAB6NQGvw7AVxTj7ligAonQOF3dDZm3bwCg+M4WMXVF0RM7LJ5EThuxDWAIGfLOnYC3CFxi0BG4MR+6DhVEWw5EtrXNA8H+a95owmzfkL3Jeoqc7ovqqjPr2K/GWGtEzvH5JXidHfI7du+OGxkCa4mIPmFgSrlTrxornl0qQKUBbaeaNTzPnZXMVED45cbk53PVf8uLhwmHrzk7BfA02MnpXZcNPFiR8cJIzngR2OjKj4+hKTemlwvQQ31wq9SHsybK6F2RwBsBOAEwhlrD95Z71vw6LHug9KZlBbvGBl5ucJDywhDiEvHqGTp+BxREf0PbY1tRkZhmqKoqfkscmU3m0Wf/FhqpeOtJWi83iXdIxnbb1FK9kBBaejaUHDzjG2QtkEAb+L/YeJgPmIe1IbIXVIiLYRP2HDaYXQPTxjv+Pw6Su4qFAFlzgEPu0oQFIvAdy/nE87lTZ5cCIqt6La3KLxLRNQefPQJsxI7V7fkJVgzj0EYBoCW6TEdIbauQKryUkV/vwIWTW9FfU6SRcvIuGO6OOLr6OKFBeqPfk4RoUIOImg3Z4OOlp/WhRt9fRQUKgErvUyBCoHk96QhqX+d8t62/SvqUZDhiOaLSJsqadQFun5gRTwpSb1p2Y1vEOWQ7WQusqOlDFI0nC3n0mLpcDKiERJ6jKk3Te3LMFFMBeKbSlymDKFc1mIIcpaZPIiFu+zJ7Vqr944PaG0anzjHZSdxIvIJl6zxlxWdEiVtPD8kNmwHf0j1eA1L1HB6IJH/qRzZ6ZojdHMAT9P9ygOiPPfZPc5eY5+DpY3WpgmeuZYeGrp7N4+CgOY/6dBG9BDqLku53dQYJ7maQTiP2Y/qJk9m7UgmSgzHCbOnjtVc7yIPU7pbrj2xIKaxF1hMtO4BksWBDZhjiCEn4ghhqXv6ZetjZyIk8/5nPLry7TjYjvh0qR1BQUr0n9vNCFajsbagZa2tI9ML9kJ888yDlt9YgGet4BFVidgCsOYBvyYPk5aOXtivh0uvJsVS4OeBFXaxoMHYmh1MYWjRXf5rtvoh0HgbsDOdSUzzV+K0Zv0t13DMOrDZPOL/SKhsl0MVE1bGrn7/K8QZHWCvdW+0vYlnGkWlmt8dW4PNgTU9ryJhgTA4SxUtw3Bb3W8gPJVHMG1nSLsr0zgY3p36iMwugDzx03z2hChTvR9ml/UyVUYxpcQXz7xfI/R34sK0jzy4azQp9C8ZLEqb2SlMBRoG/MLtqmEnyiKlKmCGGWddJqgzs85qN07WoBrZXp0G63NQqLX4cwMHLLBIy1bS+CGqtSuVLImRMCGYAnetck8mcQ+DMXvL7OXZt8vOCRD2s9XLtU3yI7k110koA6oeSmf8BLIIbBTPukzMCVseSVawD4N2e2BqzmB9b0fePGTnRMKIGavIogh0NZHrCtSuTlK9CaEQPZRYOPyadHtyiBEtQAQhqMMjmXFnIhHttMjALR0o+ZlnZeo4JtfSFofDu8yP3TwdhJs8lq+Pxu6T1//eNx1kxNDKP1OLjP3ZTu13xeyFJDkV2iKBt7CqAL+lthm2el0AnRYPMRfDVuPn15SeV6vj07IPNwJGysvu8iU8likoEGBWjAjCeGQpNUSMsjC9zZp1g6HU8I+XOYYCqvh7u2qz8cC10VVnjRvClcFObbe4kDeu4mScje5xifs/SVIZeZ9ndU1rEeFCr6TY1eDUdxYvOWyNfkjakK5NDytuNFK7R/ECjy43Lw5QvAWTy8bckYIFINXx3iD2Dp6TFMiqFI5eCHVI3m3talIKu23vZ+sW9vXOBX1LYmuTUKIqiH+d1MQdPw46mKEiQM9P6sBnW3MazbqC9TtwtAMP/+F+R7I+wd4x9qBkugCuMBKDnEW5D504rYr6CbFsz/2UQIIi6glyu7LfUyLDc6Zdr1jSW20/y4V7rsukEFSYxOqI3w0r20w80eTbstjCvWNUFCWQUKuKDsnBnOO6KxmymTGlMdacTgPcR6CFYUT5mpBLxTurvKo6X16q6cCppVHOzaMc+Ci/spm2kATDyRQhwdc3rVYbSSLcvdEeethnTKuDH3C0Z/kBGUBgIyVqt4wAcG7/pI+ASNz4mUof0o4hpYClpXHaj3jJrA8f84ZHlM3atma6+kJo5I5AzOLCAmweRngEX0Jhi9zne+c4dctN3phfmxr7e8kgGyh7qn71FqOmJz9Vnn5YOJkHzHM5eA942jfTJ0B2iFjckdTSqOdm0ZitRmeSKEODrm88lzbfAYnRx7fkkbEeBjfYTKtwX90hzLGp3+qhEs9Vn0Ig/EvoUt1YkStU9KAMrcAXDBtdhp6W/ykMC8ML8itlF5fkluuWmRZ6kX+HaV1s5zblraKA9zjBlSmwY4AIwtEZRaROYshAbe/E3xfofO3B6ZV1VIx6Fbc5n8R/rbafkNHMaCL7VolramFdEXqdFld0t20XGnrltXhOd4VcFH0lezTOCBYivvl1DalYNF582UC2595vyM733ER2myscmio0PxSYDnF52KjaYH5hdw1uldk7qnKHPQJtDSDiQyW7Velpw8qFHshAjua7ten57hZ2Z/2IEUvYo1JzmHR1YbajsW9vXOBX0757ltcJywX1TfqbSn2l6t2RvA1H4eGdCVvodg3fQAyYzQQtfvVvtLzTcbHMhLodNp2FRzpDQAmLc/yf/jza3yitidR16ZIw1YktA7atiUV+5KrpwzOOGgvAHT+Ir3J8TvWJHz4OYOB93jXEslCdK1a/4sK0jzy4aovtp7P2F6oWO417XBiyUh88dzG0w80eTbstieXoP9C9BPoI6EO1kdYk81O4HauU72SqXBFgR3/8CZunItVnFcnd80fZ5i6idnPq4ZOhrEa9iW6fpFr3jIqnZ42qqLM11u1ZeGWxpWLO4ZSEQ9k3pz5yYTVtxLg5bjAZ69YKrap216S8Mq1TOVzCv6LEySM8fTxBwMwT2QZL2+hLgCphZegRGpbDW5Z/Jp0e3KIES1ABCGowyOZcWciEe20yMAtHSj5mWdl6jgm19IWh8O7zI/dPB2EmzyWr4/HRFTunZY7U7bh5eG/aGVgx15bZBrCpJPrNrIJ79B0ERwE5jMay+pcaB/mdIwSlfJ2BeuOscSieAtuynZ6iWlhCuZyS2U69R6Mzfb6ORzNbZJhI3HLd11WWqaEdXmxYr6iS7Egxnq4qVl/ViETd/NrLGWpKqGORscTPL2+VSjkJn8lT3BaTENh6+bU1mxq2m9H3wkgNYY5VPXM5vHEzgh1+yRkxoSDsPKbiA78iLnWp1jYVPDvSxT5erZoxgc+b2O2/ayOI3vg45OQvmjexf3mIS9heKrCrcfVmuwcCdlPDYoSJAz0/qwGdbcxrNuoQ3erQ1ku8Y2NmQeqeGDZdqBkuf6pItWL8KeWlKlgH01Pb/qMeB0iKim88rH6AjMPTnjZ+lxnRDUY9nxSnj62Q7InQHAimYAVlEQe3Wu0w80eTbstjCvWNUFCWQVg2QFgwTyBr2BqP01r7RHL39RFPwT5y8Kd81jlHuoevTiQ2qqLM11s+KCXZ2tNmu1dDRLcu7uDgTLAq2RCgBcArptl8u4sQTDx1zOyuIREpYcMWHorrNztj2VtQe41i1YGrNdXuod85hMjWN4dqO9ead1t1M0+yTH0N5AoBgFcdXv0PX0C6Nfu++J62qdzJOKp8gi17p3pX1I5uQpOnTBKPkeGgV4k0Wo3iSZAqvx1gZGr1KegOaBI/pxl61cj4IXSjqKptUIMTGAUOb6dMPXOW7hnTfuSQw/OYc8d7FRN2HDVxjEnftOAfyoJW+Q08RyXDSNcCpyLmqiJhU1IHy+NQIB/gwm6DKE1DPoH5SGBeGF+RXX1hsqGt3Psqze69p6O1Oj87cmv+ZedAwZ7rLy1SiMJeGYErPfOAve98XXu2qUl54ToVyPX1vuQjzipo/D+xf6sfhdwC0YnPgxzGxagSCKLF9GDdNFlR1uODd07Hq69jUthrcarthgpfjAPOa1IvTZ0NIvK76HGOA0+fNjF9LAdKCsgRJzM7T5KgyUNOzJi1wlI9rl/V5kfGBZz2ebLIh0HgkleXtjbL8gBT6KK7rD688S0gjER/wpwaozGT0cBW9c4FfVsCHjVivoMFNY1zIhNFcQoPG8Ef3MlhnQlb6HYN30AMmM0ELX71b7S+T0OIPIvEELyXHWhj41Z2dN/At7F2d2Wg70tATKnZ7QQFVCrwzDYw8EFtJWSYWvVhhY9L9BaJqYuPUHICVpx8bbX8VXL2iDLeidtTP19xp58QSPoeQmSpvX2Wq8I2hE3zvbiTnsSMZXem8IlzYNjgsCh27WypJwVh3Dg2f6QToy7EPqji2kLbLP/uqbbtVG3KCcxFXnu9fuq34RmCgbC+xt7EgrB1Fts0vc1W51eEWhzCTfIlCTnQU/5B4CO2iPwiJ948zMLRj8IE+U+SxmQ8IUzqcW99R2hp7Ukhfgy+pIS/JBtbtkqWLaPHv9m6Dtilcd3YFaX/EISAVS9B2JucTF0V805DX0YACZboC3gwgbwEkiZDknKZ6V+8stY2qAmzxstatUfM9PCQEFSUfL83yLSfiVpmchvnwAhjsl5lBFftlMXmHxFVuXf0gWlFdqYGT5x6A8hQAZDm2f5q0tHM5izC+yWPfZ1rCnLepl/dTKbV/sQjfKEnmE1xLQ2Q5PgNt4mbLnommGs84EVhO4iyV3Jx2kj19b7kI8/e0mdVqOW4+FnGJYdWtJ7DDH6LWWBIK/SyjDazOJkPEB7MGA+C9PFKuLZHy92Txfjf0JH/g+DrJI72coiXCaKgNngsU5FdJRXaFfhaD2XSSy+xffq4x4WKf6Ahk8dHI1ulsRIxC1pPmzlOZB4N0bQtxqI4Mk5h9Tg5+w7R1+PHgR5fZsuvoI5aPwAAAA="></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-리뷰미에서-적용한-난수-생성기">🔍 리뷰미에서 적용한 난수 생성기<a class="hash-link" aria-label="🔍 리뷰미에서 적용한 난수 생성기에 대한 직접 링크" title="🔍 리뷰미에서 적용한 난수 생성기에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/random#-%EB%A6%AC%EB%B7%B0%EB%AF%B8%EC%97%90%EC%84%9C-%EC%A0%81%EC%9A%A9%ED%95%9C-%EB%82%9C%EC%88%98-%EC%83%9D%EC%84%B1%EA%B8%B0">​</a></h2>
<p>리뷰미에서는 다른 사람에게 리뷰를 요청하기 위해 링크를 생성할 때 난수를 활용합니다.
독립적인 URL을 생성해야 하고, 그에 따른 접근 코드도 발급해야 했어요. 다른 사람에게 보내는 URL의 경우에는 노출될 확률이 높고, 크게 보안적으로 위험한 사안이 아닙니다.
예측에 성공했다고 하더라도 리뷰를 작성하는 행위밖에 할 수 없어요. 자세한 경험을 작성해야 하는 리뷰의 신뢰성이 떨어지고, 이는 읽는이가 빠르게 눈치챌 수 있겠습니다.</p>
<p>다만 리뷰를 확인할 때 사용하는 코드라면 어떨까요? 코드를 예측할 수 있다면 다른 사람의 리뷰를 확인할 수 있게 됩니다. 그 사람을 바라보는 팀원의 이야기는 보안에 신경쓸 필요가 있습니다.</p>
<p>하지만 유저 테스트 결과, 링크와 확인 코드 두 가지를 모두 기억하는 것이 사용자에게 부담으로 다가온다는 피드백이 있었어요.
URL과 확인 코드 두 개를 생성하는 일을 하나의 부담으로 합치는 일이 필요했습니다. 사용자가 직접 비밀번호를 설정하도록 함으로써 확인 코드는 역사 뒤편으로 사라지게 되었어요.</p>
<p>스프링 웹 서비스 특성 상 요청 당 스레드가 할당되는데요, 하나의 <code>Random</code> 객체에 접근했을 때의 속도 저하를 확인했기 때문에 이를 사용할 이유는 없었습니다.
나아가, <code>SecureRandom</code>을 사용할 수 있었지만 강력한 보안 대신 속도를 내주어야 했어요.</p>
<p style="text-align:center"><img src="data:image/webp;base64,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"></p>
<p>따라서 저희 팀에서는 <code>ThreadLocalRandom</code>을 활용하기로 했습니다. 영어 대소문자, 숫자로 이루어진 8자리 값이라 218,340,105,584,896가지의 경우의 수가 존재합니다 😄</p>]]></content:encoded>
            <category>blog</category>
        </item>
        <item>
            <title><![CDATA[스프링에서 예외를 잘! 처리하는 방법]]></title>
            <link>https://your-docusaurus-site.example.com/blog/exception-response</link>
            <guid>https://your-docusaurus-site.example.com/blog/exception-response</guid>
            <pubDate>Mon, 22 Jul 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[Intro]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="intro">Intro<a class="hash-link" aria-label="Intro에 대한 직접 링크" title="Intro에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/exception-response#intro">​</a></h2>
<p>자바 프로그램에서 예외가 발생하면 스레드가 종료됩니다.
하지만 스프링에서는 예외가 발생해도 어플리케이션이 종료되지 않고, 예외 응답을 반환합니다.
스프링은 어떻게 예외를 처리하기에 이렇게 작동하는 것일까요?🤔
이번 글에서는 <strong>스프링에서 어떻게 예외를 처리하는지와,
어떻게해야 예외를 잘~ 처리할 수 있는지</strong> 알아보겠습니다.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-스프링의-기본-예외-처리-방식">🔍 스프링의 기본 예외 처리 방식<a class="hash-link" aria-label="🔍 스프링의 기본 예외 처리 방식에 대한 직접 링크" title="🔍 스프링의 기본 예외 처리 방식에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/exception-response#-%EC%8A%A4%ED%94%84%EB%A7%81%EC%9D%98-%EA%B8%B0%EB%B3%B8-%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC-%EB%B0%A9%EC%8B%9D">​</a></h2>
<p>어떠한 예외처리도 하지 않았을 때, 스프링에서 어떤식으로 예외가 처리될까요?
우선 스프링의 기본 작동 방식에 대해 생각해봅시다.
스프링에 요청이 오면, <code>WAS - Dispatcher Servlet - HandlerMapping - HandlerAdapter - Controller</code> 를 거쳐 로직이 실행됩니다.</p>
<p>이때 예외가 발생하면 예외 내용은 WAS까지 거슬러 올라갑니다.
그럼 WAS는 어플리케이션에서 처리할 수 없는 예외라 판단하여 <strong>에러 컨트롤러</strong>로 예외 내용을 전달합니다.
즉, 예외가 발생하면 <strong><code>WAS - Controller - WAS - ErrorController</code></strong> 의 흐름을 갖게 됩니다.
이 과정을 통해 예외가 발생해도 어플리케이션을 종료하지 않고, 마치 정상 요청인 것처럼 예외 응답을 반환하는 것입니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="basicerrorcontroller">BasicErrorController<a class="hash-link" aria-label="BasicErrorController에 대한 직접 링크" title="BasicErrorController에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/exception-response#basicerrorcontroller">​</a></h3>
<p>이때 호출되는 에러 컨트롤러가 바로 <strong><code>BasicErrorController</code></strong> 입니다.
실제로 어떠한 예외처리도 하지 않고 BasicErrorController에 BreakPoint 를 걸어두고 디버깅하니,
BasicErrorController에서 예외가 핸들링되는 것을 확인할 수 있었습니다.</p>
<p style="text-align:center"><img src="https://your-docusaurus-site.example.com/assets/images/BasicErrorControllerDebugging-9e7433c3538a8ed8eed1554dd65073c0.png" style="width:100%"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="basicerrorcontroller의-응답">BasicErrorController의 응답<a class="hash-link" aria-label="BasicErrorController의 응답에 대한 직접 링크" title="BasicErrorController의 응답에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/exception-response#basicerrorcontroller%EC%9D%98-%EC%9D%91%EB%8B%B5">​</a></h3>
<p>BasicErrorController는 <code>DefaultErrorAttributes</code>의 <strong><code>getErrorAttributes()</code></strong> 함수를 호출해서 응답할 내용을 불러옵니다.
이때 getErrorAttributes()가 기본적으로 제공하는 속성과, 설정을 통해 추가할 수 있는 속성들은 다음과 같습니다.</p>
<ul>
<li>timestamp: 에러가 발생한 시간</li>
<li>status: 에러의 Http 상태</li>
<li>error: 에러 코드</li>
<li>path: 에러가 발생한 uri</li>
<li>exception: 최상위 예외 클래스의 이름(설정 필요)</li>
<li>message: 에러에 대한 내용(설정 필요)</li>
<li>errors: BindingExecption에 의해 생긴 에러 목록(설정 필요)</li>
<li>trace: 에러 스택 트레이스(설정 필요)</li>
</ul>
<div class="language-json codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-json codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">// 어떤 설정도 하지 않았을 때의 응답</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">{</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    "timestamp": "2024-07-21T16:16:40.463+00:00",</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    "status": 500,</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    "error": "Internal Server Error",</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    "path": "/reviews/999"</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-properties codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-properties codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">// 추가할 수 있는 속성들</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">server:</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  error:</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    include-message: always</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    include-binding-errors: always</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    include-stacktrace: always</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    include-exception: true</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-json codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-json codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">// 모든 속성을 추가했을 때의 응답</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">{</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    "timestamp": "2024-07-21T16:19:58.729+00:00",</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    "status": 500,</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    "error": "Internal Server Error",</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    "exception": "org.springframework.orm.jpa.JpaObjectRetrievalFailureException",</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    "trace": "org.springframework.orm.jpa.JpaObjectRetrievalFailureException\n\tat ….",</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    "message": "No message available",</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    "path": "/reviews/999"</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="basicerrorcontroller를-통한-예외-처리의-한계">BasicErrorController를 통한 예외 처리의 한계<a class="hash-link" aria-label="BasicErrorController를 통한 예외 처리의 한계에 대한 직접 링크" title="BasicErrorController를 통한 예외 처리의 한계에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/exception-response#basicerrorcontroller%EB%A5%BC-%ED%86%B5%ED%95%9C-%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC%EC%9D%98-%ED%95%9C%EA%B3%84">​</a></h3>
<p>혹시 '이것만으로도 충분히 훌륭한데?' 라는 생각이 드시나요?
하지만 이 방식에는 몇가지 한계가 존재합니다.
첫째로, 이 방식은 WAS에서 컨트롤러를 거쳐, 다시 WAS로 왔다가, 에러 컨트롤러로 가는 흐름인데요, 이 과정이 길고 복잡하게 느껴집니다.
또 이는 필터나 인터셉터를 2번 호출하는 등 다른 문제를 야기할 수 있습니다.
그리고 결정적으로, 예외에 따라 다른 HttpStatusCode와 메세지를 줄 수도 없습니다😓</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-스프링이-제공하는-다양한-예외-처리-방식">🔍 스프링이 제공하는 다양한 예외 처리 방식<a class="hash-link" aria-label="🔍 스프링이 제공하는 다양한 예외 처리 방식에 대한 직접 링크" title="🔍 스프링이 제공하는 다양한 예외 처리 방식에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/exception-response#-%EC%8A%A4%ED%94%84%EB%A7%81%EC%9D%B4-%EC%A0%9C%EA%B3%B5%ED%95%98%EB%8A%94-%EB%8B%A4%EC%96%91%ED%95%9C-%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC-%EB%B0%A9%EC%8B%9D">​</a></h2>
<p>이런 단점을 보완하기 위해서, 스프링에서는 기본 예외 처리 외에도 다양한 예외 처리 방식을 제공합니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="handlerexceptionresolver">HandlerExceptionResolver<a class="hash-link" aria-label="HandlerExceptionResolver에 대한 직접 링크" title="HandlerExceptionResolver에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/exception-response#handlerexceptionresolver">​</a></h3>
<p>HandlerExceptionResolver는 예외 처리 방식을 추상화한 인터페이스입니다.
이를 구현하는 구현체들은 발생한 예외를 캐치하여 응답의 Http 상태나 메세지를 설정합니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="handlerexceptionresolver의-구현체들">HandlerExceptionResolver의 구현체들<a class="hash-link" aria-label="HandlerExceptionResolver의 구현체들에 대한 직접 링크" title="HandlerExceptionResolver의 구현체들에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/exception-response#handlerexceptionresolver%EC%9D%98-%EA%B5%AC%ED%98%84%EC%B2%B4%EB%93%A4">​</a></h3>
<p>HandlerExceptionResolver의 구현체들은 HandlerExceptionResolverComposite에 우선순위 순서대로 빈으로 등록되어 관리됩니다.</p>
<p style="text-align:center"><img src="https://your-docusaurus-site.example.com/assets/images/HandlerExceptionResolverComposite-afdfcaef06c2decbd2fe07f7693029b0.png" style="width:100%"></p>
<p>그리고 예외 발생 시, 우선순위 순으로 구현체들을 순회하며 핸들링을 할 수 있는지 확인합니다.</p>
<div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">HandlerExceptionResolverComposite</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">HandlerExceptionResolver</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Ordered</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">	</span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">	</span><span class="token annotation punctuation" style="color:#393A34">@Nullable</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">ModelAndView</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">resolveException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HttpServletRequest</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">HttpServletResponse</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token annotation punctuation" style="color:#393A34">@Nullable</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token plain"> handler</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">		</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resolvers </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// 구현체들을 순회하면서 예외를 처리할 수 있는지 확인</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">			</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HandlerExceptionResolver</span><span class="token plain"> handlerExceptionResolver </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resolvers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">				</span><span class="token class-name">ModelAndView</span><span class="token plain"> mav </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> handlerExceptionResolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">resolveException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handler</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">				</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mav </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">					</span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> mav</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">				</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">			</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">		</span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>빈으로 등록된 HandlerExceptionResolver 구현체과 그것이 처리하는 대상은 아래와 같습니다.</p>
<ul>
<li><strong>ExceptionHandlerExceptionResolver</strong> : ExceptionHandler를 처리</li>
<li><strong>ResponseStatusExceptionResolver</strong> : ResponseStatus, ResponseStatusException를 처리</li>
<li><strong>DefaultHandlerExceptionResolver</strong> : 스프링 내부의 기본 예외들을 처리</li>
</ul>
<p>하지만 <strong><code>ResponseStatusExceptionResolver</code></strong> 만으로는 에러 응답을 수정할 수 없으며, 일괄 에러 처리를 할 수 없다는 단점이 있으므로 이번 글에서는 설명하지 않겠습니다.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-handlerexceptionresolver를-동작시키는-것들">🔍 HandlerExceptionResolver를 동작시키는 것들<a class="hash-link" aria-label="🔍 HandlerExceptionResolver를 동작시키는 것들에 대한 직접 링크" title="🔍 HandlerExceptionResolver를 동작시키는 것들에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/exception-response#-handlerexceptionresolver%EB%A5%BC-%EB%8F%99%EC%9E%91%EC%8B%9C%ED%82%A4%EB%8A%94-%EA%B2%83%EB%93%A4">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="exceptionhandler와-controlleradvice">@ExceptionHandler와 @ControllerAdvice<a class="hash-link" aria-label="@ExceptionHandler와 @ControllerAdvice에 대한 직접 링크" title="@ExceptionHandler와 @ControllerAdvice에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/exception-response#exceptionhandler%EC%99%80-controlleradvice">​</a></h3>
<p>@ExceptionHandler는 가장 우선순위가 높은 예외 핸들러인 <strong>ExceptionHandler ExceptionResolver</strong>에서 처리됩니다.
@ExceptionHandler는 예외 응답의 코드와 <strong>메세지를 자유롭게 설정</strong>할 수 있다는 장점이 있습니다.
@ExceptionHandler는 컨트롤러의 메서드에 바로 사용할 수도 있으며, @ControllerAdvice나 @RestControllerAdvice가 있는 클래스의 메소드에도 사용할 수 있습니다.
만약 컨트롤러의 메서드에도 @ExceptionHandler를 사용하고, @ControllerAdvice에도 사용한다면 전자가 우선시됩니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="스프링-내부의-기본-예외들">스프링 내부의 기본 예외들<a class="hash-link" aria-label="스프링 내부의 기본 예외들에 대한 직접 링크" title="스프링 내부의 기본 예외들에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/exception-response#%EC%8A%A4%ED%94%84%EB%A7%81-%EB%82%B4%EB%B6%80%EC%9D%98-%EA%B8%B0%EB%B3%B8-%EC%98%88%EC%99%B8%EB%93%A4">​</a></h3>
<p>스프링에서 발생할 수 있는 기본 예외들은 미리 정의되어, <strong>DefaultHandler ExceptionResolver</strong>에서 처리됩니다.
대표적인 예외로는 지원하지 않는 HttpMethod 로 요청을 보낼 때 발생하는 HttpRequestMethod NotSupportedException가 있습니다.
DefaultHandler ExceptionResolver는 에러를 핸들링해서 어떤 기본 예외인지 판별하는 역할까지만 하므로, 직접 예외 응답을 반환하지는 않습니다.
따라서 최종적으로 <strong>BasicController를 통해서 예외 응답을 반환</strong>합니다.</p>
<p style="text-align:center"><img src="https://your-docusaurus-site.example.com/assets/images/DefaultHandlerExceptionResolver-1934477ed9f0c0121039d95e599db76b.png" style="width:100%"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="responseentityexceptionhandler">ResponseEntityExceptionHandler<a class="hash-link" aria-label="ResponseEntityExceptionHandler에 대한 직접 링크" title="ResponseEntityExceptionHandler에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/exception-response#responseentityexceptionhandler">​</a></h3>
<p>여기까지 읽으시며 이상함을 느끼셨나요?😳
ExceptionHandler를 사용하면 예외 응답 형식을 지정할 수 있습니다.
반면 스프링 기본 예외는 DefaultHandler ExceptionResolver로 처리되기 때문에 BasicController의 응답 형식을 따르게 됩니다.
따라서 <strong>ExceptionHandler로 처리되는 예외와, 기본 예외의 응답 형식이 다르다</strong>는 문제가 생기게 됩니다.
이를 해결하기 위해 스프링은 <strong>ResponseEntity ExceptionHandler</strong> 를 제공합니다.</p>
<p>ResponseEntity ExceptionHandler는 <strong>스프링 기본 예외에 대한 핸들링을 미리 정의</strong>해둔 추상 클래스입니다.
따라서 ControllerAdvice가 ResponseEntity ExceptionHandler를 상속하게 하는것 만으로 스프링 기본 예외를 핸들링할 수 있습니다.
또한 ResponseEntity ExceptionHandler는 모든 기본 예외를 <strong>handleExceptionInternal()</strong> 함수로 처리하고 있기 때문에,
이 함수를 오버라이딩해줌으로써, 모든 기본 예외의 응답을 커스텀 예외 응답형식으로 통일할 수 있습니다.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="어떻게-해야-예외를-잘-응답할-수-있을까">어떻게 해야 예외를 잘 응답할 수 있을까?<a class="hash-link" aria-label="어떻게 해야 예외를 잘 응답할 수 있을까?에 대한 직접 링크" title="어떻게 해야 예외를 잘 응답할 수 있을까?에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/exception-response#%EC%96%B4%EB%96%BB%EA%B2%8C-%ED%95%B4%EC%95%BC-%EC%98%88%EC%99%B8%EB%A5%BC-%EC%9E%98-%EC%9D%91%EB%8B%B5%ED%95%A0-%EC%88%98-%EC%9E%88%EC%9D%84%EA%B9%8C">​</a></h2>
<p>여기까지 우리는 스프링에서 예외를 처리하는 방법에 대해 알아봤습니다.
그럼 이들을 바탕으로 우리는 어떻게 예외를 잘 처리하고, 잘 응답할 수 있을까요?🤔
제가 세운 기준은 아래와 같습니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-exceptionhandler를-사용하자">1. ExceptionHandler를 사용하자.<a class="hash-link" aria-label="1. ExceptionHandler를 사용하자.에 대한 직접 링크" title="1. ExceptionHandler를 사용하자.에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/exception-response#1-exceptionhandler%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EC%9E%90">​</a></h3>
<p>스프링의 기본 예외 처리 방식인 BasicErrorController 를 사용하는 방식은,
http status code 와 예외 메세지를 지정할 수 없다는 문제가 있습니다.
ExceptionHandler 를 사용해서 유연하게 예외를 핸들링하는 것이 좋습니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-controlleradvice-안에서-exceptionhandler를-사용하자">2. ControllerAdvice 안에서 ExceptionHandler를 사용하자.<a class="hash-link" aria-label="2. ControllerAdvice 안에서 ExceptionHandler를 사용하자.에 대한 직접 링크" title="2. ControllerAdvice 안에서 ExceptionHandler를 사용하자.에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/exception-response#2-controlleradvice-%EC%95%88%EC%97%90%EC%84%9C-exceptionhandler%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EC%9E%90">​</a></h3>
<p>ExceptionHandler를 사용해서 각 컨트롤러마다 예외를 처리하는 방식은 중복되는 코드가 많을 것입니다.
또한 어떤 컨트롤러에는 ExceptionHandler를 붙이고, 다른 컨트롤러에는 붙이지 않는 등의 누락도 생길 수 있습니다.
따라서 예외 핸들링을 전역으로 할 수 있는 ControllerAdvice 안에서 ExceptionHandler를 사용하는 것이 좋습니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-최상위-예외인-exception를-핸들링하자">3. 최상위 예외인 Exception를 핸들링하자.<a class="hash-link" aria-label="3. 최상위 예외인 Exception를 핸들링하자.에 대한 직접 링크" title="3. 최상위 예외인 Exception를 핸들링하자.에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/exception-response#3-%EC%B5%9C%EC%83%81%EC%9C%84-%EC%98%88%EC%99%B8%EC%9D%B8-exception%EB%A5%BC-%ED%95%B8%EB%93%A4%EB%A7%81%ED%95%98%EC%9E%90">​</a></h3>
<p>최상위 예외에 대한 핸들링을 하지 않는다면, <strong><code>BasicController</code></strong> 를 통해 응답되는 예외가 있을 수 있습니다.
그렇다면 우리가 정의한 커스텀 예외 응답과 다른 형식이 되므로, 일관성이 깨지게 됩니다.
따라서 최상위 예외에 대해 처리를 해줘야 합니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-스프링-기본-예외의-응답을-통일하자">4. 스프링 기본 예외의 응답을 통일하자.<a class="hash-link" aria-label="4. 스프링 기본 예외의 응답을 통일하자.에 대한 직접 링크" title="4. 스프링 기본 예외의 응답을 통일하자.에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/exception-response#4-%EC%8A%A4%ED%94%84%EB%A7%81-%EA%B8%B0%EB%B3%B8-%EC%98%88%EC%99%B8%EC%9D%98-%EC%9D%91%EB%8B%B5%EC%9D%84-%ED%86%B5%EC%9D%BC%ED%95%98%EC%9E%90">​</a></h3>
<p>마찬가지로 일관성을 위해 스프링 기본 예외의 응답도 통일할 필요가 있습니다.
따라서 ControllerAdvice에서 ResponseEntityExceptionHandler를 상속하고, handleExceptionInternal() 함수를 오버라이딩해줘야 합니다.</p>]]></content:encoded>
            <category>review-me</category>
            <category>blog</category>
            <category>backend</category>
            <category>exception</category>
        </item>
        <item>
            <title><![CDATA[GitHub Actions를 활용한 CI/CD (Self-Hosted Runner)]]></title>
            <link>https://your-docusaurus-site.example.com/blog/ci-cd</link>
            <guid>https://your-docusaurus-site.example.com/blog/ci-cd</guid>
            <pubDate>Sun, 21 Jul 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[Continuous Integration]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="continuous-integration">Continuous Integration<a class="hash-link" aria-label="Continuous Integration에 대한 직접 링크" title="Continuous Integration에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/ci-cd#continuous-integration">​</a></h2>
<p>CI는 일련의 구체적인 과정을 의미하기보다는, 개발 방식 중 하나를 뜻합니다.
기능을 구현하고, 기존 저장소에 새로운 기능을 병합하는 일련의 과정을 말하죠.
이때 빌드/통합 오류를 가능한 한 빠르게 찾아내야 하며, 이때 자동화 빌드나 테스트 도구가 활용됩니다.
이 중 하나로 Jenkins, GitHub Actions와 같은 CI/CD 도구들이 사용돼요.</p>
<p>이슈를 발행해 할 일을 만들고, PR을 통해 서로 리뷰하고 머지하기. 추가적인 테스트나 자동화 빌드 도구가 필요할까요?
서로 확인했으니 믿고 사용해도 되지 않을까요? 실제로 팀 내에서 서로 다른 기능을 머지하려는 도중 충돌이 발생했어요.
이를 잘 해결한 뒤 머지할 수 있었습니다. 하지만 아래와 같은 일이 추가로 발생했어요.</p>
<p style="text-align:center"><img src="https://your-docusaurus-site.example.com/assets/images/1-607487a45f21595137a2d41f218d7703.png" style="width:70%"></p>
<p>사람은 실수하기 마련입니다. 코드에 변화가 있었음에도 회귀 테스트<sub>regression test</sub>를 진행하지 않았어요. 결국 테스트되지 않은 코드가 PR에 포함됐어요.
이를 다른 팀원들도 확인하지 못해 실제 개발 서버에 머지됐습니다. 이를 해결하기 위해 다시 이슈를 작성하고, 핫픽스를 적용하고, … 😮‍💨</p>
<p>테스트와 빌드가 매 PR마다, PR 안의 커밋마다 진행된다면 편리하지 않을까요? 만약 실패한다면 저장소에 통합하는 것이 실패하도록 한다면 더 좋겠습니다.
GitHub Actions을 사용하면 이를 해결할 수 있습니다. 빌드부터 테스트 자동화와 더불어 Branch protection을 통해 빌드/테스트에 실패한다면 병합하지 않도록 설정할 수도 있어요.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>정보</div><div class="admonitionContent_BuS1"><p>이 글에서는 GitHub Actions를 활용한 CI, CD에 대해서 다룹니다. 아래와 같은 사전지식을 요구하나, 모르더라도 따라오는 데에 큰 어려움이 없도록 글을 써보려고 합니다. 😄</p><ul>
<li>Git</li>
<li>Shell script</li>
<li>Gradle task</li>
</ul></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ci-with-github-actions">CI with GitHub Actions<a class="hash-link" aria-label="CI with GitHub Actions에 대한 직접 링크" title="CI with GitHub Actions에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/ci-cd#ci-with-github-actions">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-용어-정리">📚 용어 정리<a class="hash-link" aria-label="📚 용어 정리에 대한 직접 링크" title="📚 용어 정리에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/ci-cd#-%EC%9A%A9%EC%96%B4-%EC%A0%95%EB%A6%AC">​</a></h3>
<p>GitHub Actions는 <a href="https://docs.github.com/en/actions" target="_blank" rel="noopener noreferrer"><strong>이곳</strong></a>에 정말 자세하게 설명돼 있습니다.
러닝커브가 낮은 편이 아니라서 꽤나 많은 사전지식을 필요로 하지만, 간단하게 action이 동작하는 방식을 알기 위한 용어들을 소개합니다.</p>
<ul>
<li>
<p>🛠️ <strong>Workflows</strong><br>
<!-- -->Job의 집합입니다, repository에서 특정 이벤트가 트리거되면 실행됩니다.
<code>./github/workflows</code> 디렉토리 밑에 <code>.yml</code> 또는 <code>.yaml</code>을 생성해야 해요.
Workflow는 다른 workflow에서 재사용할 수도 있습니다.</p>
</li>
<li>
<p>🎉 <strong>Events</strong><br>
<!-- -->Workflow가 실행되게끔 하는 이벤트입니다. PR을 열거나, 이슈를 열거나, push하거나 등 다양한 event가 존재합니다.</p>
</li>
<li>
<p>♻️ <strong>Jobs</strong><br>
<!-- -->Workflow에 속하는 step의 집합이며, <strong>같은 runner 안에서 실행</strong>됩니다. Job끼리는 <strong>병렬적으로 실행</strong>됩니다.
다른 job과의 의존관계가 존재한다면, 이를 <code>needs</code> 로 명시해야 합니다.
각 step은 <strong>shell script</strong>이거나, <strong>action</strong> 중 하나입니다. step은 순서대로 실행되며, 이전 step이 다음 것에 영향을 끼칩니다.
빌드한 것을 다음 step에서 활용할 수도 있어요.</p>
</li>
<li>
<p>📋 <strong>Actions</strong><br>
<!-- -->Github Actions에서 사용되는 custom application. workflow에서의 중복되는 코드를 라이브러리로 만들었다고 생각하면 편합니다.
GitHub에서 제공하는 여러 권한을 가져갈 수 있습니다. 이를 외부 Job에서 설정해줄 수도 있어요.</p>
</li>
<li>
<p>🏃 <strong>Runners</strong><br>
<!-- -->Workflow가 돌아가는 os가 포함된 서버입니다. GitHub는 Ubuntu Linux, Windows, macOS Runner를 제공합니다.
직접 runner를 호스팅할 수도 있는데, 이를 <strong>self-hosted runner</strong>라고 부릅니다.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-요구사항-정의-및-분석">🔍 요구사항 정의 및 분석<a class="hash-link" aria-label="🔍 요구사항 정의 및 분석에 대한 직접 링크" title="🔍 요구사항 정의 및 분석에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/ci-cd#-%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD-%EC%A0%95%EC%9D%98-%EB%B0%8F-%EB%B6%84%EC%84%9D">​</a></h3>
<p>우리는 <strong>1. 빌드에 실패하는 경우 저장소에 반영되지 않도록</strong> 하고 싶습니다.
이는 <strong>2. PR이 생성되었을 때나 변경 사항이 저장소에 반영되었을 때, 빌드 테스트를 진행</strong>할 수 있어야 합니다.</p>
<p>앞쪽 문장인 빌드 실패 시 저장소 반영하지 않도록 하는 것은 GitHub에서 제공하는 Branch protection을 사용해 간단하게 해결할 수 있습니다.
PR에 Approved 리뷰가 일정 개수 이상, Status check 등 다양한 브랜치 보호 옵션을 제공하니 중요한 저장소라면 꼭 챙겨가야 합니다.</p>
<p>브랜치 보호는 되었으니, 이젠 Status check에 반영될 빌드 - 테스트를 자동화해야 합니다. 위 요구사항 문장을 조금 더 잘게 쪼개 볼까요?</p>
<blockquote>
<p>PR이 생성되었을 때나 변경 사항이 저장소에 반영되었을 때,</p>
</blockquote>
<p>앞서 설명한 용어 중 event에 해당해요. GitHub actions에서는 <code>on</code>이라는 키워드로 적용할 수 있습니다.</p>
<blockquote>
<p>빌드 및 테스트를 진행할 수 있다</p>
</blockquote>
<p>테스트를 진행하기 위해서는 다양한 옵션이 필요합니다. 우선 <strong>테스트를 돌릴 환경</strong>이 있어야 해요.
나아가 그 환경 안에 <strong>Java가 설치</strong>돼 있어야 하고, <strong>저장소를 복제</strong>해 코드를 가져와야 합니다. 프로젝트에 따라 자동 빌드 툴도 필요할 수 있습니다.
저희 팀에서는 <strong>Gradle을 활용해 빌드</strong>하므로, Gradle도 필요하겠네요.</p>
<p>할 일이 상당히 많아 보이는데, 굵게 표시한 문구들은 전부 GitHub에서 제공합니다.
따라서 이를 활용할 수 있는 workflow 파일 하나로 완성해낼 수 있습니다. 파일을 직접 만들어보고, 실행 결과를 확인해 봅시다!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-workflow-파일-작성하기">📝 Workflow 파일 작성하기<a class="hash-link" aria-label="📝 Workflow 파일 작성하기에 대한 직접 링크" title="📝 Workflow 파일 작성하기에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/ci-cd#-workflow-%ED%8C%8C%EC%9D%BC-%EC%9E%91%EC%84%B1%ED%95%98%EA%B8%B0">​</a></h3>
<div class="language-yaml codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yaml codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token comment" style="color:#999988;font-style:italic"># Workflow 파일은 .github/workflows 디렉토리 아래 .yml 또는 .yaml 파일로 존재한다.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Workflow 이름. 하나의 파일이 하나의 Workflow를 담당한다. Workflow는 Job의 집합이다.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Build test with Gradle</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Event. 언제 이 Workflow가 트리거돼 실행될 지 작성한다.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pull_request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> develop </span><span class="token comment" style="color:#999988;font-style:italic"># develop 브랜치에 PR이 작성되는 경우</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># build라는 이름의 Job 한 개로 이루어진 workflow이다.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># build는 이름이며, 자유롭게 적을 수 있다.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 이 Job이 실행될 환경. GitHub에서는 Linux, Windows, macOS 환경을 제공한다.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Job은 여러 Step으로 이뤄져 있으며, 이는 순서대로 실행된다.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 가상환경에서 Repository를 clone해 코드를 사용할 수 있도록 한다.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Checkout to current repository</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v4</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># JDK를 설치한다.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Setup JDK Corretto using cached gradle dependencies</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/setup</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">java@v4</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">distribution</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'corretto'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">java-version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">17</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">cache</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'gradle'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 사전 작업이 모두 준비되었으므로, 테스트를 진행한다.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Build and test with gradle</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./gradlew test</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>제공하는 action들은 저장소가 존재하며, 해당 저장소에 어떻게 사용하는지 자세히 적혀있는 경우가 많습니다.
예를 들어 <code>actions/setup-java@v4</code>의 경우, 특별한 버전과 벤더를 선택함과 더불어 <code>gradle</code> 캐싱까지 진행합니다.</p>
<p><code>run</code>에서는 실제로 실행할 쉘 스크립트를 작성하면 됩니다.
shell script에 익숙하지 않다면, 자신있는 다른 언어(python, nodejs 등)로 로직을 짜준 뒤, 실행하는 방법도 있습니다.</p>
<p>이제 PR을 올릴 때마다 빌드 및 테스트를 진행합니다. 실패하는 경우에는 머지하는 불상사가 발생하지 않게 되었어요 🔥</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="continuous-deployment">Continuous Deployment<a class="hash-link" aria-label="Continuous Deployment에 대한 직접 링크" title="Continuous Deployment에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/ci-cd#continuous-deployment">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-delivery-deployment">🤔 Delivery? Deployment?<a class="hash-link" aria-label="🤔 Delivery? Deployment?에 대한 직접 링크" title="🤔 Delivery? Deployment?에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/ci-cd#-delivery-deployment">​</a></h3>
<p>CI와 함께 붙어다니는 단어로 CD가 있습니다 💿. CD는 위와 같이 두 용어가 자주 혼용되는데요, 비슷한 맥락이지만 아래와 같은 차이점이 있답니다.</p>
<ul>
<li>Continuous delivery는 프로덕션 코드에 직접 빌드 결과를 제공하기까지만 하며, 배포를 위해 추가적인 작업이 필요합니다. '출시일'이라는 개념이 존재한다고 보면 됩니다.</li>
<li>Continuous deployment는 배포까지 파이프라인에 속해요. 추가적으로 개입할 프로세스가 존재하지 않으며, 사용자는 항상 최신 버전의 코드를 마주합니다.</li>
</ul>
<p>이번 프로젝트에서의 개발 서버는 Continuous Deployment로 진행되기를 원했습니다. 기능 개발이 완료된다면 즉시 배포돼 프론트엔드가 확인하는 것을 목표로 하기 때문이예요.
이 또한 GitHub actions를 활용해 CD 파이프라인도 작성할 수 있습니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-제약-사항">🚫 제약 사항<a class="hash-link" aria-label="🚫 제약 사항에 대한 직접 링크" title="🚫 제약 사항에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/ci-cd#-%EC%A0%9C%EC%95%BD-%EC%82%AC%ED%95%AD">​</a></h3>
<p>CD는 다양한 방법으로 구현될 수 있습니다. ssh 접속, aws S3와 CodeDeploy 등 다양한데요, 프로젝트를 진행하면서 다음과 같은 제약 사항이 존재해 이들을 사용할 수 없었습니다.</p>
<ul>
<li>캠퍼스 외부에서의 접속은 금지돼 있습니다. 80/443 포트를 통한 웹 접근만 가능합니다. ssh는 22번 포트로 통신합니다. (다른 방법으로 우회할 수는 있겠습니다만, 강하게 권하지 않습니다 🥹)</li>
<li>제공된 aws IAM 계정으로는 S3의 Access Token을 사용할 수 없습니다. 따라서 S3 자동 업로드 / CodeDeploy 사용이 불가합니다.
이를 해결하기 위해 새로운 aws 계정을 생성해야 하며, 다양한 설정이 필요합니다. (<a href="https://wnsah052.tistory.com/206" target="_blank" rel="noopener noreferrer">Reference</a>)</li>
</ul>
<p>간단한 해결 방법으로 GitHub의 Self-hosted runner를 활용합니다. 서비스를 띄우는 인스턴스에 리스너를 달아두는 형식입니다.
actions에서 443번 포트를 통해 workflow 정보를 전달하기 때문에, 아직까지 80포트만을 사용하는 개발 단계에서는 도전해볼 가치가 있습니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-self-hosted-runner-구성하기">🚀 Self-hosted runner 구성하기<a class="hash-link" aria-label="🚀 Self-hosted runner 구성하기에 대한 직접 링크" title="🚀 Self-hosted runner 구성하기에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/ci-cd#-self-hosted-runner-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0">​</a></h3>
<p>프로젝트 인스턴스를 runner로 생성해 actions에서 사용할 수 있습니다. 방법은 어렵지 않습니다!
Repository setting 탭의 Actions - Runners 탭의 New self-hosted runner를 클릭해 추가합시다.</p>
<p style="text-align:center"><img src="https://your-docusaurus-site.example.com/assets/images/2-dc18d0733a0f5813c6bcb463fbcbbfc1.png"></p>
<p>일련의 과정을 수행한다면 443 포트를 계속해서 듣고 있을 거예요. 이제 모든 준비는 끝났습니다 😄</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-요구사항-정의-및-분석-1">🔍 요구사항 정의 및 분석<a class="hash-link" aria-label="🔍 요구사항 정의 및 분석에 대한 직접 링크" title="🔍 요구사항 정의 및 분석에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/ci-cd#-%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD-%EC%A0%95%EC%9D%98-%EB%B0%8F-%EB%B6%84%EC%84%9D-1">​</a></h3>
<p>요구사항은 다음과 같습니다.</p>
<ul>
<li>앞선 빌드 테스트가 선행되어야 합니다.</li>
<li>gradle의 <code>bootJar</code> task를 통해 실행 파일을 생성합니다.</li>
<li>현재 80 포트에 바인딩된 프로그램이 존재한다면, 이를 종료합니다.</li>
<li>새로운 실행 파일을 띄웁니다.</li>
</ul>
<p>위의 두 개는 이전 CI에서 진행했던 것과 거의 같습니다. 아래 두 개는 Shell script를 통해서 진행할 수 있겠네요!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-workflow-파일-작성하기-1">📝 Workflow 파일 작성하기<a class="hash-link" aria-label="📝 Workflow 파일 작성하기에 대한 직접 링크" title="📝 Workflow 파일 작성하기에 대한 직접 링크" href="https://your-docusaurus-site.example.com/blog/ci-cd#-workflow-%ED%8C%8C%EC%9D%BC-%EC%9E%91%EC%84%B1%ED%95%98%EA%B8%B0-1">​</a></h3>
<div class="language-yaml codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yaml codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CD using Github self</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hosted runner</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># actions 탭에서 실행할 수 있도록 한다</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">workflow_dispatch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> main</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> develop</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ARTIFACT_NAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 프로젝트 이름과 같이 구별할 수 있는 문자열</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ARTIFACT_DIRECTORY</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./build/libs</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 해당 workflow는 두 개의 job으로 이루어져 있다. </span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 하나는 빌드를 통한 jar 생성, 하나는 생성된 jar 배포이다.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 전자는 GitHub에서 제공하는 runner를, 후자는 self-hosted runner를 사용한다.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 대부분 앞선 CI와 동일하나, gradle에서 테스트를 하지 않고, jar 파일을 만들어낸다</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Build Jar file and upload artifact</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Checkout to current repository</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v4</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Setup JDK Corretto using cached gradle dependencies</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/setup</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">java@v4</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">distribution</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'corretto'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">java-version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">17</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">cache</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'gradle'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Setup Gradle</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gradle/actions/setup</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gradle@v3</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">gradle-version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8.8</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Build and test with gradle</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./gradlew clean bootJar</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Rename artifact file</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          mv ${{ env.ARTIFACT_DIRECTORY }}/*.jar \</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          ${{ env.ARTIFACT_DIRECTORY }}/${{ env.ARTIFACT_NAME }}.jar</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Upload created artifact</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/upload</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">artifact@v4</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> env.ARTIFACT_NAME </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> env.ARTIFACT_DIRECTORY </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> env.ARTIFACT_NAME </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">.jar</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">deploy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deploy via self</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hosted runner</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">needs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> build</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hosted</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Download uploaded artifact</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/download</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">artifact@v4</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 앞선 actions/upload-artifact에서 업로드한 실행 파일을 다운로드한다</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> env.ARTIFACT_NAME </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> env.ARTIFACT_DIRECTORY </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 80 포트에 열려있는 프로세스를 확인하고, 존재한다면 환경변수를 설정한다</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># well-known port (~1024)를 확인하거나 바인딩, 종료할 때에는 권한이 필요하다</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># bash에서 실패하는 경우 전체 job이 실패하므로, || (or) true 연산을 진행한다</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Check if the port 80 is in use</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          echo "Checking ports on http..."</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          PID=$(sudo lsof -t -i :http || true)</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          if [ -n "$PID" ]; then</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo "Found process running on port http: $PID"</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo "server_running=true" &gt;&gt; "$GITHUB_ENV"</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo "PID=$PID" &gt;&gt; "$GITHUB_ENV"</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          else</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo "Process not found running on port http!"</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo "server_running=false" &gt;&gt; "$GITHUB_ENV"</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          fi</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 앞선 step에서 실행되고 있는 프로세스가 발견되는 경우, 이를 종료한다.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 단, -15와 같은 graceful 종료를 진행한다.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 종료된 것을 확인하기 위해 tail 명령어를 사용한다</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 프로그램이 종료되는 경우 tail도 종료된다</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Stop server if available (gracefully)</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 이 step이 실행될 조건을 설정한다</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> env.server_running == 'true'</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          echo "Gracefully shutting down process ${{ env.PID }}"</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          sudo kill -15 ${{ env.PID }}</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          tail --pid=${{ env.PID }} -f /dev/null</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Start server</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          sudo nohup java -jar \</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          ${{ env.ARTIFACT_DIRECTORY }}/${{ env.ARTIFACT_NAME }}.jar \</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          --server.port=80 &amp;</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>추후 443번 포트를 통한 Http 웹 어플리케이션이 배포된다면 어떻게 될까요 🤨? 아직은 일어나지 않았지만, 이 경우에 대한 대비가 필요하겠네요.</p>
<p>이로써 PR을 작성하면 자동 빌드/테스트가, 해당 PR이 머지되면 전체 빌드/테스트/배포가 되도록 자동화할 수 있었습니다!
Actions를 조금 더 활용한다면 Slack 알림과 같은 기능도 사용할 수 있으니, 익숙해져보는 것이 좋겠습니다 😄
개발할 때 답답하거나 불편함을 느낀다면, 이 또한 개선할 수 있는 점이니깐요!</p>]]></content:encoded>
            <category>review-me</category>
            <category>blog</category>
            <category>backend</category>
            <category>ci/cd</category>
            <category>github-actions</category>
        </item>
        <item>
            <title><![CDATA[안녕하세요, 리뷰미!]]></title>
            <link>https://your-docusaurus-site.example.com/blog/hello-world</link>
            <guid>https://your-docusaurus-site.example.com/blog/hello-world</guid>
            <pubDate>Tue, 02 Jul 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[우아한테크코스 6기 레벨 3이 시작되었습니다 🥹]]></description>
            <content:encoded><![CDATA[<p>우아한테크코스 6기 레벨 3이 시작되었습니다 🥹</p>]]></content:encoded>
            <category>review-me</category>
            <category>blog</category>
            <category>troubleshooting</category>
        </item>
    </channel>
</rss>