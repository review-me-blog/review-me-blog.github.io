<!doctype html>
<html lang="ko" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">&quot;infra&quot; 태그로 연결된 1개 게시물개의 게시물이 있습니다. | 리뷰미 팀블로그</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/blog/tags/infra"><meta data-rh="true" property="og:locale" content="ko"><meta data-rh="true" name="docusaurus_locale" content="ko"><meta data-rh="true" name="docsearch:language" content="ko"><meta data-rh="true" property="og:title" content="&quot;infra&quot; 태그로 연결된 1개 게시물개의 게시물이 있습니다. | 리뷰미 팀블로그"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/blog/tags/infra"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/blog/tags/infra" hreflang="ko"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/blog/tags/infra" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="리뷰미 팀블로그 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="리뷰미 팀블로그 Atom Feed">




<script src="https://unpkg.com/twemoji@latest/dist/twemoji.min.js" crossorigin="anonymous" defer="defer"></script><link rel="stylesheet" href="/assets/css/styles.2288300f.css">
<script src="/assets/js/runtime~main.58171a74.js" defer="defer"></script>
<script src="/assets/js/main.bc70fc0e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="본문으로 건너뛰기"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">본문으로 건너뛰기</a></div><nav aria-label="메인" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="사이드바 펼치거나 접기" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="리뷰미 로고" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="리뷰미 로고" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">리뷰미 팀 블로그</b></a><a class="navbar__item navbar__link" href="/docs/common/ground-rule">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/woowacourse-teams/2024-review-me" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)" aria-label="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="최근 블로그 문서 둘러보기"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/versioning-nginx">Nginx 설정 형상관리하기</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/domain-design-2">우리 팀에 맞는 도메인 설계는 무엇일까?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/release-version-1.0.0">리뷰미 프로젝트 기획 및 리뷰미 version 1.0.0 소개</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/domain-design">무엇이 좋은 도메인 설계인가?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/random">리뷰미에서 랜덤을 활용하는 방법</a></li></ul></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><h1>&quot;infra&quot; 태그로 연결된 1개 게시물개의 게시물이 있습니다.</h1><a href="/blog/tags">모든 태그 보기</a></header><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/versioning-nginx">Nginx 설정 형상관리하기</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-09-09T00:00:00.000Z">2024년 9월 9일</time> · <!-- -->약 15분</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/donghoony" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/donghoony.png" alt="이동훈 (아루)"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/donghoony" target="_blank" rel="noopener noreferrer"><span>이동훈 (아루)</span></a></div><small class="avatar__subtitle">리뷰미 BE</small></div></div></div></div></header><div class="markdown"><p>이전의 리뷰미는 nginx 설정을 바꾸기 위해 직접 인스턴스에 접속해야 했습니다.
또, 개발 서버와 운영 서버와의 nginx 설정도 서로 달랐습니다.
현재는 GitHub에 <code>.conf</code>와 <code>docker-compose.yml</code> 파일을 관리하고 있고, 해당 부분의 변경 사항이 인스턴스에 전파됩니다.
이 글에서는 서로 다른 nginx 설정 정보를 어떻게 통합했는지에 대해서 다룹니다.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-서로-다른-환경-설정">🤨 서로 다른 환경 설정<a class="hash-link" aria-label="🤨 서로 다른 환경 설정에 대한 직접 링크" title="🤨 서로 다른 환경 설정에 대한 직접 링크" href="/blog/tags/infra#-서로-다른-환경-설정">​</a></h2>
<p>운영 서버와 개발 서버로 분리되는 순간 관리해야 하는 부분이 하나 더 생기게 됩니다.
인스턴스가 최소 한 개 추가되기도 하고, 여러 이유들로 인해 인프라에 작업을 해 두었다면 더욱 그렇겠죠.
리뷰미도 https 통신을 위해 nginx를 사용하고 있었고, 개발 서버와 운영 서버에 각각 설치돼 있었습니다.</p>
<p>관리 포인트가 많아진다는 것은 결국 한 번의 수정이 곧 두 번의 수정이라는 의미입니다.
개발 서버에서 충분한 테스트 후 운영 서버로 반영해야 할 때에는, 어떤 부분이 수정되었는지 다시 비교해보아야 해요.
이 과정에서 실수할 수 있는 것은 분명하거니와 실수하더라도 빠르게 바로잡을 수 없었습니다.</p>
<p>가만 봅시다. <strong>이거 어디에서 많이 본 상황 아닌가요?</strong></p>
<p>처음 프로젝트를 시작하고 얼마 안 돼 같은 일을 겪었습니다.
빌드하고, <code>.jar</code> 파일을 만들고, 이를 인스턴스로 옮겨 <code>java -jar</code> 명령어를 통해 서버를 실행하기까지.
불편함은 오류를 회복하는 시간을 더디게 만들었고 효율적인 업무에 방해가 될 뿐이었습니다.
이를 해결하기 위해 CD 자동화를 진행했어요. 실행 파일을 빌드하는 것부터 실제 서버에 업로드 및 실행하는 것을 빠르게 확인할 수 있었습니다.</p>
<p>일련의 과정들을 인프라에도 적용할 수 있지 않을까요?</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="️-nginx를-git으로-관리하라고요">🕸️ nginx를 Git으로 관리하라고요?<a class="hash-link" aria-label="🕸️ nginx를 Git으로 관리하라고요?에 대한 직접 링크" title="🕸️ nginx를 Git으로 관리하라고요?에 대한 직접 링크" href="/blog/tags/infra#️-nginx를-git으로-관리하라고요">​</a></h2>
<p>네, 이제는 nginx의 설정 파일을 Git으로 관리하려고 합니다.
실제로 nginx에서 우리의 설정은 <code>nginx.conf</code>와 <code>/conf.d</code> 하위의 파일들만 관리되고 있었어요.
추가적으로 Https를 위한 인증서 키가 <code>/cert</code> 디렉토리에 존재합니다만, 인증서는 이 글에서는 다루지 않습니다.</p>
<p>그렇다면 우리가 관리해야 하는 것은 <code>nginx.conf</code>, <code>/conf.d</code> 하위 파일들, 그리고 <code>docker-compose.yml</code>이 되겠습니다. 도커를 활용한 것은 운영-개발 서버의 환경 차이를 최대한 줄이기 위함이었지만, 개발 서버에서 이것저것 실험해 보면서 운영 서버와는 다른 환경이 되어버렸어요. 이 차이를 줄이기 위해서라도 <code>docker-compose.yml</code> 또한 버전 관리를 해야할 필요성을 느꼈습니다.</p>
<p><code>docker-compose.yml</code>에서는 포트 바인딩, 모니터링을 위한 exporter, 네트워크 정보가 포함돼 있습니다. 내부 설정에 필요한 부분과 로깅은 모두 호스트와 볼륨 매핑돼 있으므로, <code>down</code>, <code>up</code>을 진행하더라도 중요한 데이터는 손실되지 않습니다. 이 파일은 그대로 Git에 업로드되어도 괜찮겠네요!</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>경고</div><div class="admonitionContent_BuS1"><p>기본적으로 <strong>Private repository</strong>에 업로드되는 것을 원칙으로 합니다.<br>
Public에 업로드하는 경우 <strong>Actions secret</strong>으로 대부분의 정보를 공개하지 않을 것을 권장합니다.</p></div></div>
<div class="language-yaml codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_P25_">docker-compose.yml</div><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yaml codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">stable</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">alpine3.20</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./nginx.conf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/nginx/nginx.conf</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./logs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/log/nginx</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./conf.d</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/nginx/conf.d</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./cert</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/nginx/cert</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nginx_exporter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx_exporter</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> nginx</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx/nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">exporter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">1.3.0</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>nginx 설정 파일에는 운영 서버와 개발 서버가 서로 다르게 적혀야하는 부분이 있습니다. IP/Port와 같은 <code>upstream</code> 정보와 <code>server_name</code>이예요. <code>app-dev.conf</code>, <code>app-prod.conf</code>와 같이 두 개의 파일로 관리해야 할까요? 저희는 관리 포인트가 늘어나는 것이 싫어서 여러 방법을 찾아 보았어요.</p>
<div class="language-nginx codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_P25_">conf.d/app.conf</div><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-nginx codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token directive keyword" style="color:#00009f">upstream</span><span class="token directive"> app</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token directive keyword" style="color:#00009f">server</span><span class="token directive"> 10.1.2.3:8080</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 개발 서버와 운영 서버와의 IP와 포트가 다릅니다</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token directive keyword" style="color:#00009f">server</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token directive keyword" style="color:#00009f">listen</span><span class="token directive"> </span><span class="token directive number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token directive keyword" style="color:#00009f">server_name</span><span class="token directive"> your-domain.here.com</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># https 리다이렉션..</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token directive keyword" style="color:#00009f">server</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token directive keyword" style="color:#00009f">listen</span><span class="token directive"> </span><span class="token directive number" style="color:#36acaa">443</span><span class="token directive"> ssl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token directive keyword" style="color:#00009f">server_name</span><span class="token directive"> your-domain.here.com</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 인증서, 리버스 프록싱 설정..</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>리눅스에서는 <code>envsubst</code>라는 프로그램을 제공합니다. <code>environment variable substitution</code>, 환경 변수 치환이예요. 문자열을 제공한 뒤, 리눅스 내 환경 변수가 존재한다면 해당 내용으로 치환합니다. 이때, <code>${VAR_NAME}</code>와 같은 형태로 제공해야 해요.</p>
<p>그렇다면 환경 변수에 서버와 도메인 정보를 미리 넣어둔 뒤, 설정 파일에 치환할 변수를 추가한다면 어떨까요? 아래와 같은 모습이 되겠습니다. 환경 변수를 어떻게 설정할지는 GitHub Actions에서 다시 설명드리도록 할게요!</p>
<div class="language-nginx codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_P25_">conf.d/app.conf</div><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-nginx codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token directive keyword" style="color:#00009f">upstream</span><span class="token directive"> app</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token directive keyword" style="color:#00009f">server</span><span class="token directive"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">UPSTREAM_URL</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token directive keyword" style="color:#00009f">server</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token directive keyword" style="color:#00009f">listen</span><span class="token directive"> </span><span class="token directive number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token directive keyword" style="color:#00009f">server_name</span><span class="token directive"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">SERVER_URL</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token directive keyword" style="color:#00009f">server</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token directive keyword" style="color:#00009f">listen</span><span class="token directive"> </span><span class="token directive number" style="color:#36acaa">443</span><span class="token directive"> ssl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token directive keyword" style="color:#00009f">server_name</span><span class="token directive"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">SERVER_URL</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-자동화-스크립트-작성">🔥 자동화 스크립트 작성<a class="hash-link" aria-label="🔥 자동화 스크립트 작성에 대한 직접 링크" title="🔥 자동화 스크립트 작성에 대한 직접 링크" href="/blog/tags/infra#-자동화-스크립트-작성">​</a></h2>
<p>이제는 모든 것이 Git으로 관리되고 있고, 변경 사항을 인스턴스에 적용하면 됩니다. CI/CD를 적용했을 때처럼, GitHub Actions를 활용해 인스턴스에 반영해 봅시다. 디렉토리 구조는 아래와 같습니다.</p>
<div class="codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-text codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">🗂️ nginx</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"> ∟ 🗂️ conf.d</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">     ∟ ⬢ app.conf</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    🐳 docker-compose.yml</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    ⬢ nginx.conf</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="변경-사항에-따라-다르게-적용하기">변경 사항에 따라 다르게 적용하기<a class="hash-link" aria-label="변경 사항에 따라 다르게 적용하기에 대한 직접 링크" title="변경 사항에 따라 다르게 적용하기에 대한 직접 링크" href="/blog/tags/infra#변경-사항에-따라-다르게-적용하기">​</a></h3>
<p>몇 가지 따져봐야 할 것이 있습니다. 다음과 같이 두 가지 경우로 나뉘는데요,</p>
<ul>
<li><code>docker-compose</code>가 변경되는 경우</li>
<li><code>.conf</code> 파일만 변경되는 경우</li>
</ul>
<p>전자의 경우 컨테이너를 다시 띄워야 하겠지만, 후자의 경우에는 nginx에게 새로고침 명령만 내리면 됩니다. 즉 <code>.conf</code>만 변경되었을 때 컨테이너가 다시 띄워질 필요가 없다는 의미입니다. 이를 어떻게 판단할 수 있을까요?</p>
<p>우선 workflow가 돌아가기 위해 <code>/nginx</code> 아래 파일이 바뀌어야 한다는 전제가 있습니다. 해당 스크립트가 돌아간다는 의미는 <code>/nginx</code> 내부에 변경이 일어났다는 것과 같아요.
그렇다면 커밋 이력에서 <code>docker-compose.yml</code>이 변경되었는지만 확인하면 되지 않을까요?</p>
<p><code>actions/checkout@v4</code>에서는 workflow를 실행하게 한 브랜치를 가져옵니다. 이를 활용해 이전 커밋과 현재 커밋을 비교해 봅시다. 브랜칭 전략을 조금 활용한다면   문제를 해결할 수 있어요.</p>
<img src="/assets/images/git-dcff4c8e0f33132e17b5ac154c2b15bd.png" alt="git">
<p>PR을 통해 Squash and merge를 진행하게 되면 변경 이력이 하나의 커밋으로 바뀌게 됩니다(그림 왼쪽). 직전 커밋과 Squash된 현재 커밋을 비교해 <code>docker-compose.yml</code>이 존재하는지 찾아보는 것도 하나의 방법입니다. Merge commit을 사용하게 된다면 위 그림과 같은 상황에서 <code>docker-compose.yml</code>의 변경 사항을 눈치챌 수 없습니다.</p>
<p><code>git diff HEAD^ HEAD</code>를 통해 <code>HEAD</code>의 부모 커밋과 <code>HEAD</code> 커밋을 비교할 수 있습니다. <code>--name-only</code> 옵션을 사용하면 변경된 파일만을 확인할 수 있죠. 이를 <code>grep</code>을 통해 받아내 봅시다. 해당 값이 존재한다면 <code>docker-compose</code> 설정이 변경된 것이고, 그렇지 않다면 <code>.conf</code>만이 변경되었겠죠? 그림을 아래와 같은 글로 풀어봅시다.</p>
<div class="language-plaintext codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-plaintext codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"># Merge commit이 진행되는 경우, HEAD^에 비해 HEAD에 변경된 것은 conf/app.conf 뿐이다.</span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">HEAD  | commit ab92d1: modified conf/app.conf</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">HEAD^ | commit 3f4a2d: modified nginx.conf</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      | commit bbacf6: modified docker-compose.yml</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">---</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"># Squash and merge가 진행되는 경우 세 개의 커밋이 하나의 커밋으로 합쳐짐</span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">HEAD  | commit f0139c: modified nginx.conf, conf.d/app.conf, docker-compose.yml</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">HEAD^ | commit facc24: modified readme.md</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>해당 규칙을 사용하지 않고 다양한 방 법을 활용해 변경사항을 찾아낼 수도 있겠지만, 저희가 찾은 효율적인 방법 중 하나라 사용하게 되었어요.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>정보</div><div class="admonitionContent_BuS1"><p>GitHub Actions의 <code>actions/checkout@v4</code>를 활용한다면, <code>fetch-depth</code>가 기본으로 1이라 가장 최근 커밋만을 불러오게 됩니다. <code>HEAD</code>와 그 부모 커밋을 비교하기 위해서는 최소 <strong>2 이상의 값</strong>으로 설정해야 합니다.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="브랜치에-따라-다른-인스턴스에-적용하기">브랜치에 따라 다른 인스턴스에 적용하기<a class="hash-link" aria-label="브랜치에 따라 다른 인스턴스에 적용하기에 대한 직접 링크" title="브랜치에 따라 다른 인스턴스에 적용하기에 대한 직접 링크" href="/blog/tags/infra#브랜치에-따라-다른-인스턴스에-적용하기">​</a></h3>
<p>한 가지 더 신경써야할 점이 있습니다. 바로 개발 서버와 운영 서버가 분리되어있다는 점이예요. Actions가 개발 서버에만 붙어있다면 위쪽에서 <code>envsubst</code>를 할 이유도 없습니다. 다양한 서버에 적절하게 값을 주입하고 설정을 적용해야 했기에, 보다 유연하게 작성해야 해요.</p>
<p>개발 서버와 운영 서버에 변동이 일어났음을 어떻게 알 수 있을까요? 저희는 브랜치 이름에 따라 이를 분기했습니다. <code>runs-on</code>을 알아내기 위해 우선 브랜치 이름을 가져오고, 이를 기반으로 <code>job</code> 이 돌아갈 러너를 선택하도록 했어요. <code>outputs</code>를 통해 각 <code>step</code>에서 <code>$GITHUB_OUTPUT</code>으로 쓰인 값들을 서로 공유할 수 있습니다. 자세한 내용은 <a href="https://docs.github.com/en/actions/writing-workflows/choosing-what-your-workflow-does/passing-information-between-jobs" target="_blank" rel="noopener noreferrer"><strong>이곳</strong></a>을 확인해주세요!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-결과-스크립트와-앞으로의-숙제">🔍 결과 스크립트와 앞으로의 숙제<a class="hash-link" aria-label="🔍 결과 스크립트와 앞으로의 숙제에 대한 직접 링크" title="🔍 결과 스크립트와 앞으로의 숙제에 대한 직접 링크" href="/blog/tags/infra#-결과-스크립트와-앞으로의-숙제">​</a></h2>
<p>최종적으로 아래와 같은 스크립트가 만들어집니다. 이제 nginx 설정을 위해 인스턴스에 터미널로 접속하던 시절은 안녕. 보다 안전하고 깔끔하게, 한 곳의 변화로 모든 곳에 적용할 수 있는 제반이 마련되었습니다. 저희 목표는 언젠가 모든 인프라를 터미널을 들어가지 않고 관리하는 것이예요. 꾸준하게 불편한 것을 밖에서 쉽게 적용하도록 하면 언젠가 할 수 있지 않을까요? 😋</p>
<div class="language-yaml codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_P25_">.github/workflows/nginx.yml</div><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yaml codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187 codeBlockLinesWithNumbering_OFgW"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Configure nginx&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> develop</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> release</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nginx/**&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">workflow_dispatch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">WORKING_DIRECTORY</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/home/ubuntu/nginx&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">DEV_SERVER_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;develop-domain.com&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">DEV_UPSTREAM_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1.2.3.4:8080&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">PROD_SERVER_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;production-domain.com&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">PROD_UPSTREAM_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;5.6.7.8:8082&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">select-environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">outputs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> steps.set</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">env.outputs.instance </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Select instance</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> set</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">env</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          if [[ &#x27;${{ github.ref }}&#x27; = &#x27;refs/heads/release&#x27; ]]; then</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo &quot;instance=prod&quot; &gt;&gt; &quot;$GITHUB_OUTPUT&quot;</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          else</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo &quot;instance=dev&quot; &gt;&gt; &quot;$GITHUB_OUTPUT&quot;</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          fi</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">configure-nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">needs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> select</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">environment</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> needs.select</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">environment.outputs.instance </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Checkout repository</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v4</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">fetch-depth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Set environment variables</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          if [[ &#x27;${{ github.ref }}&#x27; = &#x27;refs/heads/release&#x27; ]]; then</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo &#x27;Setting prod environment variables&#x27;</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo &#x27;SERVER_URL=${{ env.PROD_SERVER_URL }}&#x27; &gt;&gt; $GITHUB_ENV</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo &#x27;UPSTREAM_URL=${{ env.PROD_UPSTREAM_URL }}&#x27; &gt;&gt; $GITHUB_ENV</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          else</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo &#x27;Setting dev environment variables&#x27;</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo &#x27;SERVER_URL=${{ env.DEV_SERVER_URL }}&#x27; &gt;&gt; $GITHUB_ENV</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo &#x27;UPSTREAM_URL=${{ env.DEV_UPSTREAM_URL }}&#x27; &gt;&gt; $GITHUB_ENV</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          fi</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Replace variables using envsubst</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          cat ./nginx/conf.d/app.conf | envsubst &#x27;${SERVER_URL},${UPSTREAM_URL}&#x27; &gt; ./nginx/conf.d/app.conf.tmp</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          mv ./nginx/conf.d/app.conf.tmp ./nginx/conf.d/app.conf</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Copy nginx configuration files</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cp </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">r ./nginx/* $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> env.WORKING_DIRECTORY </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Restart docker if docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">compose has changed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> else reload nginx</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          if [[ -n $(git diff --name-only HEAD^ HEAD | grep &#x27;docker-compose.yml&#x27;) ]]; then</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            cd ${{ env.WORKING_DIRECTORY }}</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            sudo docker-compose down || true</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            sudo docker-compose up -d</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo &#x27;Docker restarted&#x27;</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          else</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            sudo docker exec nginx nginx -s reload</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">            echo &#x27;Nginx reloaded&#x27;</span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token scalar string" style="color:#e3116c">          fi</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>여전히 해결해야 할 과제는 남아 있습니다. 각각의 <code>.conf</code> 파일과 <code>docker-compose.yml</code> 파일이 올바른 문법을 갖추고 있는지 확인할 방법이 필요합니다. <code>nginx -t</code>를 통해 설정 파일 문법을 확인해야 하는데, 이 부분을 조금 더 공부해보아야겠습니다.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>태그:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/blog">blog</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/infra">infra</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="블로그 게시물 목록 탐색"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Review-me. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>