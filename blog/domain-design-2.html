<!doctype html>
<html lang="ko" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">우리 팀에 맞는 도메인 설계는 무엇일까? | 리뷰미 팀블로그</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/blog/domain-design-2"><meta data-rh="true" property="og:locale" content="ko"><meta data-rh="true" name="docusaurus_locale" content="ko"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="ko"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="우리 팀에 맞는 도메인 설계는 무엇일까? | 리뷰미 팀블로그"><meta data-rh="true" name="description" content="프로젝트 구현을 위한 설계 과정에서 발생한 문제와 이를 해결하기 위한 과정을 기록했습니다."><meta data-rh="true" property="og:description" content="프로젝트 구현을 위한 설계 과정에서 발생한 문제와 이를 해결하기 위한 과정을 기록했습니다."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-08-27T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/kimprodp"><meta data-rh="true" property="article:tag" content="blog"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/blog/domain-design-2"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/blog/domain-design-2" hreflang="ko"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/blog/domain-design-2" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://your-docusaurus-site.example.com/blog/domain-design-2","mainEntityOfPage":"https://your-docusaurus-site.example.com/blog/domain-design-2","url":"https://your-docusaurus-site.example.com/blog/domain-design-2","headline":"우리 팀에 맞는 도메인 설계는 무엇일까?","name":"우리 팀에 맞는 도메인 설계는 무엇일까?","description":"프로젝트 구현을 위한 설계 과정에서 발생한 문제와 이를 해결하기 위한 과정을 기록했습니다.","datePublished":"2024-08-27T00:00:00.000Z","dateModified":"2024-08-27T13:09:07.000Z","author":{"@type":"Person","name":"김규태 (테드)","description":"리뷰미 BE","url":"https://github.com/kimprodp","image":"https://github.com/kimprodp.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://your-docusaurus-site.example.com/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="리뷰미 팀블로그 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="리뷰미 팀블로그 Atom Feed">




<script src="https://unpkg.com/twemoji@latest/dist/twemoji.min.js" crossorigin="anonymous" defer="defer"></script><link rel="stylesheet" href="/assets/css/styles.2288300f.css">
<script src="/assets/js/runtime~main.e287e282.js" defer="defer"></script>
<script src="/assets/js/main.4b6a60b2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="본문으로 건너뛰기"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">본문으로 건너뛰기</a></div><nav aria-label="메인" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="사이드바 펼치거나 접기" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="리뷰미 로고" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="리뷰미 로고" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">리뷰미 팀 블로그</b></a><a class="navbar__item navbar__link" href="/docs/common/ground-rule">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/woowacourse-teams/2024-review-me" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)" aria-label="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="최근 블로그 문서 둘러보기"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/versioning-nginx">Nginx 설정 형상관리하기</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/domain-design-2">우리 팀에 맞는 도메인 설계는 무엇일까?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/release-version-1.0.0">리뷰미 프로젝트 기획 및 리뷰미 version 1.0.0 소개</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/domain-design">무엇이 좋은 도메인 설계인가?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/random">리뷰미에서 랜덤을 활용하는 방법</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">우리 팀에 맞는 도메인 설계는 무엇일까?</h1><div class="container_mt6G margin-vert--md"><time datetime="2024-08-27T00:00:00.000Z">2024년 8월 27일</time> · <!-- -->약 20분</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/kimprodp" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/kimprodp.png" alt="김규태 (테드)"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/kimprodp" target="_blank" rel="noopener noreferrer"><span>김규태 (테드)</span></a></div><small class="avatar__subtitle">리뷰미 BE</small></div></div></div></div></header><div id="__blog-post-container" class="markdown"><br>
<blockquote>
<p>프로젝트 구현을 위한 설계 과정에서 발생한 문제와 이를 해결하기 위한 과정을 기록했습니다.
이 글의 예시 코드는 당시 상황을 이해하기 쉽게 간결하게 구성되었습니다.✍️</p>
</blockquote>
<br>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-도메인-설계를-위한-erd-작성">1. 도메인 설계를 위한 ERD 작성<a class="hash-link" aria-label="1. 도메인 설계를 위한 ERD 작성에 대한 직접 링크" title="1. 도메인 설계를 위한 ERD 작성에 대한 직접 링크" href="/blog/domain-design-2#1-도메인-설계를-위한-erd-작성">​</a></h2>
<p>프로젝트 기획 후, 구현을 위해서 제일 처음 한 것은 ERD 작성이었습니다.
JPA를 사용하기 위해서 도메인 설계를 하기 전에 ERD를 먼저 작성했습니다.</p>
<p style="text-align:center"><img src="/assets/images/first_erd-b4bc7a0feec4ac3b8fe2215727d92648.png"></p>
<p>JPA를 위한 ERD가 먼저 작성된 후 도메인을 설계하니, 도메인 관점과 맞지 않는 부분이 생겼습니다.</p>
<p>특정 멤버가 자신이 참여한 프로젝트에 대한 리뷰를 받기 위해 프로젝트명(<code>group_name</code>)을 설정하고, 리뷰 그룹을 생성합니다.
이후 다른 사람들이 해당 리뷰 그룹에 리뷰를 작성하면, 멤버는 자신의 리뷰 그  룹을 통해 받은 리뷰를 확인할 수 있어야 합니다.</p>
<p>논리적으로는 도메인 관점에서 객체의 연관 관계 방향이 <code>ReviewGroup</code> → <code>Review</code>가 되어야 합니다.
하지만, DB 관점에서는 <code>Review</code>가 <code>ReviewGroup</code>을 <code>@ManyToOne</code>으로 참조하고 있기 때문에 실제 구현에서는 <code>Review</code>가 <code>ReviewGroup</code>을 참조하는 방향으로 설계됩니다.</p>
<ul>
<li>여기서 리뷰와 리뷰 그룹의 관계뿐만 아니라, 리뷰에 포함되는 리뷰 질문과 답변에 대한 경우도 만찬가지이나, 이 글에서는 리뷰와 리뷰 그룹 간의 관계에 대해서만 설명하겠습니다</li>
</ul>
<br>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-도메인-설계-관점과-db-설계-관점의-비교">2. 도메인 설계 관점과 DB 설계 관점의 비교<a class="hash-link" aria-label="2. 도메인 설계 관점과 DB 설계 관점의 비교에 대한 직접 링크" title="2. 도메인 설계 관점과 DB 설계 관점의 비교에 대한 직접 링크" href="/blog/domain-design-2#2-도메인-설계-관점과-db-설계-관점의-비교">​</a></h2>
<p>도메인 설계 관점에서 <code>Review</code> 와 <code>ReviewGroup</code> 은 스스로 자신의 상태를 책임집니다. <code>Review</code>는 생성될 때 스스로 리뷰 내용을 검증한 후 생성됩니다.
이후 <code>ReviewGroup</code>에 포함될 때에는 그 자체로 검증된 객체로 제공되며, <code>ReviewGroup</code> 은 리뷰 작성자가 리뷰 그룹의 소유자와 일치하는지 등 규칙이나 정책에 따라 <code>Review</code>가 자신에게 속할 수 있는지 만을 확인합니다.</p>
<div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 리뷰 생성자</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Review</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Member</span><span class="token plain"> reviewer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token function" style="color:#d73a49">validateContent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reviewer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reviewer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">content </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ReviewGroup</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">		</span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Review</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> reviews</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">addReview</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Review</span><span class="token plain"> review</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">canAddReview</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">review</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// 리뷰 그룹 포함 검증 실패 예외</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        reviews</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">review</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">canAddReview</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Review</span><span class="token plain"> review</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Review를 그룹에 추가할 수 있는지 검증하는 로직</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<br>
<p>하지만 DB 설계를 따라 <code>Review</code>가 <code>ReviewGroup</code>을 참조하는 방향으로 설계되면, 리뷰가 생성되는 순간에 리뷰 그룹이 정해집니다.
따라서 <code>Review</code> 가 생성되는 순간에 스스로 리뷰 내용을 검증할 뿐만 아니라, <code>ReviewGroup</code> 과의 협력을 통해 자신이 해당 그룹에 속할 수 있는지도 함께 검증해야 합니다.</p>
<div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Review</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">		</span><span class="token comment" style="color:#999988;font-style:italic">// 다른 필드</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">ReviewGroup</span><span class="token plain"> reviewGroup</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Review</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Member</span><span class="token plain"> reviewer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">ReviewGroup</span><span class="token plain"> reviewGroup</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token function" style="color:#d73a49">validateContent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token function" style="color:#d73a49">validateInclusionInReviewGroup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reviewGroup</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reviewer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reviewer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reviewGroup </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reviewGroup</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">content </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">validateInclusionInReviewGroup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ReviewGroup</span><span class="token plain"> reviewGroup</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">reviewGroup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">canAddReview</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// 리뷰 그룹 포함 검증 실패 예외</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>이렇게 도메인 설계와 DB 설계 간의 <strong>연관 관계 방향의 불일치</strong>가 있을 때 발생할 수 있는 문제가 있습니다.</p>
<br>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-도메인과-db-연관-관계-방향의-불일치로-인한-문제">3. 도메인과 DB 연관 관계 방향의 불일치로 인한 문제<a class="hash-link" aria-label="3. 도메인과 DB 연관 관계 방향의 불일치로 인한 문제에 대한 직접 링크" title="3. 도메인과 DB 연관 관계 방향의 불일치로 인한 문제에 대한 직접 링크" href="/blog/domain-design-2#3-도메인과-db-연관-관계-방향의-불일치로-인한-문제">​</a></h2>
<p><code>ReviewGroup</code> 은 <code>Review</code>를 그룹으로 관리하기 위해 만들어진 도메인으로, 재사용보단 관리의 목적이 큽니다.
그러나 <code>Review</code>는 <code>ReviewGroup</code> 없는 상황에서도 독립적으로 재사용이 가능해야 합니다.</p>
<p>하지만 DB 설계를 따라 <code>Review</code>가 <code>ReviewGroup</code>을 참조하는 방향으로 설계되면, <code>Review</code>에는 리뷰 그룹 포함과 관련된 검증이 포함되게 됩니다.</p>
<div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">validateInclusionInReviewGroup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ReviewGroup</span><span class="token plain"> reviewGroup</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">reviewGroup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">canAddReview</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// 리뷰 그룹 포함 검증 실패 예외</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<br>
<p>이는 <code>Review</code> 가 <code>Review</code>  자체에 대한 책임뿐만 아니라, <code>ReviewGroup</code>의 책임도 지니게 하면서 <strong>단일 책임 원칙을 위반</strong>하게 됩니다.</p>
<ul>
<li><code>Review</code>는 <code>ReviewGroup</code> 이 없는 상황에서 독립적으로 재사용할 수 없게 됩니다.</li>
<li><code>Review</code>가 <code>ReviewGroup</code>의 기능을 직접 사용하게 되면서 <code>ReviewGroup</code>이 관리해야 할 책임이 <code>Review</code>로 넘어가게 됩니다.</li>
<li><code>Review</code>는 <code>ReviewGroup</code>의 변경에 영향을 받게 됩니다.</li>
</ul>
<p><em>단일 책임 원칙</em>에 따르면, 모듈은 한 가지 이유로만 변경되어야 하지만, <code>Review</code>는 자체 변경뿐만 아니라 <code>ReviewGroup</code>의 변경에도 영향을 받습니다.
이는 <code>Review</code>와 <code>ReviewGroup</code> 간의 결합도를 높여 변경에 유연하지 못하는 상태를 초래하며, 유지 보수를 어렵게 만듭니다.</p>
<br>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-양방향-관계가-해결책이-될-수-있을까">4. 양방향 관계가 해결책이 될 수 있을까?<a class="hash-link" aria-label="4. 양방향 관계가 해결책이 될 수 있을까?에 대한 직접 링크" title="4. 양방향 관계가 해결책이 될 수 있을까?에 대한 직접 링크" href="/blog/domain-design-2#4-양방향-관계가-해결책이-될-수-있을까">​</a></h2>
<p>처음에는 도메인 관점과 DB 관점의 연관 관계 방향 모두 충시키기 위해 양방향 관계를 사용했습니다.</p>
<div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Review</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Member</span><span class="token plain"> reviewer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">ReviewGroup</span><span class="token plain"> reviewGroup</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token function" style="color:#d73a49">validateContent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reviewer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reviewer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reviewGroup </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reviewGroup</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">content </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">        reviewGroup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addReview</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>하지만 책임 분리가 명확하지 않고, 초기화되지 않은 상태에서의 참조로 인해 의도치 않은 문제가 발생했습니다.
양방향 관계에서 발생하는 문제를 해결하기 위해 추가적인 장치들을 도입했지만, 이는 오히려 로직을 복잡하게 만들었습니다.</p>
<p>결과적으로 개발자가 관리해야 할 부분을 증가시키기 때문에 문제를 해결하기보단, 새로운 문제를 야기하게 되어 해결책이 되지 못했습니다.</p>
<br>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-어떤-설계가-좋은-설계일까">5. 어떤 설계가 좋은 설계일까?<a class="hash-link" aria-label="5. 어떤 설계가 좋은 설계일까?에 대한 직접 링크" title="5. 어떤 설계가 좋은 설계일까?에 대한 직접 링크" href="/blog/domain-design-2#5-어떤-설계가-좋은-설계일까">​</a></h2>
<p>우리는 어떤 설계가 좋은 설계인지 계속해서 고민했습니다.</p>
<ul>
<li>로직을 작성하기 쉬운 설계</li>
<li>성능을 고려한 설 계</li>
<li>변경에 유연하고 유지 보수에 용이한 설계</li>
</ul>
<p>다양한 쟁점들이 있었지만, 현재 우리 팀의 상황에 맞는 설계가 무엇인지 고민할 필요가 있었습니다.🤔</p>
<br>
<u>💡구현에 앞서 기획 단계에서 우리가 내렸던 결론을 다시 생각해 보았습니다.</u>
<p><strong>‘리뷰미’</strong> 는 팀 프로젝트를 같이 한 팀원들과 상호 리뷰를 통해서 긍정적인 경험을 제공하고자 했습니다.
이 목표를 달성하기 위해, 다양한 기능들을 제공하기보다는 <strong>‘리뷰’ 자체에 중점</strong>을 두어 리뷰이와 리뷰어 모두가 만족할 수 있는 <strong>품질 좋은 리뷰를 작성하게 하는 것</strong>을 목표로 했습니다.</p>
<p>따라서 리뷰 작성 폼을 지속적으로 발전시킬 필요가 있었고, 이는 리뷰 작성 폼이 언제든지 변경 가능하며, 리뷰의 질문 형태도 서술형이나 선택형 등 <strong>지속적으로 다양한 형태로 발전할 가능성을 염두에 두고</strong> 설계되어야 했습니다.</p>
<p>이러한 이유로 우리는 <strong>변경에 유연하게 대처할 수 있는 설계</strong>가 현재 팀의 상황에 맞는 가장 좋은 설계라고 결론을 내렸고, 이를 중심으로 다시 설계에 대한 고민을 이어갔습니다.</p>
<br>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-연관-관계를-다시-생각해보자">6. 연관 관계를 다시 생각해보자<a class="hash-link" aria-label="6. 연관 관계를 다시 생각해보자에 대한 직접 링크" title="6. 연관 관계를 다시 생각해보자에 대한 직접 링크" href="/blog/domain-design-2#6-연관-관계를-다시-생각해보자">​</a></h2>
<p>객체지향 설계에서 객체들은 서로 연관 관계를 맺음으로써 메시지를 주고받으며 협력합니다.
그러나 불필요한 연관 관계가 생기면 불필요한 책임이 생기고, 이는 변경에 유연하지 못하게 됩니 다.</p>
<p>따라서 우리는 불필요한 연관 관계를 제거하고, 정말 필요한 곳만 연관 관계를 가지도록 했습니다.
이 과정에서 조영호 님의 <a href="https://www.youtube.com/watch?v=dJ5C4qRqAgA" target="_blank" rel="noopener noreferrer">우아한객체지향</a>을 통해 공부하고 참고했습니다.</p>
<br>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="객체를-묶는-기준">객체를 묶는 기준<a class="hash-link" aria-label="객체를 묶는 기준에 대한 직접 링크" title="객체를 묶는 기준에 대한 직접 링크" href="/blog/domain-design-2#객체를-묶는-기준">​</a></h3>
<p>우리는 의존 받는 객체의 변경이 의존하는 객체에 영향을 미치는 것을 경험했습니다.
모든 의존 관계를 완전히 제거하는 것이 아니라, <strong>같이 변경되어야 하는 객체들</strong>만 묶는다면 다른 객체들은 변경에 영향을 미치지 않을 것이라고 생각했습니다.</p>
<p>같이 변경되어야 하는 객체들은 본질적으로 결합도가 높아 같이 변경되어도 무방하여, 도메인적인 관점에서 같이 처리되어야 할 객체들입니다.
우리는 이 기준을 <strong>생명 주기를 함께하는 객체</strong>로 설정했습니다.</p>
<p>현재 구현의 예시로는 리뷰(<code>Review</code>)와 리뷰에 작성된 답변(<code>TextAnswer</code>)이 있습니다.</p>
<ul>
<li>리뷰의 답변은 리뷰 없이 생성될 수 없고, 리뷰가 작성되는 시점에 항상 같이 생성됩니다.</li>
<li>리뷰 없이 답변만 있는 것이 불가능하기에, 리뷰가 삭제되면 답변도 항상 같이 생성됩니다.</li>
</ul>
<p>이러한 특성 때문에 <code>Review</code>와 <code>TextAnswer</code>는 생명 주기가 일치하며, 두 객체는 강한 결합 관계를 가집니다.
따라서 두 객체를 하나의 단위로 묶어 관리하는 것이 적절하다고 생각했습니다.</p>
<div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Review</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">		</span><span class="token comment" style="color:#999988;font-style:italic">// 다른 필드</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@OneToMany</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fetch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">FetchType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">EAGER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cascade </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">CascadeType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">PERSIST</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@JoinColumn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;review_id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nullable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> updatable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">TextAnswer</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> textAnswers</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<br>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="논리적인-연관-관계의-장점">논리적인 연관 관계의 장점<a class="hash-link" aria-label="논리적인 연관 관계의 장점에 대한 직접 링크" title="논리적인 연관 관계의 장점에 대한 직접 링크" href="/blog/domain-design-2#논리적인-연관-관계의-장점">​</a></h3>
<p>논리적으로 연관 관계를 재설정하면서 느꼈던 장점은</p>
<ol>
<li>객체 관계를 명확하게 정의함으로써, 설계 의도를 더 명확하게 드러낼 수 있었습니다.</li>
<li>변경이 발생할 때, 그 영향에 대한 범위가 명확함으로 예상 가능하며 다른 부분에 미치는 영향을 최소화할 수 있습니다. 이를 통해 코드 재사용을 높이고, 일관성을 유지할 수 있었습니다.</li>
<li>데이터베이스의 연관 관계에 따라 <code>CascadeType</code>과 <code>FetchType</code> 설정을 고민해야 했지만, 논리적인 기준을 세우고 객체를 묶음으로써 연관 관계 설정의 기준을 명확히 할 수 있었습니다.<!-- -->
<ul>
<li>두 객체는 함께 생성되고 관리되므로 <code>CascadeType.PERSIST</code> 설정을 주었습니다.</li>
<li>리뷰를 조회할 때, 답변도 함께 조회할 수 있도록 <code>FetchType.EAGER</code>를 사용했습니다.</li>
</ul>
</li>
</ol>
<br>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="간접-참조의-활용">간접 참조의 활용<a class="hash-link" aria-label="간접 참조의 활용에 대한 직접 링크" title="간접 참조의 활용에 대한 직접 링크" href="/blog/domain-design-2#간접-참조의-활용">​</a></h3>
<p>위에서 세운 기준을 통해 강한 결합 관계를 가지는 객체들을 묶어 관리하고 불필요한 연관 관계를 끊었습니다.
여기서 강한 결합 관계를 가지는 객체들이 아닌 객체들의 연관 관계를 모두 완전히 끊을 수는 없기에, 직접적인 객체 참조 대신 <code>id</code>를 사용하여 객체 간의 결합을 느슨하게 유지할 수 있게 했습니다.</p>
<div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_p187"><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Review</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Column</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;review_group_id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nullable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> reviewGroupId</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_iPqp" style="color:#393A34"><span class="codeLineNumber_F4P7"></span><span class="codeLineContent_pOih"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<br>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-다중성을-가지는-연관-관계의-설정">7. 다중성을 가지는 연관 관계의 설정<a class="hash-link" aria-label="7. 다중성을 가지는 연관 관계의 설정에 대한 직접 링크" title="7. 다중성을 가지는 연관 관계의 설정에 대한 직접 링크" href="/blog/domain-design-2#7-다중성을-가지는-연관-관계의-설정">​</a></h2>
<p>보통 다중성을 가지는 연관 관계에서 다중성이 적은 방향을 선택하는 것이 좋은 방법이라고 합니다.
(<code>@OneToMany</code> 대신 <code>@ManyToOne</code> 사용) 하지만 <code>Review</code>와 <code>TextAnswer</code> 관계에서 다중성이 적은 방향을 선택한다면, 이 역시 DB 설계 관점의 방향으로 도메인 설계 방향과 불일치가 발생하게 됩니다.</p>
<u>이 경우 우리는 <code>@OneToMany</code> 단방향을 사용했습니다.</u>
<p><code>@OneToMany</code> 단방향은 엔티티에서 연관 방향과 반대로 테이블에서는 Many 쪽에 FK가 관리되므로 작업한 엔티티가 아닌 다른 엔티티에서 쿼리가 발생하기 때문에 헷갈릴 수 있으며 추가 쿼리가 발생한다는 단점이 있습니다.</p>
<blockquote>
<p>예를 들어, <code>Review</code>를 저장한 후, <code>TextAnswer</code>가 추가되거나 삭제될 때, <code>TextAnswer</code> 테이블의 FK에 대한 <code>update</code> 쿼리가 추가로 발생하게 됩니다.</p>
</blockquote>
<br>
<p>리뷰미 정책 상 리뷰는 한 번 작성되면 변경될 수 없고, 함께 생성되고 삭제되기에 <code>Review</code>를 저장한 후, <code>TextAnswer</code>가 추가되거나 중간에 삭제되는 일이 없습니다.</p>
<p>따라서 <code>CascadeType.PERSIST</code>를 통해 함께 영속화 시키고, <code>@JoinColumn(nullable = false, updatable = false)</code>를 통해 <code>TextAnswer</code>의 FK 가 null 일 수 없으며 이후 변경되지 않도록 하여 <code>@OneToMany</code> 단뱡향의 단점을 상쇄시킬 수 있었습니다.</p>
<br>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-결론">8. 결론<a class="hash-link" aria-label="8. 결론에 대한 직접 링크" title="8. 결론에 대한 직접 링크" href="/blog/domain-design-2#8-결론">​</a></h2>
<p>이번 설계를 통해 객체들 간의 관계를 정의하는 기준을 재정립하고, 연관 관계가 불필요한 객체들은 <code>id</code>를 통해 간접적으로 관리하는 방식으로 접근했습니다.
이러한 방식은 여러 이점도 있었지만 단점도 존재했습니다.</p>
<ul>
<li>필요할 때만 DB에서 연관된 객체를 조회하기 때문에 불필요한 데이터를 가져오지 않도록 할 수 있지만, 이는 다르게 보면 연관된 객체를 필요로 할 때마다 별도의 쿼리를 통해 조회해야 하기 때문에 성능 저하가 발생할 수 있습니다.</li>
<li>간접 참조를 사용함으로써 책임이 명확하게 분리되고 독립적으로 관리되지만, 객체 간의 관계를 수동으로 처리해야 하는 부담이 생깁니다. 또 데이터 정합성을 유지하기 위한 추가적인 로직이 필요할 수 있습니다.</li>
</ul>
<p>이 외에도 더 많은 구현을 해보면 직접적으로 느끼는 것이 많을 거라 생각됩니다.</p>
<br>
<p>하지만 우리가 설계에서 고려했던 핵심 중 하나는 <strong>서비스 요구사항이 계속해서 변화할 가능성이 크다</strong>는 점이었습니다.
초기 기획이 계속해서 변경되었고, 향후에도 서비스 요구사항은 계속해서 변경할 가능성이 있습니다.
이러한 변화에 대비하기 위해, 우리는 확장성을 예측해서 구현하기보다는 <strong>확장성을 열어두는 방향</strong>으로 설계를 하는 것이 중요하다 생각했습니다.</p>
<p>우리는 이번 설계 과정을 통해 여러 가지 새로운 시도를 해보았고, 특정 상황에서 이론적으로 좋은 설계라고 여겨지던 부분들이 실제 구현에서는 예상치 못한 문제를 야기할 수 있음을 깨달았습니다.
이와 같은 경험들은 앞으로의 설계와 구현에서 더 나은 결정을 내릴 수 있는 기반이 될 것이라고 생각합니다.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>태그:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/blog">blog</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/review-me-blog/review-me-blog.github.io/tree/main/blog/2024-08-27-domain-design-2/index.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>페이지 편집</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">최종 수정: <!-- --> <b><time datetime="2024-08-27T13:09:07.000Z" itemprop="dateModified">2024년 8월 27일</time></b>에</span></div></div></footer></article><div></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="블로그 게시물 탐색"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/versioning-nginx"><div class="pagination-nav__sublabel">이전 게시물</div><div class="pagination-nav__label">Nginx 설정 형상관리하기</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/release-version-1.0.0"><div class="pagination-nav__sublabel">다음 게시물</div><div class="pagination-nav__label">리뷰미 프로젝트 기획 및 리뷰미 version 1.0.0 소개</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/blog/domain-design-2#1-도메인-설계를-위한-erd-작성">1. 도메인 설계를 위한 ERD 작성</a></li><li><a class="table-of-contents__link toc-highlight" href="/blog/domain-design-2#2-도메인-설계-관점과-db-설계-관점의-비교">2. 도메인 설계 관점과 DB 설계 관점의 비교</a></li><li><a class="table-of-contents__link toc-highlight" href="/blog/domain-design-2#3-도메인과-db-연관-관계-방향의-불일치로-인한-문제">3. 도메인과 DB 연관 관계 방향의 불일치로 인한 문제</a></li><li><a class="table-of-contents__link toc-highlight" href="/blog/domain-design-2#4-양방향-관계가-해결책이-될-수-있을까">4. 양방향 관계가 해결책이 될 수 있을까?</a></li><li><a class="table-of-contents__link toc-highlight" href="/blog/domain-design-2#5-어떤-설계가-좋은-설계일까">5. 어떤 설계가 좋은 설계일까?</a></li><li><a class="table-of-contents__link toc-highlight" href="/blog/domain-design-2#6-연관-관계를-다시-생각해보자">6. 연관 관계를 다시 생각해보자</a><ul><li><a class="table-of-contents__link toc-highlight" href="/blog/domain-design-2#객체를-묶는-기준">객체를 묶는 기준</a></li><li><a class="table-of-contents__link toc-highlight" href="/blog/domain-design-2#논리적인-연관-관계의-장점">논리적인 연관 관계의 장점</a></li><li><a class="table-of-contents__link toc-highlight" href="/blog/domain-design-2#간접-참조의-활용">간접 참조의 활용</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/blog/domain-design-2#7-다중성을-가지는-연관-관계의-설정">7. 다중성을 가지는 연관 관계의 설정</a></li><li><a class="table-of-contents__link toc-highlight" href="/blog/domain-design-2#8-결론">8. 결론</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Review-me. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>